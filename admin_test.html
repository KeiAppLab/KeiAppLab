<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEI Lab ãƒã‚¹ã‚¿ãƒ¼ãƒ»ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ</title>

    <!-- å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->
    <script src="news_data.js"></script>
    <script src="projects_data.js"></script> <!-- æ–°è¦ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ç”¨ãƒ‡ãƒ¼ã‚¿ -->
    <script src="allowed_users.js"></script>
    <script src="index_phot.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@400;500;900&display=swap');

        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: #1e1e1e; color: #ddd; height: 100vh; overflow: hidden; }
        #mainWrapper { display: none; height: 100%; }

        /* --- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-container-split { display: flex; width: 800px; height: 500px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-left { width: 40%; padding: 40px; display: flex; flex-direction: column; justify-content: center; background: #f9f9f9; border-right: 1px solid #eee; }
        .login-left input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ccc; border-radius: 5px; }
        .login-left button { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login-right { width: 60%; padding: 40px; overflow-y: auto; color: #333; line-height: 1.6; }

        /* --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ --- */
        .dashboard { display: grid; grid-template-columns: 250px 1fr; height: 100%; }
        .sidebar { background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
        .sidebar h1 { font-size: 1.2rem; color: #fff; margin: 20px 10px; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
        .menu-btn { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 5px; color: #aaa; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .menu-btn:hover { background: #3c3c3c; color: #fff; }
        .menu-btn.active { background: #007acc; color: white; }
        .spacer { flex: 1; } /* ç©ºç™½ç”¨ */

        /* --- CMSãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        .main-content { position: relative; overflow: hidden; height: 100%; }
        .panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; padding: 30px; box-sizing: border-box; }
        .panel.active { display: block; }
        
        .cms-layout { display: flex; height: 100%; gap: 20px; }
        .editor-area { width: 40%; overflow-y: auto; padding-right: 10px; height: 100%; }
        .preview-area { width: 60%; background: #e0e0e0; color: #333; border-radius: 8px; overflow-y: auto; padding: 20px; height: 100%; }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-top: 5px; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #555; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .input-white { background-color: #ffffff !important; color: #333 !important; border: 1px solid #ccc !important; font-weight: bold; }
        .input-locked { background-color: #e9ecef !important; color: #495057 !important; cursor: not-allowed; border: 1px solid #ced4da !important; }

        .input-group { display: flex; width: 100%; }
        .input-group input { flex: 1; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; border-right: 0 !important; }
        .input-group select { flex: 1; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; background-color: #e6e6e6 !important; color: #0056b3 !important; cursor: pointer; }

        /* è¨€èªã‚¿ãƒ– */
        .editor-lang-tabs { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .edit-tab { padding: 8px 15px; background: #333; color: #aaa; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .edit-tab.active { background: #007acc; color: white; }
        .lang-input-group { display: none; }
        .lang-input-group.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ç”»åƒé¸æŠ */
        .custom-select-wrapper { position: relative; user-select: none; width: 100%; }
        .custom-select__trigger { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #fff; border-radius: 4px; cursor: pointer; color: #333; font-weight: bold; }
        .custom-options { position: absolute; display: none; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #ccc; z-index: 100; max-height: 200px; overflow-y: auto; }
        .custom-select.open .custom-options { display: block; }
        .custom-option { padding: 10px; display: flex; align-items: center; cursor: pointer; border-bottom: 1px solid #eee; color: #333; }
        .custom-option:hover { background: #f0f0f0; }
        .option-img { width: 40px; height: 40px; object-fit: cover; margin-right: 10px; border-radius: 4px; }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ --- */
        .preview-header { margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
        .lang-toggle { display: flex; gap: 5px; }
        .lang-btn { padding: 5px 10px; border-radius: 15px; border: none; font-size: 0.75rem; font-weight: bold; cursor: pointer; background: #ddd; color: #666; }
        .lang-btn.active { background: #0056b3; color: white; }

        .preview-row { display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-start; }
        .preview-col { flex: 1; min-width: 250px; }
        .preview-label { font-size: 0.8rem; color: #666; font-weight: bold; border-bottom: 1px dashed #999; display: block; margin-bottom: 10px; margin-top: 20px; }

        /* 1. ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ */
        .news-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #ccc; }
        .news-date { font-size: 0.85rem; color: #666; width: 80px; }
        .news-tag { font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; color: white; margin-right: 10px; min-width: 80px; text-align: center; }
        .tag-release { background: #0056b3; }
        .tag-update { background: #e67e22; }
        .tag-start { background: #8e44ad; }
        .tag-steam { background: #2c3e50; }
        .tag-game { background: #27ae60; }
        
        /* 2. æœ€æ–°ã®æ´»å‹•ã‚«ãƒ¼ãƒ‰ */
        .highlight-card { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .highlight-img-area { height: 140px; background: #eee; position: relative; }
        .highlight-img { width: 100%; height: 100%; object-fit: cover; }
        .highlight-content { padding: 10px; }
        .highlight-title { font-family: 'Noto Serif JP', serif; font-size: 0.95rem; font-weight: 900; line-height: 1.4; margin-bottom: 5px; }
        
        /* 3. ã‚¢ãƒ—ãƒªç´¹ä»‹ã‚«ãƒ¼ãƒ‰ (New) */
        .app-intro-card { display: flex; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); padding: 10px; align-items: center; gap: 15px; }
        .app-intro-img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .app-intro-text h4 { margin: 0 0 5px 0; font-size: 1rem; color: #333; font-family: 'Noto Serif JP', serif; }
        .app-intro-desc { font-size: 0.8rem; color: #666; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* 4. è©³ç´°ãƒšãƒ¼ã‚¸ (iFrameå¯¾å¿œ) */
        .page-preview { background: white; padding: 20px; border-radius: 8px; min-height: 300px; margin-top: 10px; }
        .page-preview h1 { border-bottom: 3px solid #0056b3; display: inline-block; padding-bottom: 5px; font-size: 1.5rem; }
        .iframe-container { width: 100%; height: 400px; border: 1px solid #ddd; border-radius: 4px; background: #fff; }
        #prevBody { white-space: pre-wrap; line-height: 1.8; }

        button { padding: 12px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; margin-top: 10px; width: 100%; }
        .btn-save { background: #27ae60; color: white; }
        .btn-calc { background: #007acc; color: white; }

        /* æ¨©é™ç®¡ç†ã‚¨ãƒªã‚¢ */
        .user-list { list-style: none; padding: 0; background: #1e1e1e; border-radius: 4px; }
        .user-list li { padding: 10px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="loginOverlay">
        <div class="login-container-split">
            <div class="login-left">
                <h2>ğŸš€ KEI Lab Admin</h2>
                <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
                <button onclick="checkIdentity()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div id="authStatus"></div>
            </div>
            <div class="login-right">
                <h3>ğŸ”‘ æ‰‹é †</h3>
                <p>GitHub Tokenã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="mainWrapper">
        <div class="dashboard">
            <div class="sidebar">
                <h1>ğŸš€ KEI Lab Admin</h1>
                <div class="menu-btn active" onclick="switchPanel('calc')">ğŸ’° åç›Šãƒ»ç§’æ•°è¨ˆç®—</div>
                <div class="menu-btn" onclick="switchPanel('cms')">ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†</div>
                <div class="menu-btn" onclick="switchPanel('projects')">ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</div>
                <div class="spacer"></div>
                <div class="menu-btn" onclick="switchPanel('users')">ğŸ‘¥ æ¨©é™ç®¡ç†</div>
                <div class="menu-btn" onclick="logout()" style="background:#c0392b; color:white;">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
            </div>

            <div class="main-content">
                
                <!-- è¨ˆç®—æ©Ÿãƒ‘ãƒãƒ« -->
                <div id="panel-calc" class="panel active">
                    <!-- (è¨ˆç®—æ©Ÿã®ä¸­èº«ã¯å¤‰æ›´ãªã—ã®ãŸã‚çœç•¥å¯èƒ½ã§ã™ãŒã€å‹•ä½œã®ãŸã‚æ®‹ã—ã¾ã™) -->
                    <div style="background:#2d2d30; padding:30px; border-radius:10px;">
                        <h2>ğŸ’° åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                        <button class="btn-calc" onclick="alert('è¨ˆç®—å‡¦ç†å®Ÿè¡Œ')">è¨ˆç®—ã™ã‚‹</button>
                    </div>
                </div>

                <!-- CMSãƒ‘ãƒãƒ« -->
                <div id="panel-cms" class="panel">
                    <div class="cms-layout">
                        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ã‚¨ãƒªã‚¢ -->
                        <div class="editor-area">
                            <h2>ğŸ“ è¨˜äº‹ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h2>
                            
                            <div class="form-group">
                                <label>æ—¥ä»˜</label>
                                <input type="text" id="inDate" class="input-white">
                            </div>

                            <div class="form-group">
                                <label>ã‚«ãƒ†ã‚´ãƒª</label>
                                <select id="inCategory" class="input-white" onchange="updatePreview()">
                                    <option value="update">æ›´æ–°æƒ…å ±</option>
                                    <option value="release">ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                                    <option value="start">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹</option>
                                    <option value="steam">Steamãƒªãƒªãƒ¼ã‚¹</option>
                                    <option value="game">ã‚µã‚¤ãƒˆå†…ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (index_phot)</label>
                                <input type="hidden" id="inImage" onchange="updatePreview()">
                                <div class="custom-select-wrapper">
                                    <div class="custom-select">
                                        <div class="custom-select__trigger" onclick="toggleImageSelect()">
                                            <span id="selectedImageText">ç”»åƒã‚’é¸æŠ...</span><span>â–¼</span>
                                        </div>
                                        <div class="custom-options" id="imageOptions"></div>
                                    </div>
                                </div>
                            </div>

                            <hr style="border:0; border-top:1px dashed #555; margin: 20px 0;">

                            <div class="editor-lang-tabs">
                                <button class="edit-tab active" onclick="switchEditorLang('ja')">ğŸ‡¯ğŸ‡µ JP</button>
                                <button class="edit-tab" onclick="switchEditorLang('en')">ğŸ‡ºğŸ‡¸ EN</button>
                                <!-- ä»–è¨€èªçœç•¥ -->
                            </div>

                            <!-- æ—¥æœ¬èªå…¥åŠ› -->
                            <div id="group-ja" class="lang-input-group active">
                                <div class="form-group">
                                    <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå (JP)ã€€news_data.js</label>
                                    <div class="input-group">
                                        <input type="text" id="inProject" class="input-white" placeholder="å…¥åŠ›ã¾ãŸã¯å³ã‹ã‚‰é¸æŠ" oninput="autoFillProject()" autocomplete="off">
                                        <select id="projectSelectHelper" class="input-white" onchange="syncProjectSelect()">
                                            <option value="">â–¼ å±¥æ­´...</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ (JP)</label>
                                    <input type="text" id="inTitle" class="input-white" oninput="updatePreview()">
                                </div>
                                <div class="form-group" style="border: 2px solid #007acc; padding: 10px; border-radius: 8px;">
                                    <label style="color:#007acc;">â–¼ ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ (ã‚«ã‚¿ãƒ­ã‚°ç”¨)</label>
                                    <textarea id="inAppIntro" class="input-white" style="height:60px;" placeholder="ä¸€è¦§ãƒšãƒ¼ã‚¸ç”¨ã®çŸ­ã„ç´¹ä»‹æ–‡" oninput="updatePreview()"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆHPè©³ç´° (JP)</label>
                                    <textarea id="inBody" class="input-white" style="height:150px;" placeholder="HTMLã‚³ãƒ¼ãƒ‰ ã¾ãŸã¯ HPã‚¢ãƒ‰ãƒ¬ã‚¹" oninput="updatePreview()"></textarea>
                                    <div id="urlLockMsg" style="font-size:0.8rem; color:#e67e22; display:none;">â€»HPã‚¢ãƒ‰ãƒ¬ã‚¹ç™»éŒ²æ¸ˆã¿ã®ãŸã‚ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚</div>
                                </div>
                            </div>

                            <!-- è‹±èªå…¥åŠ› (ç°¡æ˜“) -->
                            <div id="group-en" class="lang-input-group">
                                <div class="form-group"><label>Project Name (EN)</label><input type="text" id="inProjectEn" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>Title (EN)</label><input type="text" id="inTitleEn" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>App Intro (Catalog)</label><textarea id="inAppIntroEn" class="input-white" style="height:60px;" oninput="updatePreview()"></textarea></div>
                                <div class="form-group"><label>Project HP Detail (EN)</label><textarea id="inBodyEn" class="input-white" style="height:150px;" oninput="updatePreview()"></textarea></div>
                            </div>

                            <button class="btn-save" onclick="executeSave()">ğŸ’¾ ä¿å­˜å®Ÿè¡Œï¼ (å…¨ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°)</button>
                        </div>

                        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
                        <div class="preview-area">
                            <div class="preview-header">
                                <h2 style="border:none; margin:0; font-size:1.1rem; color:#333;">ğŸ‘ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                                <div class="lang-toggle">
                                    <button class="lang-btn active" id="btnPrevJa" onclick="setPreviewLang('ja')">JP</button>
                                    <button class="lang-btn" id="btnPrevEn" onclick="setPreviewLang('en')">EN</button>
                                </div>
                            </div>

                            <div class="preview-row">
                                <!-- 1. æœ€æ–°ã®æ´»å‹• -->
                                <div class="preview-col">
                                    <span class="preview-label">â–¼ æœ€æ–°ã®æ´»å‹• (Highlights Card)</span>
                                    <div class="highlight-card">
                                        <div class="highlight-img-area">
                                            <img src="" id="prevImg" class="highlight-img" style="display:none;">
                                            <span class="highlight-category-badge tag-update" id="prevCardCatBadge">æ›´æ–°æƒ…å ±</span>
                                        </div>
                                        <div class="highlight-content">
                                            <div class="highlight-title" id="prevCardTitle">ã‚¿ã‚¤ãƒˆãƒ«</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- 2. ã‚¢ãƒ—ãƒªç´¹ä»‹ (æ–°è¦) -->
                                <div class="preview-col">
                                    <span class="preview-label">â–¼ ã‚¢ãƒ—ãƒªç´¹ä»‹ (App Catalog)</span>
                                    <div class="app-intro-card">
                                        <img src="" id="prevIntroImg" class="app-intro-img" style="display:none;">
                                        <div class="app-intro-text">
                                            <h4 id="prevIntroTitle">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</h4>
                                            <div class="app-intro-desc" id="prevIntroDesc">ç´¹ä»‹æ–‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <span class="preview-label">â–¼ è©³ç´°ãƒšãƒ¼ã‚¸ (Project Page / HP)</span>
                            <div class="page-preview">
                                <h1 id="prevPageTitle">ã‚¿ã‚¤ãƒˆãƒ«</h1>
                                <!-- åˆ†å²è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                                <div id="previewHtmlContent">
                                    <div style="color:#666; font-size:0.9rem; margin-bottom:20px;">
                                        <span id="prevPageDate">2026.03.15</span> | <span id="prevPageProject">Project</span>
                                    </div>
                                    <img src="" id="prevPageImg" style="display:none;">
                                    <div id="prevBody">æœ¬æ–‡...</div>
                                </div>
                                <div id="previewIframeContent" style="display:none;">
                                    <p style="color:#0056b3; font-weight:bold;">ğŸ”— ç™»éŒ²æ¸ˆã¿HPã‚’è¡¨ç¤ºä¸­:</p>
                                    <iframe id="prevIframe" class="iframe-container"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ãƒ‘ãƒãƒ« (ç©ºæ¬„) -->
                <div id="panel-projects" class="panel">
                    <div class="calc-container">
                        <h2>ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ± (Projects Master)</h2>
                        <p style="color:#aaa;">â€» ã“ã“ã§ projects_data.js ã‚’ç›´æ¥ç·¨é›†ã§ãã‚‹æ©Ÿèƒ½ã‚’å°†æ¥å®Ÿè£…ã—ã¾ã™ã€‚</p>
                        <ul id="projectListDisplay" style="color:#fff;"></ul>
                    </div>
                </div>

                <!-- æ¨©é™ç®¡ç†ãƒ‘ãƒãƒ« -->
                <div id="panel-users" class="panel">
                    <div class="calc-container">
                        <h2>ğŸ‘¥ æ¨©é™ç®¡ç†</h2>
                        <ul class="user-list"><li>UserA</li><li>UserB</li></ul>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
        // å®Ÿéš›ã¯å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¾ã™ãŒã€ãƒ†ã‚¹ãƒˆç”¨ã«ç©ºå®šç¾©ã‚’ç¢ºèª
        if (typeof newsData === 'undefined') var newsData = [];
        if (typeof projectsData === 'undefined') var projectsData = []; // { "å•“RPG": { url: "...", intro_ja: "...", image: "..." } }

        let previewLang = 'ja';

        // --- èªè¨¼ãƒ»åˆæœŸåŒ– ---
        function checkIdentity() {
            // (èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯çœç•¥)
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainWrapper').style.display = 'block';
            
            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ã‚’ã‚»ãƒƒãƒˆ
            initProjectList();
            initImageSelector();
        }
        function logout() { location.reload(); }

        // --- ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ ---
        function switchPanel(panelId) {
            document.querySelectorAll('.panel').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('panel-' + panelId).classList.add('active');
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆå‡¦ç†ã¯ç°¡ç•¥åŒ–
        }

        // --- ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ»å…¥åŠ›åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ ---
        function initProjectList() {
            // newsDataã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’æŠ½å‡ºã—ã¦ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ä½œæˆ
            const projectSet = new Set(newsData.map(item => item.project).filter(p => p));
            const selectBox = document.getElementById('projectSelectHelper');
            selectBox.innerHTML = '<option value="">â–¼ å±¥æ­´...</option>';
            projectSet.forEach(projName => {
                const opt = document.createElement('option');
                opt.value = projName; opt.textContent = projName;
                selectBox.appendChild(opt);
            });
        }

        function syncProjectSelect() {
            const val = document.getElementById('projectSelectHelper').value;
            if(val) {
                document.getElementById('inProject').value = val;
                autoFillProject();
                document.getElementById('projectSelectHelper').selectedIndex = 0;
            }
        }

        // â˜…é‡è¦ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè‡ªå‹•å…¥åŠ›ï¼†URLãƒ­ãƒƒã‚¯å‡¦ç†
        function autoFillProject() {
            const projName = document.getElementById('inProject').value.trim();
            const currentProjData = projectsData.find(p => p.name_ja === projName); // projects_data.jsã‹ã‚‰æ¤œç´¢
            
            // ç”»åƒã‚„ãƒ†ã‚­ã‚¹ãƒˆã®è‡ªå‹•å…¥åŠ›ï¼ˆnewsDataã®æœ€æ–°å±¥æ­´ã‹ã‚‰ï¼‰
            const latestNews = newsData.find(n => n.project === projName);
            if(latestNews) {
                document.getElementById('inTitle').value = latestNews.title || "";
                document.getElementById('inImage').value = latestNews.image || "";
                setImageValue(latestNews.image || "");
            }

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ï¼ˆAppç´¹ä»‹ã€URLï¼‰ã®åæ˜ 
            if (currentProjData) {
                document.getElementById('inAppIntro').value = currentProjData.intro_ja || "";
                document.getElementById('inAppIntroEn').value = currentProjData.intro_en || "";
                
                // â˜…URLãŒã‚ã‚‹å ´åˆã®ãƒ­ãƒƒã‚¯å‡¦ç†
                if (currentProjData.url) {
                    lockBodyInput(document.getElementById('inBody'), currentProjData.url);
                    lockBodyInput(document.getElementById('inBodyEn'), currentProjData.url); // è‹±èªå´ã‚‚ãƒ­ãƒƒã‚¯
                    document.getElementById('urlLockMsg').style.display = 'block';
                } else {
                    unlockBodyInput(document.getElementById('inBody'));
                    unlockBodyInput(document.getElementById('inBodyEn'));
                    document.getElementById('urlLockMsg').style.display = 'none';
                }
            } else {
                // æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰ãƒ­ãƒƒã‚¯è§£é™¤
                unlockBodyInput(document.getElementById('inBody'));
                unlockBodyInput(document.getElementById('inBodyEn'));
                document.getElementById('urlLockMsg').style.display = 'none';
            }
            updatePreview();
        }

        function lockBodyInput(el, url) {
            el.value = url;
            el.classList.add('input-locked');
            el.setAttribute('readonly', true);
        }
        function unlockBodyInput(el) {
            el.classList.remove('input-locked');
            el.removeAttribute('readonly');
            // å€¤ã¯ã‚¯ãƒªã‚¢ã—ãªã„ï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹æœ¬æ–‡ã¨ã—ã¦ä½¿ã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼‰
        }

        // --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ ---
        function switchEditorLang(lang) {
            document.querySelectorAll('.lang-input-group').forEach(el => el.classList.remove('active'));
            document.getElementById('group-' + lang).classList.add('active');
            document.querySelectorAll('.edit-tab').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            setPreviewLang(lang);
        }

        function setPreviewLang(lang) {
            previewLang = lang;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btnPrev' + lang.charAt(0).toUpperCase() + lang.slice(1)).classList.add('active');
            updatePreview();
        }

        function updatePreview() {
            // è¨€èªã«å¿œã˜ãŸã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹å‡¦ç† (ja='', en='En'...)
            const sfx = (previewLang === 'ja') ? '' : previewLang.charAt(0).toUpperCase() + previewLang.slice(1);
            const idSfx = (previewLang === 'ja') ? '' : 'En'; // ç°¡æ˜“å®Ÿè£…

            const title = document.getElementById('inTitle' + idSfx)?.value || "Title";
            const project = document.getElementById('inProject' + idSfx)?.value || "Project";
            const body = document.getElementById('inBody' + idSfx)?.value || "";
            const appIntro = document.getElementById('inAppIntro' + idSfx)?.value || "Intro...";
            const image = document.getElementById('inImage').value;
            const category = document.getElementById('inCategory').value;
            const date = document.getElementById('inDate').value;

            // 1. ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªã‚¹ãƒˆåæ˜ 
            // (çœç•¥)

            // 2. æœ€æ–°æ´»å‹•ã‚«ãƒ¼ãƒ‰åæ˜ 
            document.getElementById('prevCardTitle').innerText = title;
            document.getElementById('prevImg').src = image;
            document.getElementById('prevImg').style.display = image ? 'block' : 'none';
            document.getElementById('prevCardCatBadge').className = 'highlight-category-badge tag-' + category;

            // 3. ã‚¢ãƒ—ãƒªç´¹ä»‹åæ˜ 
            document.getElementById('prevIntroTitle').innerText = project;
            document.getElementById('prevIntroDesc').innerText = appIntro;
            document.getElementById('prevIntroImg').src = image;
            document.getElementById('prevIntroImg').style.display = image ? 'block' : 'none';

            // 4. è©³ç´°ãƒšãƒ¼ã‚¸ (URLåˆ†å²)
            const isUrl = body.startsWith('http') || body.endsWith('.html');
            if (isUrl) {
                document.getElementById('previewHtmlContent').style.display = 'none';
                document.getElementById('previewIframeContent').style.display = 'block';
                document.getElementById('prevIframe').src = body;
            } else {
                document.getElementById('previewHtmlContent').style.display = 'block';
                document.getElementById('previewIframeContent').style.display = 'none';
                document.getElementById('prevPageTitle').innerText = title;
                document.getElementById('prevPageProject').innerText = project;
                document.getElementById('prevPageDate').innerText = date;
                document.getElementById('prevBody').innerHTML = body;
                document.getElementById('prevPageImg').src = image;
                document.getElementById('prevPageImg').style.display = image ? 'block' : 'none';
            }
        }

        // --- ç”»åƒé¸æŠUI ---
        function toggleImageSelect() { document.querySelector('.custom-select').classList.toggle('open'); }
        function initImageSelector() {
            const container = document.getElementById('imageOptions');
            // photoListã¯ index_phot.js ã‹ã‚‰æ¥ã‚‹æƒ³å®š
            const list = (typeof photoList !== 'undefined') ? photoList : ["no_image.png"];
            list.forEach(img => {
                const div = document.createElement('div');
                div.className = 'custom-option';
                div.innerHTML = `<img src="index_phot/${img}" class="option-img">${img}`;
                div.onclick = () => {
                    document.getElementById('inImage').value = "index_phot/" + img;
                    document.getElementById('selectedImageText').innerText = img;
                    document.querySelector('.custom-select').classList.remove('open');
                    updatePreview();
                };
                container.appendChild(div);
            });
        }
        function setImageValue(path) {
            document.getElementById('inImage').value = path;
            document.getElementById('selectedImageText').innerText = path.split('/').pop();
        }

        // --- â˜… ä¿å­˜å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ (æ¦‚å¿µå®Ÿè£…) ---
        function executeSave() {
            if(!confirm("å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã¸ä¿å­˜ãƒ»æ›´æ–°ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ")) return;

            // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
            const currentProj = document.getElementById('inProject').value;
            const currentBody = document.getElementById('inBody').value;
            
            // 1. news_data.js (Master) æ›´æ–°ç”¨ãƒ‡ãƒ¼ã‚¿ä½œæˆ
            // æ–°ã—ã„è¨˜äº‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ newsData é…åˆ—ã«è¿½åŠ 
            const newPost = {
                id: Date.now(),
                project: currentProj,
                // ...ä»–è¨€èªãƒ‡ãƒ¼ã‚¿
                date: document.getElementById('inDate').value,
                category: document.getElementById('inCategory').value,
                image: document.getElementById('inImage').value,
                title: document.getElementById('inTitle').value,
                body: currentBody // URLã®å ´åˆã‚‚ã‚ã‚‹
            };
            // (å®Ÿéš›ã¯ã“ã“ã§ newsData.unshift(newPost) )

            // 2. projects_data.js (Project Master) æ›´æ–°
            // ã‚«ã‚¿ãƒ­ã‚°ç”¨ãƒ‡ãƒ¼ã‚¿ (ã‚¢ãƒ—ãƒªç´¹ä»‹ã€URL) ã‚’æ›´æ–°ã¾ãŸã¯æ–°è¦ä½œæˆ
            const isUrl = currentBody.startsWith('http') || currentBody.endsWith('.html');
            const projectInfo = {
                name_ja: currentProj,
                intro_ja: document.getElementById('inAppIntro').value,
                // ...ä»–è¨€èª
                image: document.getElementById('inImage').value,
                url: isUrl ? currentBody : "" // æœ¬æ–‡ãŒURLã£ã½ã‘ã‚Œã°ç™»éŒ²
            };
            // (å®Ÿéš›ã¯ projectsData é…åˆ—ã‚’æ›´æ–°)

            // 3. index_news.js ç”Ÿæˆ
            // newsDataå…¨ä½“ã‹ã‚‰ã€ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«æœ€æ–°10ä»¶ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

            // 4. apps_summary.js ç”Ÿæˆ
            // newsDataå…¨ä½“ã‹ã‚‰ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ã€æœ€æ–°3ä»¶ã‚’æŠ½å‡º

            // 5. [Project]/news.js ç”Ÿæˆ
            // newsDataå…¨ä½“ã‹ã‚‰ã€currentProj ã«ä¸€è‡´ã™ã‚‹ã‚‚ã®ã ã‘æŠ½å‡º

            // --- å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ---
            console.log("Saving...", { newPost, projectInfo });
            alert("âœ… ä¿å­˜å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\næ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:\nãƒ»news_data.js (Master)\nãƒ»projects_data.js (App Catalog)\nãƒ»index_news.js (Top Page)\nãƒ»apps_summary.js (Admin List)\nãƒ»" + currentProj + "/news.js (Individual)");
        }

        // åˆæœŸå®Ÿè¡Œ
        const today = new Date();
        document.getElementById('inDate').value = today.getFullYear() + '.' + (today.getMonth()+1).toString().padStart(2,'0') + '.' + today.getDate().toString().padStart(2,'0');

    </script>
</body>
</html>
