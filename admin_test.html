<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEI Lab ãƒã‚¹ã‚¿ãƒ¼ãƒ»ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ</title>

    <script src="admin_master.js"></script>
    <script src="allowed_users.js"></script>
    <script src="index_phot.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@400;500;900&display=swap');

        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: #1e1e1e; color: #ddd; height: 100vh; overflow: hidden; }
        #mainWrapper { display: none; height: 100%; }

        /* --- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-container-split { display: flex; width: 850px; height: 550px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-left { width: 40%; padding: 40px; display: flex; flex-direction: column; justify-content: center; background: #f9f9f9; border-right: 1px solid #eee; }
        .login-left input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ccc; border-radius: 5px; }
        .login-left button { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login-left button:hover { background: #003d82; }
        .login-right { width: 60%; padding: 40px; overflow-y: auto; color: #333; line-height: 1.6; }
        .login-right h3 { border-bottom: 2px solid #0056b3; padding-bottom: 10px; margin-top: 0; }
        .login-right ol { padding-left: 20px; margin-bottom: 20px; }
        .login-right li { margin-bottom: 8px; font-size: 0.9rem; }
        .warning-box { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 10px; border-radius: 5px; font-size: 0.85rem; margin-top: 15px; }

        /* --- ãƒ¡ã‚¤ãƒ³ç”»é¢ --- */
        .dashboard { display: grid; grid-template-columns: 250px 1fr; height: 100%; }
        .sidebar { background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
        .sidebar h1 { font-size: 1.2rem; color: #fff; margin: 20px 10px; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
        .menu-btn { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 5px; color: #aaa; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .menu-btn:hover { background: #3c3c3c; color: #fff; }
        .menu-btn.active { background: #007acc; color: white; }
        .spacer { flex-grow: 1; min-height: 20px; border-bottom: 1px solid #333; margin-bottom: 10px; }

        .main-content { position: relative; overflow: hidden; height: 100%; }
        .panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; padding: 30px; box-sizing: border-box; }
        .panel.active { display: block; }

        /* --- CMSãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (40:60) --- */
        .cms-layout { display: flex; height: 100%; gap: 0; }
        .editor-area { width: 40%; overflow-y: auto; padding-right: 20px; height: 100%; box-sizing: border-box; }
        .preview-area { width: 60%; background: #e0e0e0; color: #333; overflow-y: auto; padding: 20px; height: 100%; box-sizing: border-box; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-top: 5px; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        /* ãƒ©ãƒ™ãƒ«è¡Œã®ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹è¨­å®šï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¹ã‚¤ãƒƒãƒé…ç½®ç”¨ï¼‰ */
        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .label-row label { margin: 0; }

        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #555; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .input-white { background-color: #ffffff !important; color: #333 !important; border: 1px solid #ccc !important; font-weight: bold; }
        
        .row-group { display: flex; gap: 10px; }
        .row-group > div { flex: 1; }

        .input-group { display: flex; width: 100%; }
        .input-group input { flex: 1; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; border-right: 0 !important; }
        .input-group select { flex: 1; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; background-color: #e6e6e6 !important; color: #0056b3 !important; cursor: pointer; }

        .editor-lang-tabs { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .edit-tab { padding: 8px 15px; background: #333; color: #aaa; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .edit-tab:hover { background: #444; color: #fff; }
        .edit-tab.active { background: #007acc; color: white; }
        
        .lang-input-group { display: none; animation: fadeIn 0.3s; }
        .lang-input-group.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¹ã‚¤ãƒƒãƒ */
        .status-switch { display: flex; gap: 10px; background: #333; padding: 2px 8px; border-radius: 4px; }
        .status-label { color: #fff; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; cursor: pointer; font-weight: normal; margin: 0; }
        .status-label input { width: auto; margin: 0; }

        /* ç”»åƒé¸æŠ */
        .custom-select-wrapper { position: relative; user-select: none; width: 100%; }
        .custom-select { position: relative; display: flex; flex-direction: column; }
        .custom-select__trigger { position: relative; display: flex; align-items: center; justify-content: space-between; padding: 10px; font-size: 1rem; font-weight: bold; color: #333; background: #ffffff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; }
        
        /* ä¿®æ­£: ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºã«å¤‰æ›´ */
        .custom-options { 
            position: absolute; display: block; top: 100%; left: 0; right: 0; 
            border: 1px solid #ccc; border-top: 0; background: #fff; 
            transition: all 0.3s; opacity: 0; visibility: hidden; pointer-events: none; z-index: 100; 
            max-height: 400px; overflow-y: auto; border-radius: 0 0 4px 4px;
            /* Gridè¨­å®š */
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
            padding: 10px;
        }
        .custom-select.open .custom-options { opacity: 1; visibility: visible; pointer-events: all; }
        
        /* ä¿®æ­£: ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç¸¦ä¸¦ã³(ç”»åƒä¸Šã€æ–‡å­—ä¸‹)ã«å¤‰æ›´ */
        .custom-option { 
            position: relative; display: flex; flex-direction: column; align-items: center; text-align: center;
            padding: 5px; border: 1px solid #eee; border-radius: 4px;
            cursor: pointer; transition: all 0.2s; color: #333; 
        }
        .custom-option:hover { background-color: #f2f9fc; border-color: #0056b3; color: #0056b3; }
        
        /* ä¿®æ­£: ç”»åƒã‚µã‚¤ã‚ºã‚’1.5å€(75px)ã« */
        .option-img { 
            width: 75px; height: 75px; 
            object-fit: cover; border-radius: 4px; 
            margin-bottom: 5px; /* æ–‡å­—ã¨ã®éš™é–“ */
            border: 1px solid #ddd; 
        }
        .option-text { 
            font-size: 0.8rem; font-weight: bold; 
            word-break: break-all; /* é•·ã„ãƒ•ã‚¡ã‚¤ãƒ«åã®æŠ˜ã‚Šè¿”ã— */
        }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ --- */
        .preview-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 10px; }
        .preview-label { font-size: 0.8rem; color: #666; font-weight: bold; border-bottom: 1px dashed #999; display: block; margin-bottom: 10px; }
        
        .news-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #ccc; }
        .news-date { font-family: 'Roboto', sans-serif; color: #666; width: 100px; font-size: 0.9rem; }
        .news-tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; margin-right: 15px; color: white; width: 110px; text-align: center; }
        .tag-release { background: #0056b3; } .tag-update  { background: #e67e22; } .tag-start   { background: #8e44ad; } .tag-steam   { background: #2c3e50; } .tag-game    { background: #27ae60; }
        .news-link { text-decoration: none; color: #333; font-weight: 500; font-family: 'Noto Serif JP', serif; }

        .preview-split-row { display: flex; border: 1px solid #ccc; border-radius: 8px; overflow: hidden; margin-bottom: 30px; }
        .split-col { flex: 1; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .split-col.left { background: #f0f0f0; border-right: 1px solid #ddd; }
        .split-col.right { background: #e8e8e8; }

        /* å…±é€šã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .highlight-card { width: 100%; max-width: 300px; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); }
        .highlight-img-area { width: 100%; height: 160px; overflow: hidden; background: #eee; position: relative; }
        .highlight-img { width: 100%; height: 100%; object-fit: cover; object-position: center; transition: opacity 0.3s; }
        .highlight-category-badge { position: absolute; bottom: 0; left: 0; color: white; font-size: 0.8rem; padding: 4px 12px; border-top-right-radius: 8px; font-weight: bold; z-index: 2; }
        
        /* æœ€æ–°ã®æ´»å‹•ç”¨ */
        .highlight-card.dimmed { opacity: 0.4; }
        .highlight-content-tight { padding: 5px 0 0 0; text-align: left; }
        /* ä¿®æ­£: 18æ–‡å­—Ã—3åˆ— */
        .highlight-title-tight { 
            font-family: 'Noto Serif JP', serif; font-size: 1rem; font-weight: 900; color: #333; line-height: 1.5; margin: 0; 
            width: 18em; /* 18æ–‡å­—å¹… */
            white-space: normal; /* æŠ˜ã‚Šè¿”ã—æœ‰åŠ¹ */
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
            height: 4.5em; /* 1.5 * 3è¡Œ */
        }
        .highlight-meta { font-size: 0.75rem; color: #666; margin-bottom: 2px; font-family: 'Roboto', sans-serif; }

        /* ã‚¢ãƒ—ãƒªç´¹ä»‹ç”¨ */
        .coming-soon-overlay { 
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg); 
            font-size: 1.8rem; font-weight: 900; color: #fff; text-shadow: 2px 2px 0 #000, -1px -1px 0 #000; 
            border: 3px solid #fff; padding: 5px 20px; box-shadow: 3px 3px 0 rgba(0,0,0,0.5); z-index: 10; pointer-events: none;
        }
        .highlight-img.coming-soon-mode { opacity: 0.5; filter: grayscale(50%); }

        /* ä¿®æ­£: å·¦ä¸‹ä¸€æ¯ã«é…ç½®ãƒ»è‰²ä»˜ãæ  */
        .project-name-badge {
            position: absolute; bottom: 0; left: 0; z-index: 5;
            background: #0056b3; /* è‰²ä»˜ãæ  (é’) */
            color: #fff;
            font-family: 'Roboto', sans-serif; font-weight: 900; font-size: 0.9rem;
            padding: 5px 12px; 
            border-top-right-radius: 8px; /* å³ä¸Šã ã‘ä¸¸ãã—ã¦å·¦ä¸‹ã¯ç›´è§’ */
            box-shadow: 2px -2px 5px rgba(0,0,0,0.3);
            max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* ä¿®æ­£: ä½™ç™½å‰Šæ¸›ãƒ»20æ–‡å­—Ã—4åˆ— */
        .app-desc-content { padding: 8px 10px; text-align: left; } /* ä½™ç™½å‰Šæ¸› */
        .app-desc-text {
            font-family: 'Noto Serif JP', serif; font-size: 0.9rem; color: #444; line-height: 1.5;
            width: 20em; /* 20æ–‡å­—å¹… */
            height: 6em; /* 1.5 * 4è¡Œ */
            display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;
        }

        .page-preview { font-family: 'Noto Serif JP', serif; line-height: 1.8; margin-top: 20px; background: white; padding: 20px; border-radius: 8px; }
        .page-preview h1 { border-bottom: 3px solid #0056b3; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; font-size: 1.5rem; }
        .page-preview img { max-width: 100%; border-radius: 10px; margin: 20px 0; }
        #prevBody, .news-link { white-space: pre-wrap; }

        button { padding: 12px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; width: 100%; }
        .btn-save { background: #27ae60; color: white; }
        .btn-copy { background: #e67e22; color: white; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="loginOverlay">
        <div class="login-container-split">
            <div class="login-left">
                <h2>ğŸš€ KEI Lab Admin</h2>
                <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
                <button onclick="checkIdentity()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div id="authStatus"></div>
            </div>
            <div class="login-right">
                <h3>ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œæ‰‹é †</h3>
                <ol>
                    <li><a href="https://github.com/settings/tokens" target="_blank" style="color:#007acc; font-weight:bold;">GitHub Tokenè¨­å®šãƒšãƒ¼ã‚¸ã¸ç§»å‹• â†—</a></li>
                    <li>[Generate new token (classic)] ã‚’é¸æŠ</li>
                    <li>Expirationï¼ˆæœŸé™ï¼‰ã‚’è¨­å®šï¼ˆ90 daysæ¨å¥¨ï¼‰</li>
                    <li><strong>[repo]</strong> ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ï¼ˆå¿…é ˆï¼‰</li>
                    <li>ä¸€ç•ªä¸‹ã® [Generate token] ã‚’æŠ¼ã—ã¦ã‚³ãƒ”ãƒ¼</li>
                </ol>
                <div class="warning-box">
                    <strong>âš ï¸ è­¦å‘Šï¼š</strong><br>
                    ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ¼æ´©ã—ãŸå ´åˆã¯ã€ç›´ã¡ã«GitHubè¨­å®šãƒšãƒ¼ã‚¸ã§è©²å½“ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤ï¼ˆRevokeï¼‰ã—ã¦ãã ã•ã„ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Œã°èª°ã§ã‚‚ã‚µã‚¤ãƒˆã‚’æ›¸ãæ›ãˆã‚‰ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
                </div>
            </div>
        </div>
    </div>

    <div id="mainWrapper">
        <div class="dashboard">
            <div class="sidebar">
                <h1>ğŸš€ KEI Lab Admin</h1>
                <div class="menu-btn active" onclick="switchPanel('calc')">ğŸ’° åç›Šãƒ»ç§’æ•°è¨ˆç®—</div>
                <div class="menu-btn" onclick="switchPanel('cms')">ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†</div>
                <div class="menu-btn" onclick="switchPanel('projects')">ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</div>
                <div class="spacer"></div>
                <div class="menu-btn" onclick="switchPanel('users')">ğŸ‘¥ æ¨©é™ç®¡ç†</div>
                <div class="menu-btn" onclick="logout()" style="margin-top:auto; background:#c0392b; color:white;">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
            </div>

            <div class="main-content">
                <!-- è¨ˆç®—ãƒ‘ãƒãƒ« -->
                <div id="panel-calc" class="panel active">
                    <div class="calc-container">
                        <h2>ğŸ’° ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                        <div class="calc-grid">
                            <div><label>å‹•ç”»åºƒå‘Šå˜ä¾¡</label><input type="number" id="adPrice" value="1.5" step="0.1"></div>
                            <div><label>é€šè©±åŸä¾¡ (1åˆ†)</label><input type="number" id="callCost" value="3.0" step="0.1"></div>
                        </div>
                        <label>åˆ©ç›Šç‡ <span id="marginDisplay">20%</span></label>
                        <input type="range" id="margin" min="0" max="50" value="20" oninput="document.getElementById('marginDisplay').innerText = this.value + '%'">
                        <button class="btn-calc" onclick="calcSeconds()">è¨ˆç®—ã™ã‚‹</button>
                        <div class="calc-result-box"><div id="calcOutput" class="calc-number">--- ç§’</div></div>
                    </div>
                </div>

                <!-- CMSãƒ‘ãƒãƒ« -->
                <div id="panel-cms" class="panel">
                    <div class="cms-layout">
                        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ (40%) -->
                        <div class="editor-area">
                            <h2>ğŸ“ è¨˜äº‹ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h2>
                            
                            <div class="row-group">
                                <div class="form-group"><label>æ—¥ä»˜</label><input type="text" id="inDate" class="input-white"></div>
                                <div class="form-group">
                                    <label>ã‚«ãƒ†ã‚´ãƒª</label>
                                    <select id="inCategory" class="input-white" onchange="updatePreview()">
                                        <option value="update">æ›´æ–°æƒ…å ±</option>
                                        <option value="release">ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="start">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹</option>
                                        <option value="steam">Steamãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="game">ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (index_photãƒ•ã‚©ãƒ«ãƒ€)</label>
                                <input type="hidden" id="inImage" onchange="updatePreview()">
                                <div class="custom-select-wrapper">
                                    <div class="custom-select">
                                        <div class="custom-select__trigger" onclick="toggleImageSelect()"><span id="selectedImageText">ç”»åƒã‚’é¸æŠ...</span><span>â–¼</span></div>
                                        <div class="custom-options" id="imageOptions"></div>
                                    </div>
                                </div>
                            </div>

                            <hr style="border:0; border-top:1px dashed #555; margin: 20px 0;">

                            <div class="editor-lang-tabs">
                                <button class="edit-tab active" onclick="switchEditorLang('ja')">ğŸ‡¯ğŸ‡µ JP</button>
                                <button class="edit-tab" onclick="switchEditorLang('en')">ğŸ‡ºğŸ‡¸ EN</button>
                                <button class="edit-tab" onclick="switchEditorLang('de')">ğŸ‡©ğŸ‡ª DE</button>
                                <button class="edit-tab" onclick="switchEditorLang('fr')">ğŸ‡«ğŸ‡· FR</button>
                                <button class="edit-tab" onclick="switchEditorLang('es')">ğŸ‡ªğŸ‡¸ ES</button>
                            </div>

                            <!-- æ—¥æœ¬èª -->
                            <div id="group-ja" class="lang-input-group active">
                                <div class="form-group">
                                    <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå (JP)ã€€admin_master.js</label>
                                    <div class="input-group">
                                        <input type="text" id="inProject" class="input-white" oninput="autoFillProject()">
                                        <select id="projectSelectHelper" class="input-white" onchange="syncProjectSelect()"><option value="">â–¼ å±¥æ­´...</option></select>
                                    </div>
                                </div>
                                <div class="form-group"><label>ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ (JP)</label><textarea id="inTitle" class="input-white" rows="2" oninput="updatePreview()"></textarea></div>
                                
                                <!-- ä¿®æ­£: ãƒ©ãƒ™ãƒ«ã®æ¨ªã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¹ã‚¤ãƒƒãƒã‚’é…ç½® -->
                                <div class="form-group">
                                    <div class="label-row">
                                        <label>ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ (JP)</label>
                                        <div class="status-switch">
                                            <label class="status-label"><input type="radio" name="appStatus" value="released" checked onchange="updatePreview()"> ãƒªãƒªãƒ¼ã‚¹æ¸ˆã¿</label>
                                            <label class="status-label"><input type="radio" name="appStatus" value="coming" onchange="updatePreview()"> Coming Soon</label>
                                        </div>
                                    </div>
                                    <textarea id="inBody" class="input-white" rows="3" oninput="updatePreview()"></textarea>
                                </div>
                            </div>

                            <!-- å¤šè¨€èª -->
                            <!-- è‹±èªå…¥åŠ›ã‚°ãƒ«ãƒ¼ãƒ—å†…ã«IDç¢ºèªæ¬„ã‚’è¿½åŠ  -->
                            <div id="group-en" class="lang-input-group">
                                <div class="form-group">
                                    <label>Project Name (EN) <span style="color:red; font-size:0.8rem;">â€»å¿…é ˆ: ã“ã‚ŒãŒãƒ•ã‚©ãƒ«ãƒ€å(ID)ã«ãªã‚Šã¾ã™</span></label>
                                    <input type="text" id="inProjectEn" class="input-white" oninput="generateProjectId(); updatePreview();">
                                    <!-- è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹IDã®è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                                    <div style="margin-top:5px; font-size:0.9rem; color:#aaa;">
                                        ç”ŸæˆID: <span id="generatedIdDisplay" style="font-family:monospace; font-weight:bold; color:#007acc;">---</span>
                                        <span id="idWarning" style="color:red; display:none; margin-left:10px;">âš ï¸ å¿…é ˆé …ç›®ã§ã™</span>
                                    </div>
                                </div>
                                <div class="form-group"><label>Title (EN)</label><textarea id="inTitleEn" class="input-white" rows="2" oninput="updatePreview()"></textarea></div>
                                <div class="form-group"><label>App Intro (EN)</label><textarea id="inBodyEn" class="input-white" rows="3" oninput="updatePreview()"></textarea></div>
                            </div>
                            <!-- (ä»–è¨€èªçœç•¥ã›ãšè¨˜è¿°) -->
                            <div id="group-de" class="lang-input-group"><div class="form-group"><label>Project (DE)</label><input type="text" id="inProjectDe" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (DE)</label><textarea id="inTitleDe" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (DE)</label><textarea id="inBodyDe" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>
                            <div id="group-fr" class="lang-input-group"><div class="form-group"><label>Project (FR)</label><input type="text" id="inProjectFr" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (FR)</label><textarea id="inTitleFr" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (FR)</label><textarea id="inBodyFr" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>
                            <div id="group-es" class="lang-input-group"><div class="form-group"><label>Project (ES)</label><input type="text" id="inProjectEs" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (ES)</label><textarea id="inTitleEs" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (ES)</label><textarea id="inBodyEs" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>

                            <button class="btn-save" onclick="addPost()">ãƒªã‚¹ãƒˆã«è¿½åŠ  (ä¸€æ™‚ä¿å­˜)</button>
                            <button class="btn-copy" onclick="saveToGitHub()">ğŸš€ GitHubã¸ç›´æ¥ä¿å­˜</button>
                        </div>

                        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (60%) -->
                        <div class="preview-area">
                            <div class="preview-header">
                                <h2 style="border:none; margin:0; font-size:1.1rem; color:#333;">ğŸ‘ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                            </div>
                            
                            <div style="margin-bottom:30px;">
                                <span class="preview-label">â–¼ ãŠçŸ¥ã‚‰ã› (News List)</span>
                                <div class="news-item">
                                    <span class="news-date" id="prevDate">2026.03.15</span>
                                    <span class="news-tag tag-update" id="prevTag">æ›´æ–°æƒ…å ±</span>
                                    <div style="flex:1;">
                                        <span style="font-weight:bold; margin-right:10px; color:#333;" id="prevProjectName">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                        <span class="news-link" id="prevTitle">ã‚¿ã‚¤ãƒˆãƒ«</span>
                                    </div>
                                </div>
                            </div>

                            <div class="preview-split-row">
                                <!-- å·¦: æœ€æ–°ã®æ´»å‹• -->
                                <div class="split-col left">
                                    <span class="preview-label" style="margin-bottom:10px;">â–¼ æœ€æ–°ã®æ´»å‹• (Highlights)</span>
                                    <div class="highlight-card" id="prevHighlightCard">
                                        <div class="highlight-img-area">
                                            <img src="" alt="No Image" id="prevImg" class="highlight-img">
                                            <span class="highlight-category-badge tag-update" id="prevCardCatBadge">æ›´æ–°æƒ…å ±</span>
                                        </div>
                                        <div class="highlight-content-tight">
                                            <div class="highlight-meta" style="padding:0 10px;">
                                                <span class="meta-date" id="prevCardDate">2026.03.15</span> | 
                                                <span class="meta-proj" id="prevCardProj">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                            </div>
                                            <!-- ä¿®æ­£: 18æ–‡å­—Ã—3è¡Œ -->
                                            <div class="highlight-title-tight" id="prevCardTitle" style="padding:0 10px 10px 10px;">ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- å³: ã‚¢ãƒ—ãƒªç´¹ä»‹ -->
                                <div class="split-col right">
                                    <span class="preview-label" style="margin-bottom:10px;">â–¼ ã‚¢ãƒ—ãƒªç´¹ä»‹ (App List)</span>
                                    <div class="highlight-card">
                                        <div class="highlight-img-area">
                                            <img src="" alt="No Image" id="prevAppImg" class="highlight-img">
                                            <div id="comingSoonOverlay" class="coming-soon-overlay">Coming Soon</div>
                                            <!-- ä¿®æ­£: å·¦ä¸‹éš…ã«è‰²ä»˜ãæ  -->
                                            <div class="project-name-badge" id="prevAppProj">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</div>
                                        </div>
                                        <!-- ä¿®æ­£: ä½™ç™½å‰Šæ¸› -->
                                        <div class="app-desc-content">
                                            <!-- ä¿®æ­£: 20æ–‡å­—Ã—4è¡Œ -->
                                            <div class="app-desc-text" id="prevAppDesc">
                                                ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <span class="preview-label">â–¼ è©³ç´°ãƒšãƒ¼ã‚¸ (Project Page)</span>
                            <!-- å®Ÿéš›ã®ãƒšãƒ¼ã‚¸ãŒã‚ã‚‹å ´åˆã¯iframeã€ãªã‘ã‚Œã°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
                            <div id="livePreviewContainer" style="display:none; margin-top:10px;">
                                <p style="font-size:0.8rem; color:#0056b3;">ğŸŒ å…¬é–‹ä¸­ã®ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ (<a id="liveLink" href="#" target="_blank">åˆ¥çª“ã§é–‹ã</a>)</p>
                                <iframe id="livePreviewFrame" style="width:100%; height:400px; border:1px solid #ccc; border-radius:8px; background:white;"></iframe>
                            </div>
                            
                            <div id="simulatedPreviewContainer" class="page-preview">
                                <h1 id="prevPageTitle">ã‚¿ã‚¤ãƒˆãƒ«</h1>
                                <div style="color:#666; font-size:0.9rem; margin-bottom:20px;">
                                    <span id="prevPageDate">---</span> | <span id="prevPageProject">---</span>
                                </div>
                                <img src="" id="prevPageImg" style="display:none;">
                                <div id="prevBody">æœ¬æ–‡...</div> <!-- ã“ã“ã¯ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ã§ã¯ãªãã€å›ºå®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æƒ³å®šã§ã™ãŒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã«è¡¨ç¤º -->
                            </div>
                        </div>
                    </div>
                </div>

<div id="panel-projects" class="panel">
                    <div class="calc-container">
                        <h2>ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</h2>
                        <p>ã“ã“ã§ç™»éŒ²ã•ã‚ŒãŸã‚¢ãƒ—ãƒªä¸€è¦§ï¼ˆapps_list.jsï¼‰ã‚’ç®¡ç†ã—ã¾ã™ï¼ˆå®Ÿè£…æº–å‚™ä¸­ï¼‰</p>
                    </div>
                </div>
                
                <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ‘ãƒãƒ« -->
                <div id="panel-users" class="panel">
                    <div class="calc-container">
                        <h2>ğŸ‘¥ ç·¨é›†æ¨©é™è€…ã®ç®¡ç†</h2>
                        <p style="margin-bottom:20px; color:#aaa; font-size:0.9rem;">
                            ã“ã“ã§ç™»éŒ²ã•ã‚ŒãŸGitHubãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ã¿ãŒã€ã“ã®ç®¡ç†ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ã€‚<br>
                            ç¾åœ¨ã®ãƒªã‚¹ãƒˆ: <strong>allowed_users.js</strong>
                        </p>
                        
                        <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
                        <div style="display:flex; gap:10px; margin-bottom:20px;">
                            <input type="text" id="newUserId" placeholder="GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼ID" class="input-white" style="flex:1;">
                            <button class="btn-save" style="width:auto; margin-top:0;" onclick="addUser()">è¿½åŠ </button>
                        </div>

                        <!-- ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                        <ul id="userList" style="background:#1e1e1e; padding:20px; border-radius:8px; list-style:none; max-height:300px; overflow-y:auto; border:1px solid #444;">
                            <!-- JSã§ã“ã“ã«ãƒªã‚¹ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ -->
                        </ul>

                        <button class="btn-copy" onclick="saveUsersToGitHub()">ğŸ’¾ æ¨©é™è¨­å®šã‚’GitHubã«ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // â–¼â–¼â–¼ è¨­å®š â–¼â–¼â–¼
        const GITHUB_CONFIG = { owner: "KeiAppLab", repo: "KeiAppLab" };
        
        // admin_master.js ã¯ç®¡ç†è€…ç”¨ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨
        const MASTER_FILE = "admin_master.js";
    
        let previewLang = 'ja';
        let currentProjectId = ""; // è¨ˆç®—ã•ã‚ŒãŸç¾åœ¨ã®ID
        let isProjectExisting = false; // ãƒ•ã‚©ãƒ«ãƒ€ãŒå­˜åœ¨ã™ã‚‹ã‹
    
        // --- èªè¨¼ç³» ---
        async function checkIdentity(optToken) {
            // ä¿®æ­£: å¼•æ•°(optToken)ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’æœ€å„ªå…ˆã—ã€ãªã‘ã‚Œã°å…¥åŠ›æ¬„ã‚’è¦‹ã‚‹
            // ã“ã‚Œã«ã‚ˆã‚Šã€localStorageã‹ã‚‰ã®è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ãŒç¢ºå®Ÿã«ãªã‚Šã¾ã™
            const tokenInputVal = document.getElementById('tokenInput').value.trim();
            const token = (typeof optToken === 'string' && optToken) ? optToken : tokenInputVal;
            
            const status = document.getElementById('authStatus');
            
            if (!token) { 
                if(status) {
                    status.innerText = "âš ï¸ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›"; 
                    status.style.color = "orange";
                }
                return; 
            }
            
            if(status) { status.innerText = "ç¢ºèªä¸­..."; status.style.color = "black"; }
            
            try {
                const res = await fetch("https://api.github.com/user", { headers: { Authorization: `token ${token}` } });
                if (!res.ok) throw new Error("ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³");
                const user = await res.json();
                
                // allowedUsersData ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚’å³å¯†åŒ–
                if (typeof allowedUsersData !== 'undefined' && Array.isArray(allowedUsersData) && allowedUsersData.includes(user.login)) {
                    localStorage.setItem('gh_token', token);
                    showDashboard();
                } else { 
                    if(status) {
                        status.innerText = "âŒ æœªè¨±å¯ID: " + user.login; 
                        status.style.color = "red";
                    }
                }
            } catch (err) { 
                if(status) {
                    status.innerText = "âš ï¸ " + err.message; 
                    status.style.color = "red";
                }
            }
        }
    
        function showDashboard() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainWrapper').style.display = 'block';
            initImageSelector(); 
            // åˆæœŸçŠ¶æ…‹ã§ã¯admin_masterãŒã‚ã‚Œã°ãã‚Œã‚’èª­ã¿è¾¼ã‚€ç­‰ã®å‡¦ç†ã‚’å…¥ã‚Œã¦ã‚‚è‰¯ã„
        }
        function logout() { localStorage.removeItem('gh_token'); location.reload(); }
        window.addEventListener('load', () => {
            const t = localStorage.getItem('gh_token'); if(t) checkIdentity(); renderUserList();
        });
    
        // --- ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ ---
        function switchPanel(id) {
            document.querySelectorAll('.panel').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(e => e.classList.remove('active'));
            document.getElementById('panel-' + id).classList.add('active');
            event.currentTarget.classList.add('active');
        }
    
        // --- IDç”Ÿæˆã¨å­˜åœ¨ãƒã‚§ãƒƒã‚¯ ---
        function generateProjectId() {
            const enName = document.getElementById('inProjectEn').value;
            const display = document.getElementById('generatedIdDisplay');
            const warning = document.getElementById('idWarning');
            
            if (!enName) {
                currentProjectId = "";
                display.innerText = "---";
                warning.style.display = "inline";
                return;
            }
    
            // è‹±èªåã‹ã‚‰IDç”Ÿæˆ (å°æ–‡å­—åŒ–ã€ã‚¹ãƒšãƒ¼ã‚¹ã‚’ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã«ã€è‹±æ•°å­—ä»¥å¤–å‰Šé™¤)
            currentProjectId = enName.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
            display.innerText = currentProjectId;
            warning.style.display = "none";
    
            // IDãŒç¢ºå®šã—ãŸã‚‰ã€å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã¨ç”»åƒãƒªã‚¹ãƒˆæ›´æ–°ã‚’è¡Œã†ï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¨å¥¨ã ãŒä»Šå›ã¯ç›´å‘¼ã³å‡ºã—ï¼‰
            checkProjectStatus();
        }
    
        // GitHubä¸Šã®ãƒ•ã‚©ãƒ«ãƒ€å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã¨ç”»åƒãƒªã‚¹ãƒˆå–å¾—
        async function checkProjectStatus() {
            if(!currentProjectId) return;
            const token = localStorage.getItem("gh_token");
            if(!token) return;
    
            // 1. ãƒ•ã‚©ãƒ«ãƒ€ç¢ºèª (ç”»åƒãƒªã‚¹ãƒˆå–å¾—ã‚’å…¼ã­ã‚‹)
            try {
                const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${currentProjectId}`, {
                    headers: { Authorization: `token ${token}` }
                });
                
                if (res.ok) {
                    isProjectExisting = true;
                    const files = await res.json();
                    // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«(.png, .jpg)ã ã‘æŠ½å‡º
                    const images = files.filter(f => f.name.match(/\.(png|jpg|jpeg)$/i)).map(f => f.name);
                    updateImageSelector(images, true); // true = å°‚ç”¨ãƒ•ã‚©ãƒ«ãƒ€
                } else {
                    isProjectExisting = false;
                    // å­˜åœ¨ã—ãªã„å ´åˆã¯ index_phot.js ã®ã‚¹ãƒˆãƒƒã‚¯ç”»åƒã‚’è¡¨ç¤º
                    const stockImages = (typeof photoList !== 'undefined') ? photoList : ["no_image.png"];
                    updateImageSelector(stockImages, false); // false = ã‚¹ãƒˆãƒƒã‚¯
                }
            } catch(e) { console.error(e); }
    
            // 2. HTMLå­˜åœ¨ç¢ºèª (ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨)
            try {
                const resHtml = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${currentProjectId}/index.html`, {
                    method: "HEAD", headers: { Authorization: `token ${token}` }
                });
                
                const liveContainer = document.getElementById('livePreviewContainer');
                const simContainer = document.getElementById('simulatedPreviewContainer');
                const iframe = document.getElementById('livePreviewFrame');
                const liveLink = document.getElementById('liveLink');
    
                if (resHtml.ok) {
                    // ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹ -> iframeè¡¨ç¤º
                    const liveUrl = `https://${GITHUB_CONFIG.owner.toLowerCase()}.github.io/${GITHUB_CONFIG.repo}/${currentProjectId}/index.html`;
                    liveContainer.style.display = 'block';
                    simContainer.style.display = 'none';
                    iframe.src = liveUrl;
                    liveLink.href = liveUrl;
                } else {
                    // ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã—ãªã„ -> ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
                    liveContainer.style.display = 'none';
                    simContainer.style.display = 'block';
                }
            } catch(e) { console.error(e); }
        }
    
        // --- ç”»åƒé¸æŠUI ---
        function initImageSelector() {
            // åˆæœŸã¯ã‚¹ãƒˆãƒƒã‚¯ç”»åƒ
            const stockImages = (typeof photoList !== 'undefined') ? photoList : ["no_image.png"];
            updateImageSelector(stockImages, false);
        }
    
        function updateImageSelector(list, isCustomFolder) {
            const container = document.getElementById('imageOptions');
            container.innerHTML = '';
            const pathPrefix = isCustomFolder ? `${currentProjectId}/` : "index_phot/";
    
            list.forEach(name => {
                const div = document.createElement('div');
                div.className = 'custom-option';
                div.onclick = () => { selectImage(pathPrefix + name, name); };
                // GitHub APIçµŒç”±ã ã¨raw_urlãŒç¢ºå®Ÿã ãŒã€ã“ã“ã§ã¯ç°¡æ˜“çš„ã«æ§‹ç¯‰
                const imgUrl = isCustomFolder 
                    ? `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/main/${currentProjectId}/${name}`
                    : `index_phot/${name}`;
                
                div.innerHTML = `<img src="${imgUrl}" class="option-img" onerror="this.src='https://via.placeholder.com/75'"><span class="option-text">${name}</span>`;
                container.appendChild(div);
            });
        }
    
        function toggleImageSelect() { document.querySelector('.custom-select').classList.toggle('open'); }
        function selectImage(fullPath, fileName) {
            document.getElementById('inImage').value = fullPath;
            document.getElementById('selectedImageText').textContent = fileName;
            document.querySelector('.custom-select').classList.remove('open');
            updatePreview();
        }
        window.onclick = e => { if(!e.target.closest('.custom-select')) document.querySelector('.custom-select').classList.remove('open'); }
    
        // --- ã‚¨ãƒ‡ã‚£ã‚¿ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼é–¢é€£ ---
        const today = new Date();
        document.getElementById('inDate').value = today.getFullYear() + '.' + (today.getMonth()+1).toString().padStart(2,'0') + '.' + today.getDate().toString().padStart(2,'0');
    
        function switchEditorLang(lang) {
            document.querySelectorAll('.lang-input-group').forEach(e => e.classList.remove('active'));
            document.getElementById('group-' + lang).classList.add('active');
            document.querySelectorAll('.edit-tab').forEach(e => e.classList.remove('active'));
            event.currentTarget.classList.add('active');
            previewLang = lang; updatePreview();
        }
    
        function updatePreview() {
            const date = document.getElementById('inDate').value;
            const cat = document.getElementById('inCategory').value;
            const imgPath = document.getElementById('inImage').value;
            
            // è¨€èªã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹
            const s = previewLang === 'ja' ? '' : previewLang.charAt(0).toUpperCase() + previewLang.slice(1);
            
            const proj = document.getElementById('inProject' + s).value || "Project";
            const title = document.getElementById('inTitle' + s).value || "News/Catchcopy";
            const body = document.getElementById('inBody' + s).value || "App Introduction..."; // ç´¹ä»‹æ–‡
            
            const statusRadio = document.querySelector('input[name="appStatus"]:checked');
            const isComing = statusRadio && statusRadio.value === 'coming';
    
            // ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ
            document.getElementById('prevDate').textContent = date;
            document.getElementById('prevTitle').textContent = title; // ãŠçŸ¥ã‚‰ã›ã‚’è¡¨ç¤º
            document.getElementById('prevProjectName').textContent = proj;
            const tag = document.getElementById('prevTag');
            tag.className = 'news-tag tag-' + cat;
            // ç°¡æ˜“ç¿»è¨³ãƒãƒƒãƒ—
            const catMap = {ja:{'update':'æ›´æ–°æƒ…å ±','release':'ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹'}, en:{'update':'Update','release':'Release'}}; // çœç•¥
            tag.textContent = (catMap[previewLang] && catMap[previewLang][cat]) ? catMap[previewLang][cat] : cat;
    
            // ç”»åƒè¡¨ç¤º (ãƒ‘ã‚¹ãŒ http ã§å§‹ã¾ã‚‰ãªã„å ´åˆã¯ç›¸å¯¾ãƒ‘ã‚¹ã¨ã—ã¦å‡¦ç†)
            const displayImg = imgPath.startsWith('http') ? imgPath : (imgPath || "");
            const setImg = (id) => {
                const el = document.getElementById(id); 
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã«raw contentç­‰ã‚’è¡¨ç¤ºã™ã‚‹ã®ã¯é›£ã—ã„ã®ã§ã€ç›¸å¯¾ãƒ‘ã‚¹ã®å ´åˆã¯ä¸€æ—¦éè¡¨ç¤ºã‹ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
                // å®Ÿè£…ç°¡ç•¥åŒ–ã®ãŸã‚ã€ãã®ã¾ã¾srcã«å…¥ã‚Œã‚‹
                el.src = displayImg;
                el.style.display = displayImg ? 'block' : 'none';
            };
            setImg('prevImg'); setImg('prevAppImg'); setImg('prevPageImg');
    
            // ã‚«ãƒ¼ãƒ‰
            document.getElementById('prevCardTitle').textContent = title; // ãŠçŸ¥ã‚‰ã›
            document.getElementById('prevCardProj').textContent = proj;
            document.getElementById('prevCardDate').textContent = date;
            const badge = document.getElementById('prevCardCatBadge');
            badge.textContent = tag.textContent; badge.className = 'highlight-category-badge tag-' + cat;
    
            // ã‚¢ãƒ—ãƒªç´¹ä»‹
            document.getElementById('prevAppProj').textContent = proj;
            document.getElementById('prevAppDesc').textContent = body; // ç´¹ä»‹æ–‡
            const overlay = document.getElementById('comingSoonOverlay');
            const appImgEl = document.getElementById('prevAppImg');
            if(isComing) { appImgEl.classList.add('coming-soon-mode'); overlay.style.display='block'; }
            else { appImgEl.classList.remove('coming-soon-mode'); overlay.style.display='none'; }
    
            // è©³ç´°ãƒšãƒ¼ã‚¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            document.getElementById('prevPageTitle').textContent = proj; // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
            document.getElementById('prevPageDate').textContent = date;
            document.getElementById('prevPageProject').textContent = proj;
            document.getElementById('prevBody').innerHTML = body; // ç´¹ä»‹æ–‡
        }
    
        // --- è‡ªå‹•å…¥åŠ› (admin_master.js ã‹ã‚‰) ---
        function autoFillProject() {
            const val = document.getElementById('inProject').value.trim();
            
            // å…¨å…¥åŠ›æ¬„ã®IDãƒªã‚¹ãƒˆ
            const keys = {
                ja: ['inProject', 'inTitle', 'inBody'],
                en: ['inProjectEn', 'inTitleEn', 'inBodyEn'],
                de: ['inProjectDe', 'inTitleDe', 'inBodyDe'],
                fr: ['inProjectFr', 'inTitleFr', 'inBodyFr'],
                es: ['inProjectEs', 'inTitleEs', 'inBodyEs']
            };
    
            // 1. ç©ºæ¬„ã«ãªã£ãŸã‚‰å…¨ã¦ã‚¯ãƒªã‚¢
            if (!val) {
                Object.values(keys).flat().forEach(id => document.getElementById(id).value = "");
                document.getElementById('inImage').value = "";
                document.getElementById('selectedImageText').textContent = "ç”»åƒã‚’é¸æŠ...";
                
                // IDç”Ÿæˆã‚‚ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('inProjectEn').value = "";
                generateProjectId(); // IDè¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
                updatePreview();
                return;
            }
    
            // 2. admin_master.js (adminMasterData) ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’æ¢ã™
            let sourceData = [];
            if (typeof adminMasterData !== 'undefined') {
                sourceData = adminMasterData;
            } 
    
            if (sourceData.length > 0) {
                // æ—¥æœ¬èªã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãŒä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’æ¢ã™
                // (æ–°ãƒ‡ãƒ¼ã‚¿æ§‹é€ : p.ja.proj / æ—§ãƒ‡ãƒ¼ã‚¿æ§‹é€ : p.project)
                const post = sourceData.find(p => {
                    if (p.ja && p.ja.proj) return p.ja.proj === val; // æ–°æ§‹é€ 
                    if (p.project) return p.project === val;         // æ—§æ§‹é€ 
                    return false;
                });
    
                if (post) {
                    // --- ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã®åæ˜ å‡¦ç† ---
    
                    // A. æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€  (admin_master.jså½¢å¼) ã®å ´åˆ
                    if (post.ja) {
                        // å„è¨€èªã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆ
                        ['ja', 'en', 'de', 'fr', 'es'].forEach(lang => {
                            document.getElementById(keys[lang][0]).value = post[lang].proj || "";
                            document.getElementById(keys[lang][1]).value = post[lang].title || "";
                            document.getElementById(keys[lang][2]).value = post[lang].body || "";
                        });
                        
                        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (released / coming)
                        if (post.status) {
                            const radios = document.getElementsByName('appStatus');
                            for (const radio of radios) {
                                if (radio.value === post.status) radio.checked = true;
                            }
                        }
                    } 
                        
                    // ç”»åƒãƒ‘ã‚¹ã®ã‚»ãƒƒãƒˆ
                    const imgPath = post.image || "";
                    document.getElementById('inImage').value = imgPath;
                    document.getElementById('selectedImageText').textContent = imgPath.split('/').pop() || "ç”»åƒã‚’é¸æŠ...";
    
                    // â˜…é‡è¦: è‹±èªåãŒå…¥ã£ãŸã®ã§ã€IDã‚’å†ç”Ÿæˆã—ã¦ãƒ•ã‚©ãƒ«ãƒ€ãƒã‚§ãƒƒã‚¯ã‚’èµ°ã‚‰ã›ã‚‹
                    generateProjectId();
                    
                    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
                    updatePreview();
                }
            }
        }
    
    
        // â–¼â–¼â–¼ ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ (æœ€é‡è¦) â–¼â–¼â–¼
        
        // ãƒ˜ãƒ«ãƒ‘ãƒ¼: GitHub API (GET)
        async function getFileContent(filename) {
            const token = localStorage.getItem("gh_token");
            try {
                const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filename}`, {
                    headers: { Authorization: `token ${token}`, "Cache-Control": "no-cache" }
                });
                if (!res.ok) return null;
                const data = await res.json();
                const content = decodeURIComponent(escape(atob(data.content)));
                // JSãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰JSONéƒ¨åˆ†ã‚’æŠœãå‡ºã™ç°¡æ˜“ãƒ‘ãƒ¼ã‚µ
                const match = content.match(/const\s+\w+\s*=\s*(\[.*\])/s) || content.match(/const\s+\w+\s*=\s*(\{.*\})/s);
                if (match) return { sha: data.sha, data: JSON.parse(match[1]) };
                return { sha: data.sha, data: [] };
            } catch (e) { return null; }
        }
    
        // ãƒ˜ãƒ«ãƒ‘ãƒ¼: GitHub API (PUT)
        async function saveFileContent(filename, varName, jsonData, sha, message) {
            const token = localStorage.getItem("gh_token");
            const contentStr = `// Generated by Admin\nconst ${varName} = ${JSON.stringify(jsonData, null, 4)};`;
            const encoded = btoa(unescape(encodeURIComponent(contentStr)));
            
            await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filename}`, {
                method: "PUT",
                headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify({ message: message, content: encoded, sha: sha })
            });
        }
    
        // ãƒ¡ã‚¤ãƒ³ä¿å­˜é–¢æ•°
        async function saveToGitHub() {
            const token = localStorage.getItem("gh_token");
            if (!token) { alert("èªè¨¼ãŒå¿…è¦ã§ã™"); return; }
            if (!currentProjectId) { alert("è‹±èªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå(ID)ãŒå¿…é ˆã§ã™"); return; }
            if (!confirm(`5ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™ã€‚\nID: ${currentProjectId}\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) return;
    
            // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®åé›†
            const statusVal = document.querySelector('input[name="appStatus"]:checked').value;
            const date = document.getElementById('inDate').value;
            const cat = document.getElementById('inCategory').value;
            const imgPath = document.getElementById('inImage').value; // ä¾‹: index_phot/hero.jpg ã¾ãŸã¯ kei_rpg/hero.png
            
            // å¤šè¨€èªãƒ‡ãƒ¼ã‚¿åé›†
            const langs = ['ja', 'en', 'de', 'fr', 'es'];
            const data = {};
            langs.forEach(l => {
                const s = l === 'ja' ? '' : l.charAt(0).toUpperCase() + l.slice(1);
                data[l] = {
                    proj: document.getElementById('inProject' + s).value,
                    title: document.getElementById('inTitle' + s).value, // ãŠçŸ¥ã‚‰ã›
                    body: document.getElementById('inBody' + s).value    // ç´¹ä»‹æ–‡
                };
            });
    
            // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã®æ±ºå®š
            let finalImageName = "index.png"; // çµ±ä¸€
            const finalImagePath = `${currentProjectId}/${finalImageName}`;
    
            try {
                // ---------------------------------------------------------
                // 1. admin_master.js (ç®¡ç†è€…ç”¨ãƒ»å…¨å…¥åŠ›ãƒ‡ãƒ¼ã‚¿æœ€æ–°1ä»¶)
                // ---------------------------------------------------------
                const masterRes = await getFileContent(MASTER_FILE);
                let masterData = masterRes ? masterRes.data : [];
                // IDã§æ¤œç´¢ã—ã€ã‚ã‚Œã°å‰Šé™¤ã—ã¦å…ˆé ­ã«è¿½åŠ ï¼ˆä¸Šæ›¸ãï¼‰
                masterData = masterData.filter(d => d.id !== currentProjectId);
                masterData.unshift({
                    id: currentProjectId,
                    status: statusVal,
                    image: finalImagePath,
                    ...data // å…¨è¨€èªã® proj, title, body
                });
                await saveFileContent(MASTER_FILE, "adminMasterData", masterData, masterRes ? masterRes.sha : null, `Update Master: ${currentProjectId}`);
    
    
                // ---------------------------------------------------------
                // 2. index_news.js (ãƒˆãƒƒãƒ—ç”¨ãƒ»æœ€æ–°20ä»¶ãƒ»æœ¬æ–‡ãªã—)
                // ---------------------------------------------------------
                const indexNewsRes = await getFileContent("index_news.js");
                let indexNews = indexNewsRes ? indexNewsRes.data : [];
                
                // æ–°è¦ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
                const newNewsItem = {
                    date: date,
                    category: cat,
                    id: currentProjectId,
                    image: finalImagePath,
                    link: `${currentProjectId}/index.html`,
                    project: {}, title: {}
                };
                langs.forEach(l => {
                    newNewsItem.project[l] = data[l].proj;
                    newNewsItem.title[l] = data[l].title; // ãŠçŸ¥ã‚‰ã›ã®ã¿
                });
    
                indexNews.unshift(newNewsItem);
                
                // ãƒªãƒªãƒ¼ã‚¹æ (release, start, steam) æœ€æ–°10ä»¶
                const releaseTypes = ['release', 'start', 'steam'];
                const releaseItems = indexNews.filter(n => releaseTypes.includes(n.category)).slice(0, 10);
                
                // æ›´æ–°æ (update, game) æœ€æ–°10ä»¶
                const updateTypes = ['update', 'game'];
                const updateItems = indexNews.filter(n => updateTypes.includes(n.category)).slice(0, 10);
                
                // åˆä½“ã—ã¦æ—¥ä»˜é †ã‚½ãƒ¼ãƒˆï¼ˆå¿µã®ãŸã‚ï¼‰
                const finalIndexNews = [...releaseItems, ...updateItems].sort((a,b) => b.date.localeCompare(a.date));
                
                await saveFileContent("index_news.js", "indexNewsData", finalIndexNews, indexNewsRes ? indexNewsRes.sha : null, `Update Index News: ${currentProjectId}`);
    
    
                // ---------------------------------------------------------
                // 3. apps_catalog.js (ä¸€è¦§ç”¨ãƒ»ç´¹ä»‹æ–‡ã®ã¿)
                // ---------------------------------------------------------
                const catalogRes = await getFileContent("apps_catalog.js");
                let catalogData = catalogRes ? catalogRes.data : [];
                // IDã§æ¤œç´¢ã—ä¸Šæ›¸ã
                catalogData = catalogData.filter(d => d.id !== currentProjectId);
                
                const newCatalogItem = {
                    id: currentProjectId,
                    status: statusVal,
                    image: finalImagePath,
                    project: {}, body: {}
                };
                langs.forEach(l => {
                    newCatalogItem.project[l] = data[l].proj;
                    newCatalogItem.body[l] = data[l].body; // ç´¹ä»‹æ–‡ã®ã¿
                });
                
                catalogData.unshift(newCatalogItem); // å…ˆé ­ã«è¿½åŠ 
                await saveFileContent("apps_catalog.js", "appsCatalogData", catalogData, catalogRes ? catalogRes.sha : null, `Update Catalog: ${currentProjectId}`);
    
    
                // ---------------------------------------------------------
                // 4. [id]/news.js (å€‹åˆ¥æœ€æ–°ãƒ»3ä»¶)
                // ---------------------------------------------------------
                const projectNewsPath = `${currentProjectId}/news.js`;
                const projNewsRes = await getFileContent(projectNewsPath); // ãªã‘ã‚Œã°null
                let projNews = projNewsRes ? projNewsRes.data : [];
    
                const newProjNewsItem = {
                    date: date,
                    category: cat,
                    title: {} // ãŠçŸ¥ã‚‰ã›ã®ã¿
                };
                langs.forEach(l => newProjNewsItem.title[l] = data[l].title);
    
                projNews.unshift(newProjNewsItem);
                projNews = projNews.slice(0, 3); // æœ€æ–°3ä»¶
    
                // ãƒ•ã‚©ãƒ«ãƒ€ãŒãªã„å ´åˆã¯å†å¸°çš„ã«ä½œã‚‰ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚‚ä½œã‚‰ã‚Œã‚‹(GitHubä»•æ§˜)
                await saveFileContent(projectNewsPath, "projectNewsData", projNews, projNewsRes ? projNewsRes.sha : null, `Update Project News: ${currentProjectId}`);
    
    
                // ---------------------------------------------------------
                // 5. [id]/old_news.js (ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ»å…¨ä»¶)
                // ---------------------------------------------------------
                const oldNewsPath = `${currentProjectId}/old_news.js`;
                const oldNewsRes = await getFileContent(oldNewsPath);
                let oldNews = oldNewsRes ? oldNewsRes.data : [];
                oldNews.unshift(newProjNewsItem); // è¿½åŠ ã®ã¿ã€å‰Šé™¤ãªã—
                await saveFileContent(oldNewsPath, "oldNewsData", oldNews, oldNewsRes ? oldNewsRes.sha : null, `Update Archive: ${currentProjectId}`);
    
    
                // ---------------------------------------------------------
                // 6. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ™‚ã®å‡¦ç† (ç”»åƒã‚³ãƒ”ãƒ¼ãƒ»HTMLç”Ÿæˆ)
                // ---------------------------------------------------------
                if (!isProjectExisting) {
                    // A. ç”»åƒã‚³ãƒ”ãƒ¼ (index_phot/[file] -> [id]/index.png)
                    // imgPath ãŒ "index_phot/..." ã®å ´åˆã®ã¿
                    if (imgPath.startsWith("index_phot/")) {
                        const imgName = imgPath.split('/').pop();
                        const imgRes = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/index_phot/${imgName}`, {
                             headers: { Authorization: `token ${token}` }
                        });
                        if (imgRes.ok) {
                            const imgData = await imgRes.json();
                            // contentã¯base64ãªã®ã§ãã®ã¾ã¾æ›¸ãè¾¼ã‚ã°ã‚³ãƒ”ãƒ¼ã«ãªã‚‹
                            await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${finalImagePath}`, {
                                method: "PUT",
                                headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    message: `Create Image: ${currentProjectId}`,
                                    content: imgData.content // Base64ãã®ã¾ã¾
                                })
                            });
                        }
                    }
    
                    // B. HTMLç”Ÿæˆ
                    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆHTMLã‚’ä½œæˆã—ã¦ä¿å­˜
                    const htmlContent = `<!DOCTYPE html>
                        <html lang="ja">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <title>${data.ja.proj} | KEI App Lab</title>
                            <!-- å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ç­‰ã®èª­ã¿è¾¼ã¿ -->
                            <link rel="stylesheet" href="../style.css">
                            <!-- ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ -->
                            <script src="news.js"></script>
                            <script src="old_news.js"></script>
                        </head>
                        <body>
                            <h1>${data.ja.proj}</h1>
                            <div id="app-content">
                                <!-- JSã§news.jsã®å†…å®¹ãªã©ã‚’è¡¨ç¤ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã“ã“ã«æ›¸ã -->
                                <p>Loading...</p>
                            </div>
                        </body>
                        </html>`;
                    const encodedHtml = btoa(unescape(encodeURIComponent(htmlContent)));
                    await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${currentProjectId}/index.html`, {
                        method: "PUT",
                        headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                        body: JSON.stringify({
                            message: `Create HTML: ${currentProjectId}`,
                            content: encodedHtml
                        })
                    });
                }
    
                alert("âœ… å…¨ã¦ã®ä¿å­˜å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
                // çŠ¶æ…‹æ›´æ–°
                checkProjectStatus();
    
            } catch (e) {
                console.error(e);
                alert("âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + e.message);
            }
        }
    
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç³»ï¼ˆçœç•¥ãªã—ï¼‰
        function renderUserList() {
            const list = document.getElementById('userList');
            if(!list) return;
            list.innerHTML = '';
            if (typeof allowedUsersData !== 'undefined' && Array.isArray(allowedUsersData)) {
                allowedUsersData.forEach((user, index) => {
                    const li = document.createElement('li');
                    li.style = "display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #333; color:#fff;";
                    li.innerHTML = `<span style="font-weight:bold;">${user}</span><button style="background:#c0392b; width:auto; padding:5px 10px; font-size:0.8rem; margin:0;" onclick="removeUser(${index})">å‰Šé™¤</button>`;
                    list.appendChild(li);
                });
            }
        }
        function addUser() {
            const input = document.getElementById('newUserId');
            const id = input.value.trim();
            if(!id) return;
            if(allowedUsersData.includes(id)) { alert("æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™"); return; }
            allowedUsersData.push(id); input.value = ''; renderUserList();
        }
        function removeUser(index) { if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) { allowedUsersData.splice(index, 1); renderUserList(); } }
        async function saveUsersToGitHub() {
            const token = localStorage.getItem("gh_token");
            if (!token) return;
            const jsonString = JSON.stringify(allowedUsersData, null, 4);
            const content = `// ç·¨é›†æ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆ\nconst allowedUsersData = ${jsonString};`;
            const encodedContent = btoa(unescape(encodeURIComponent(content)));
            const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/allowed_users.js`, { headers: { Authorization: `token ${token}` } });
            const data = await res.json();
            await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/allowed_users.js`, {
                method: "PUT",
                headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify({ message: "Update users", content: encodedContent, sha: data.sha })
            });
            alert("æ¨©é™è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸ");
        }
        function calcSeconds() { /* è¨ˆç®—æ©Ÿãƒ­ã‚¸ãƒƒã‚¯(å¤‰æ›´ãªã—) */ 
            const adPrice = parseFloat(document.getElementById('adPrice').value);
            const callCost = parseFloat(document.getElementById('callCost').value);
            const margin = parseFloat(document.getElementById('margin').value);
            const seconds = Math.floor((adPrice - (adPrice * (margin / 100))) / (callCost / 60));
            document.getElementById('calcOutput').innerText = seconds + " ç§’";
        }
    </script>
</body>
</html>
