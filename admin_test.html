<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEI Lab ãƒã‚¹ã‚¿ãƒ¼ãƒ»ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ</title>

    <!-- å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ -->
    <script src="news-data.js"></script>
    <script src="allowed_users.js"></script>
    <script src="index_phot.js"></script> <!-- ç”»åƒãƒªã‚¹ãƒˆ -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@400;500;900&display=swap');

        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: #1e1e1e; color: #ddd; height: 100vh; overflow: hidden; }
        #mainWrapper { display: none; height: 100%; }

        /* --- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-container-split { display: flex; width: 800px; height: 500px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-left { width: 40%; padding: 40px; display: flex; flex-direction: column; justify-content: center; background: #f9f9f9; border-right: 1px solid #eee; }
        .login-left input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ccc; border-radius: 5px; }
        .login-left button { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login-right { width: 60%; padding: 40px; overflow-y: auto; color: #333; line-height: 1.6; }

        /* --- ãƒ¡ã‚¤ãƒ³ç”»é¢ --- */
        .dashboard { display: grid; grid-template-columns: 250px 1fr; height: 100%; }
        .sidebar { background: #252526; border-right: 1px solid #333; padding: 10px; }
        .sidebar h1 { font-size: 1.2rem; color: #fff; margin: 20px 10px; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
        .menu-btn { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 5px; color: #aaa; font-weight: bold; transition: 0.2s; }
        .menu-btn:hover { background: #3c3c3c; color: #fff; }
        .menu-btn.active { background: #007acc; color: white; }

        .main-content { position: relative; overflow: hidden; height: 100%; }
        .panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; padding: 30px; box-sizing: border-box; }
        .panel.active { display: block; }

        /* --- CMSãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        .cms-layout { display: flex; height: 100%; gap: 20px; }
        .editor-area { width: 45%; overflow-y: auto; padding-right: 10px; height: 100%; }
        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢èƒŒæ™¯å¤‰æ›´ */
        .preview-area { width: 55%; background: #e0e0e0; color: #333; border-radius: 8px; overflow-y: auto; padding: 20px; height: 100%; }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-top: 5px; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #555; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .input-white { background-color: #ffffff !important; color: #333 !important; border: 1px solid #ccc !important; }
        
        /* é€£çµå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        .input-group { display: flex; width: 100%; }
        .input-group input { flex: 7; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; border-right: none !important; }
        .input-group select { flex: 3; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; background-color: #e6e6e6 !important; color: #0056b3 !important; cursor: pointer; }

        button { padding: 12px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; margin-top: 10px; width: 100%; }
        .btn-save { background: #27ae60; color: white; }
        .btn-copy { background: #e67e22; color: white; margin-top: 20px; }

        /* --- ç”»åƒé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« --- */
        #photoModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center; }
        .photo-grid { background: white; padding: 20px; border-radius: 10px; max-width: 800px; max-height: 80vh; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .photo-item { cursor: pointer; border: 2px solid transparent; border-radius: 5px; overflow: hidden; transition: 0.2s; }
        .photo-item:hover { border-color: #007acc; transform: scale(1.05); }
        .photo-item img { width: 100%; height: 100px; object-fit: cover; }
        .photo-name { font-size: 0.8rem; text-align: center; padding: 5px; color: #333; background: #f9f9f9; }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆã”è¦æœ›ã®ã‚«ãƒ¼ãƒ‰å‹ï¼‰ --- */
        .preview-label { font-size: 0.8rem; color: #666; font-weight: bold; border-bottom: 1px dashed #999; display: block; margin-bottom: 15px; margin-top: 30px; }

        /* æœ€æ–°ã®æ´»å‹•ã‚«ãƒ¼ãƒ‰ */
        .highlight-card {
            width: 300px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.15); /* æ–œã‚å³ä¸‹ã®å½± */
            margin: 0 auto; /* ä¸­å¤®å¯„ã› */
            cursor: pointer;
            transition: transform 0.2s;
        }
        .highlight-card:hover { transform: translateY(-3px); }

        /* ç”»åƒã‚¨ãƒªã‚¢ (300x200, ä¸Šä¸‹ãƒˆãƒªãƒŸãƒ³ã‚°) */
        .highlight-img-box {
            width: 300px;
            height: 200px;
            overflow: hidden;
            background: #ddd;
        }
        .highlight-img-box img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* ä¸Šä¸‹å‡ç­‰ã«ãƒˆãƒªãƒŸãƒ³ã‚° */
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ */
        .highlight-content {
            padding: 15px;
            color: #333;
        }
        .highlight-meta {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 8px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .highlight-cat {
            background: #0056b3; color: white;
            padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;
        }
        .highlight-project {
            font-weight: bold;
            color: #0056b3;
        }
        
        /* ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ (3è¡Œåˆ¶é™) */
        .highlight-title {
            font-size: 1rem;
            font-weight: bold;
            line-height: 1.5;
            height: 4.5em; /* 1.5 * 3è¡Œ */
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        /* ãŠçŸ¥ã‚‰ã›ãƒªã‚¹ãƒˆ */
        .news-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #ccc; }
        .news-date { width: 100px; font-size: 0.9rem; color: #555; }
        .news-tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; margin-right: 10px; color: white; width: 100px; text-align: center; }
        .tag-release { background: #0056b3; }
        .tag-update { background: #e67e22; }
        .news-link { font-weight: bold; color: #333; }
    </style>
</head>
<body>

    <!-- ç”»åƒé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="photoModal" onclick="this.style.display='none'">
        <div class="photo-grid" id="photoGrid" onclick="event.stopPropagation()">
            <!-- JSã§ç”»åƒãƒªã‚¹ãƒˆç”Ÿæˆ -->
        </div>
    </div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginOverlay">
        <div class="login-container-split">
            <div class="login-left">
                <h2>ğŸš€ KEI Lab Admin</h2>
                <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
                <button onclick="checkIdentity()">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>
            <div class="login-right">
                <h3>ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œæ‰‹é †</h3>
                <p>GitHubè¨­å®š > Developer settings > Personal access tokens (classic)</p>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="mainWrapper">
        <div class="dashboard">
            <div class="sidebar">
                <h1>ğŸš€ KEI Lab Admin</h1>
                <div class="menu-btn active" onclick="switchPanel('cms')">ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†</div>
                <div class="menu-btn" onclick="switchPanel('calc')">ğŸ’° åç›Šè¨ˆç®—</div>
                <div class="menu-btn" onclick="switchPanel('users')">ğŸ‘¥ æ¨©é™ç®¡ç†</div>
                <div class="menu-btn" onclick="logout()" style="margin-top:auto; background:#c0392b; color:white;">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
            </div>

            <div class="main-content">
                <!-- CMSãƒ‘ãƒãƒ« -->
                <div id="panel-cms" class="panel active">
                    <div class="cms-layout">
                        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ -->
                        <div class="editor-area">
                            <h2>ğŸ“ è¨˜äº‹ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h2>
                            
                            <div class="form-group"><label>æ—¥ä»˜</label><input type="text" id="inDate" class="input-white"></div>

                            <div class="form-group"><label>ã‚«ãƒ†ã‚´ãƒª</label>
                                <select id="inCategory" class="input-white" onchange="updatePreview()">
                                    <option value="update">æ›´æ–°æƒ…å ±</option>
                                    <option value="release">ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                                    <option value="start">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹</option>
                                    <option value="steam">Steamãƒªãƒªãƒ¼ã‚¹</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</label>
                                <div class="input-group">
                                    <input type="text" id="inProject" class="input-white" placeholder="å…¥åŠ›ã¾ãŸã¯é¸æŠ" oninput="autoFillProject()">
                                    <select id="projectSelectHelper" onchange="syncProjectSelect()">
                                        <option value="">â–¼ å±¥æ­´...</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group"><label>ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</label><input type="text" id="inTitle" class="input-white" oninput="updatePreview()"></div>

                            <!-- ç”»åƒé¸æŠï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰ -->
                            <div class="form-group">
                                <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ)</label>
                                <input type="text" id="inImage" class="input-white" placeholder="ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’é¸æŠ" readonly onclick="openPhotoModal()">
                            </div>

                            <div class="form-group"><label>è©³ç´°æœ¬æ–‡</label><textarea id="inBody" class="input-white" style="height:150px;" oninput="updatePreview()"></textarea></div>

                            <button class="btn-save" onclick="addPost()">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
                            <button class="btn-copy" onclick="saveToGitHub()">ğŸš€ GitHubã¸ä¿å­˜</button>
                        </div>

                        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                        <div class="preview-area">
                            <h2>ğŸ‘ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                            
                            <span class="preview-label">â–¼ ãŠçŸ¥ã‚‰ã› (News List)</span>
                            <div class="news-item">
                                <span class="news-date" id="prevDate">2026.03.15</span>
                                <span class="news-tag tag-update" id="prevTag">æ›´æ–°æƒ…å ±</span>
                                <div style="flex:1;">
                                    <span style="font-weight:bold; margin-right:10px;" id="prevProjectName">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                    <span id="prevTitle">ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</span>
                                </div>
                            </div>

                            <span class="preview-label">â–¼ æœ€æ–°ã®æ´»å‹• (Highlights Card)</span>
                            <!-- æ–°ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‚«ãƒ¼ãƒ‰ -->
                            <div class="highlight-card">
                                <div class="highlight-img-box">
                                    <img src="" alt="No Image" id="prevImg">
                                </div>
                                <div class="highlight-content">
                                    <div class="highlight-meta">
                                        <span class="highlight-cat" id="prevCardCat">æ›´æ–°æƒ…å ±</span>
                                        <span class="highlight-project" id="prevCardProject">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                        <span style="font-size:0.7rem;">2026.03.15</span>
                                    </div>
                                    <div class="highlight-title" id="prevCardTitle">
                                        ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚æœ€å¤§3è¡Œã¾ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ä»–ã®ãƒ‘ãƒãƒ«ï¼ˆè¨ˆç®—æ©Ÿãƒ»æ¨©é™ï¼‰ã¯çœç•¥ã›ãšå®Ÿè£…æ¸ˆã¿ã¨ä»®å®š -->
            </div>
        </div>
    </div>

    <script>
        // è¨­å®š
        const GITHUB_CONFIG = { owner: "KeiAppLab", repo: "KeiAppLab", path: "news_data.js" };

        // --- ç”»åƒé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« ---
        function openPhotoModal() {
            const modal = document.getElementById('photoModal');
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';

            if (typeof photoList !== 'undefined') {
                photoList.forEach(photo => {
                    const div = document.createElement('div');
                    div.className = 'photo-item';
                    div.innerHTML = `<img src="${photo.file}"><div class="photo-name">${photo.name}</div>`;
                    div.onclick = () => {
                        document.getElementById('inImage').value = photo.file;
                        modal.style.display = 'none';
                        updatePreview();
                    };
                    grid.appendChild(div);
                });
            } else {
                grid.innerHTML = '<p>index_phot.js ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“</p>';
            }
            modal.style.display = 'flex';
        }

        // --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–° ---
        function updatePreview() {
            const date = document.getElementById('inDate').value;
            const category = document.getElementById('inCategory').value;
            const project = document.getElementById('inProject').value;
            const title = document.getElementById('inTitle').value;
            const image = document.getElementById('inImage').value;

            // ãŠçŸ¥ã‚‰ã›
            document.getElementById('prevDate').textContent = date;
            document.getElementById('prevTitle').textContent = title;
            document.getElementById('prevProjectName').textContent = project;
            
            const tagEl = document.getElementById('prevTag');
            tagEl.className = 'news-tag tag-' + category;
            const catNames = {'release':'ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹','update':'æ›´æ–°æƒ…å ±','start':'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹','steam':'Steam','game':'ãƒŸãƒ‹ã‚²ãƒ¼ãƒ '};
            tagEl.textContent = catNames[category];

            // ã‚«ãƒ¼ãƒ‰
            document.getElementById('prevImg').src = image;
            document.getElementById('prevCardTitle').textContent = title;
            document.getElementById('prevCardProject').textContent = project;
            document.getElementById('prevCardCat').textContent = catNames[category];
        }

        // --- èªè¨¼ãƒ»ä¿å­˜ãƒ»è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ—¢å­˜ã®ã‚‚ã®ã‚’ç¶­æŒï¼‰ ---
        // (å‰å›ã®ã‚³ãƒ¼ãƒ‰ã® checkIdentity, saveToGitHub, calcSeconds ç­‰ã‚’ã“ã“ã«å«ã‚ã¾ã™)
        // â€»é•·ããªã‚‹ãŸã‚çœç•¥ã—ã¦ã„ã¾ã™ãŒã€å‰å›ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãã®ã¾ã¾ä½¿ã£ã¦ãã ã•ã„
        
        // åˆæœŸåŒ–
        const today = new Date();
        document.getElementById('inDate').value = today.getFullYear() + '.' + (today.getMonth()+1).toString().padStart(2, '0') + '.' + today.getDate().toString().padStart(2, '0');
        updatePreview();
    </script>
</body>
</html>
