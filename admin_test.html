<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEI Lab ãƒã‚¹ã‚¿ãƒ¼ãƒ»ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ</title>

    <!-- å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->
    <script src="admin_master.js"></script>
    <script src="allowed_users.js"></script>
    <script src="index_phot.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@400;500;900&display=swap');

        /* --- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: #1e1e1e; color: #ddd; height: 100vh; overflow: hidden; }
        #mainWrapper { display: none; height: 100%; }

        /* --- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { display: flex; width: 850px; height: 550px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-left { width: 40%; padding: 40px; background: #f9f9f9; border-right: 1px solid #eee; display: flex; flex-direction: column; justify-content: center; }
        .login-right { width: 60%; padding: 40px; color: #333; overflow-y: auto; }
        input[type="password"] { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { padding: 12px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; }
        .btn-login { background: #0056b3; color: white; } .btn-login:hover { background: #003d82; }

        /* --- ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        .dashboard { display: grid; grid-template-columns: 260px 1fr; height: 100%; }
        .sidebar { background: #252526; border-right: 1px solid #333; padding: 10px; display: flex; flex-direction: column; }
        .sidebar h1 { font-size: 1.2rem; color: #fff; margin: 20px 10px; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
        .menu-btn { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 5px; color: #aaa; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .menu-btn:hover { background: #3c3c3c; color: #fff; }
        .menu-btn.active { background: #007acc; color: white; }
        .spacer { flex-grow: 1; border-bottom: 1px solid #444; margin: 10px 0; }

        .main-content { position: relative; overflow: hidden; height: 100%; }
        .panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; padding: 0; }
        .panel.active { display: block; }

        /* --- CMSã‚¨ãƒªã‚¢ --- */
        .cms-container { display: flex; height: 100%; }
        .editor-col { width: 40%; padding: 30px; overflow-y: auto; background: #1e1e1e; border-right: 1px solid #333; box-sizing: border-box; }
        .preview-col { width: 60%; padding: 30px; overflow-y: auto; background: #e0e0e0; color: #333; box-sizing: border-box; }

        /* ãƒ•ã‚©ãƒ¼ãƒ éƒ¨å“ */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #555; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .input-white { background-color: #fff !important; color: #333 !important; border: 1px solid #ccc !important; }
        .input-readonly { background-color: #333 !important; color: #fff !important; border: 1px solid #555 !important; font-family: monospace; }
        
        /* å±¥æ­´ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ */
        .history-group { display: flex; }
        .history-group input { flex: 1; border-radius: 4px 0 0 4px; }
        .history-group select { flex: 1; border-radius: 0 4px 4px 0; background: #ddd; color: #0056b3; cursor: pointer; }

        /* è¨€èªã‚¿ãƒ– */
        .lang-tabs { display: flex; gap: 5px; margin-bottom: 10px; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .tab-btn { padding: 6px 12px; background: #333; color: #aaa; border: none; border-radius: 4px; cursor: pointer; width: auto; }
        .tab-btn.active { background: #007acc; color: white; }
        .lang-group { display: none; } .lang-group.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ç”»åƒé¸æŠã‚°ãƒªãƒƒãƒ‰ */
        .img-select-trigger { padding: 10px; background: #fff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; color: #333; display: flex; justify-content: space-between; align-items: center; }
        .img-grid-container { 
            display: none; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; 
            background: #fff; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-top: 5px; max-height: 200px; overflow-y: auto; 
        }
        .img-grid-container.open { display: grid; }
        .img-option { cursor: pointer; text-align: center; border: 2px solid transparent; padding: 5px; border-radius: 4px; transition: 0.2s; }
        .img-option:hover { background: #f0f8ff; border-color: #007acc; }
        .img-option img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; display: block; margin: 0 auto; }
        .img-option span { font-size: 0.7rem; color: #333; display: block; margin-top: 4px; word-break: break-all; }

        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .preview-header { font-size: 1.1rem; border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold; }
        .preview-label { font-size: 0.8rem; color: #666; font-weight: bold; margin-top: 20px; margin-bottom: 5px; display: block; border-bottom: 1px dashed #999; }
        
        .news-item-prev { display: flex; align-items: center; padding: 10px; background: #fff; border-radius: 4px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tag-badge { font-size: 0.75rem; color: white; padding: 2px 8px; border-radius: 4px; margin: 0 10px; }
        .tag-release { background: #0056b3; } .tag-update { background: #e67e22; }

        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼šã‚«ãƒ¼ãƒ‰æ¯”è¼ƒ */
        .card-compare-row { display: flex; gap: 20px; flex-wrap: wrap; }
        .card-box { flex: 1; min-width: 200px; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .card-img-area { height: 140px; background: #ddd; position: relative; }
        .card-img-area img { width: 100%; height: 100%; object-fit: cover; }
        .card-badge { position: absolute; bottom: 0; left: 0; background: #333; color: white; font-size: 0.7rem; padding: 2px 8px; border-top-right-radius: 5px; }
        .card-content { padding: 10px; }
        .card-title { font-weight: bold; font-size: 0.95rem; margin-bottom: 5px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .card-desc { font-size: 0.85rem; color: #555; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }

        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼šè©³ç´°ãƒšãƒ¼ã‚¸ (Iframe) */
        .iframe-container { width: 100%; height: 500px; border: 1px solid #ccc; background: white; border-radius: 8px; margin-top: 10px; }
        .iframe-placeholder { width: 100%; height: 500px; background: #fff; display: flex; justify-content: center; align-items: center; border-radius: 8px; color: #888; border: 1px dashed #aaa; }
        .url-bar { background: #fff; padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc; font-family: monospace; font-size: 0.85rem; color: #007acc; margin-bottom: 5px; display: flex; align-items: center; gap: 5px; }

        .btn-save { background: #27ae60; color: white; margin-top: 20px; }
        .btn-copy { background: #e67e22; color: white; margin-top: 20px; }
    </style>
</head>
<body>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ -->
    <div id="loginOverlay">
        <div class="login-box">
            <div class="login-left">
                <h2>ğŸš€ KEI Lab Admin</h2>
                <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
                <button class="btn-login" onclick="checkIdentity()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div id="authStatus" style="margin-top:10px; font-weight:bold;"></div>
            </div>
            <div class="login-right">
                <h3>ğŸ”‘ åˆå›è¨­å®šã¨æ³¨æ„</h3>
                <p>ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                <ul>
                    <li><code>admin_master.js</code> (const adminMasterData = [];)</li>
                    <li><code>index_news.js</code> (const indexNewsData = [];)</li>
                    <li><code>apps_catalog.js</code> (const appsCatalogData = [];)</li>
                    <li><code>allowed_users.js</code> (ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒªã‚¹ãƒˆ)</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="mainWrapper">
        <div class="dashboard">
            <div class="sidebar">
                <h1>ğŸš€ KEI Lab Admin</h1>
                <div class="menu-btn active" onclick="switchPanel('cms')">ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†</div>
                <div class="menu-btn" onclick="switchPanel('projects')">ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</div>
                <div class="menu-btn" onclick="switchPanel('calc')">ğŸ’° åç›Šè¨ˆç®—</div>
                <div class="spacer"></div>
                <div class="menu-btn" onclick="switchPanel('users')">ğŸ‘¥ æ¨©é™ç®¡ç†</div>
                <div class="menu-btn" onclick="logout()" style="margin-top:auto; background:#c0392b; color:white;">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
            </div>

            <div class="main-content">
                
                <!-- CMSãƒ‘ãƒãƒ« -->
                <div id="panel-cms" class="panel active">
                    <div class="cms-container">
                        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ã‚¨ãƒªã‚¢ -->
                        <div class="editor-col">
                            <h2>è¨˜äº‹ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç·¨é›†</h2>
                            
                            <!-- æ—¥ä»˜ã¨ã‚«ãƒ†ã‚´ãƒª -->
                            <div style="display:flex; gap:10px;">
                                <div class="form-group" style="flex:1;">
                                    <label>æ—¥ä»˜</label>
                                    <input type="text" id="inDate" class="input-white">
                                </div>
                                <div class="form-group" style="flex:1;">
                                    <label>ã‚«ãƒ†ã‚´ãƒª</label>
                                    <select id="inCategory" class="input-white" onchange="updatePreview()">
                                        <option value="update">æ›´æ–°æƒ…å ±</option>
                                        <option value="release">ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="start">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹</option>
                                        <option value="steam">Steamãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="game">ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </option>
                                    </select>
                                </div>
                            </div>

                            <!-- ç”»åƒé¸æŠ -->
                            <div class="form-group">
                                <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« <span id="imgSourceLabel" style="font-weight:normal; font-size:0.8rem;">(ã‚½ãƒ¼ã‚¹: æœªå®š)</span></label>
                                <input type="hidden" id="inImage" onchange="updatePreview()">
                                <div class="img-select-trigger" onclick="toggleImageGrid()">
                                    <span id="selectedImageText">ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„...</span>
                                    <span>â–¼</span>
                                </div>
                                <div class="img-grid-container" id="imageGrid"></div>
                            </div>

                            <hr style="border:0; border-top:1px dashed #555; margin: 20px 0;">

                            <!-- è¨€èªã‚¿ãƒ– -->
                            <div class="lang-tabs">
                                <button class="tab-btn active" onclick="switchLang('ja')">ğŸ‡¯ğŸ‡µ JP</button>
                                <button class="tab-btn" onclick="switchLang('en')">ğŸ‡ºğŸ‡¸ EN</button>
                                <button class="tab-btn" onclick="switchLang('de')">ğŸ‡©ğŸ‡ª DE</button>
                                <button class="tab-btn" onclick="switchLang('fr')">ğŸ‡«ğŸ‡· FR</button>
                                <button class="tab-btn" onclick="switchLang('es')">ğŸ‡ªğŸ‡¸ ES</button>
                            </div>

                            <!-- è‹±èªå…¥åŠ› (IDç”Ÿæˆã®ãƒã‚¹ã‚¿ãƒ¼) -->
                            <div id="group-en" class="lang-group">
                                <div class="form-group">
                                    <label style="color:#e67e22;">Project Name (EN) â€»å¿…é ˆãƒ»IDç”Ÿæˆå…ƒ</label>
                                    <input type="text" id="inProjectEn" class="input-white" oninput="generateIdFromEn(); updatePreview();">
                                </div>
                                <div class="form-group"><label>News/Catchphrase (EN)</label><textarea id="inTitleEn" class="input-white" rows="2" oninput="updatePreview()"></textarea></div>
                                <div class="form-group"><label>App Description (EN)</label><textarea id="inBodyEn" class="input-white" rows="3" oninput="updatePreview()"></textarea></div>
                            </div>

                            <!-- æ—¥æœ¬èªå…¥åŠ› -->
                            <div id="group-ja" class="lang-group active">
                                <div class="form-group">
                                    <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå (JP)</label>
                                    <div class="history-group">
                                        <input type="text" id="inProject" class="input-white" oninput="updatePreview()">
                                        <select id="projectHistory" onchange="loadHistory(this.value)"><option value="">å±¥æ­´...</option></select>
                                    </div>
                                </div>
                                <div class="form-group"><label>ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ (JP)</label><textarea id="inTitle" class="input-white" rows="2" oninput="updatePreview()"></textarea></div>
                                <div class="form-group">
                                    <label>ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ (JP)</label>
                                    <div style="margin-bottom:5px;">
                                        <label style="display:inline; margin-right:10px; cursor:pointer;"><input type="radio" name="appStatus" value="released" checked onchange="updatePreview()"> ãƒªãƒªãƒ¼ã‚¹æ¸ˆ</label>
                                        <label style="display:inline; cursor:pointer;"><input type="radio" name="appStatus" value="coming" onchange="updatePreview()"> Coming Soon</label>
                                    </div>
                                    <textarea id="inBody" class="input-white" rows="3" oninput="updatePreview()"></textarea>
                                </div>
                            </div>

                            <!-- ä»–è¨€èª (ç°¡ç•¥åŒ–ã®ãŸã‚æ§‹é€ åŒã˜) -->
                            <div id="group-de" class="lang-group"><div class="form-group"><label>Projekt (DE)</label><input type="text" id="inProjectDe" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Nachrichten (DE)</label><textarea id="inTitleDe" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>Beschreibung (DE)</label><textarea id="inBodyDe" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>
                            <div id="group-fr" class="lang-group"><div class="form-group"><label>Projet (FR)</label><input type="text" id="inProjectFr" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Nouvelles (FR)</label><textarea id="inTitleFr" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>Description (FR)</label><textarea id="inBodyFr" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>
                            <div id="group-es" class="lang-group"><div class="form-group"><label>Proyecto (ES)</label><input type="text" id="inProjectEs" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Noticias (ES)</label><textarea id="inTitleEs" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>DescripciÃ³n (ES)</label><textarea id="inBodyEs" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>

                            <hr style="border:0; border-top:1px dashed #555; margin: 20px 0;">

                            <div class="form-group">
                                <label>ç”Ÿæˆã•ã‚Œã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID (è‡ªå‹•)</label>
                                <input type="text" id="projectId" class="input-readonly" readonly>
                                <p style="font-size:0.8rem; color:#f39c12; margin-top:5px;" id="idWarning"></p>
                            </div>

                            <button class="btn-save" onclick="saveAll()">ğŸ’¾ å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ (Save All)</button>
                        </div>

                        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
                        <div class="preview-col">
                            <div class="preview-header">ğŸ‘ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (JP)</div>

                            <!-- 1. ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ -->
                            <span class="preview-label">â–¼ ãŠçŸ¥ã‚‰ã› (News List @ Top Page)</span>
                            <div class="news-item-prev">
                                <span class="news-date" id="prevDate">--.--.--</span>
                                <span class="tag-badge tag-release" id="prevTag">Category</span>
                                <div style="flex:1;">
                                    <strong id="prevProjName" style="margin-right:10px;">Project</strong>
                                    <span id="prevNewsTitle">News Title...</span>
                                </div>
                            </div>

                            <!-- 2. ã‚«ãƒ¼ãƒ‰æ¯”è¼ƒ -->
                            <div class="card-compare-row" style="margin-top:20px;">
                                <!-- å·¦: æœ€æ–°ã®æ´»å‹• -->
                                <div class="card-box">
                                    <span class="preview-label" style="margin:10px;">â–¼ æœ€æ–°ã®æ´»å‹• (Highlights)</span>
                                    <div class="card-img-area">
                                        <img id="prevCardImg" src="">
                                        <span class="card-badge tag-release" id="prevCardBadge">Category</span>
                                    </div>
                                    <div class="card-content">
                                        <div class="highlight-meta"><span id="prevCardProj">Project</span> | <span id="prevCardDate">Date</span></div>
                                        <div class="card-title" id="prevCardTitle">News Title...</div>
                                    </div>
                                </div>
                                <!-- å³: ã‚¢ãƒ—ãƒªã‚«ã‚¿ãƒ­ã‚° -->
                                <div class="card-box">
                                    <span class="preview-label" style="margin:10px;">â–¼ ã‚¢ãƒ—ãƒªç´¹ä»‹ (Catalog)</span>
                                    <div class="card-img-area">
                                        <img id="prevAppImg" src="">
                                        <span class="card-badge" style="background:#0056b3; font-size:0.8rem;" id="prevAppProj">Project</span>
                                    </div>
                                    <div class="card-content">
                                        <div class="card-desc" id="prevAppDesc">App Description...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 3. è©³ç´°ãƒšãƒ¼ã‚¸ -->
                            <span class="preview-label" style="margin-top:30px;">â–¼ è©³ç´°ãƒšãƒ¼ã‚¸ (HP Preview)</span>
                            <div class="url-bar">
                                ğŸŒ <span id="previewUrl">...</span>
                                <span id="urlStatus" style="margin-left:auto; font-size:0.75rem;">CHECKING...</span>
                            </div>
                            <div id="iframeContainer" class="iframe-container" style="display:none;">
                                <iframe id="hpIframe" style="width:100%; height:100%; border:none;"></iframe>
                            </div>
                            <div id="iframePlaceholder" class="iframe-placeholder">
                                ãƒšãƒ¼ã‚¸æœªä½œæˆã®ãŸã‚ã€ç°¡æ˜“ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¿è¡¨ç¤ºä¸­
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ãã®ä»–ãƒ‘ãƒãƒ« (çœç•¥) -->
                <div id="panel-projects" class="panel"><h2>ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</h2><p>apps_catalog.jsã®å†…å®¹ã‚’è¡¨ç¤ºäºˆå®š</p></div>
                <div id="panel-calc" class="panel"><h2>ğŸ’° åç›Šè¨ˆç®—</h2><p>è¨ˆç®—æ©Ÿèƒ½</p></div>
                <div id="panel-users" class="panel"><h2>ğŸ‘¥ æ¨©é™ç®¡ç†</h2></div>
            </div>
        </div>
    </div>

    <script>
        // --- è¨­å®š ---
        const GITHUB_CONFIG = { owner: "KeiAppLab", repo: "KeiAppLab" };
        let currentLang = 'ja';
        let isNewProject = true; // æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹æ—¢å­˜ã‹

        // --- åˆæœŸåŒ– ---
        const today = new Date();
        document.getElementById('inDate').value = today.getFullYear() + '.' + (today.getMonth()+1).toString().padStart(2,'0') + '.' + today.getDate().toString().padStart(2,'0');

        window.addEventListener('load', () => {
            const t = localStorage.getItem('gh_token');
            if(t) checkIdentity(t);
        });

        async function checkIdentity(token) {
            token = token || document.getElementById('tokenInput').value.trim();
            const status = document.getElementById('authStatus');
            if (!token) { status.innerText = "âš ï¸ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›"; return; }
            status.innerText = "èªè¨¼ä¸­...";
            
            try {
                const res = await fetch("https://api.github.com/user", { headers: { Authorization: `token ${token}` } });
                if (!res.ok) throw new Error("ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³");
                const user = await res.json();
                
                if (typeof allowedUsersData !== 'undefined' && allowedUsersData.includes(user.login)) {
                    localStorage.setItem('gh_token', token);
                    document.getElementById('loginOverlay').style.display = 'none';
                    document.getElementById('mainWrapper').style.display = 'block';
                    initHistory(); // å±¥æ­´ãƒ­ãƒ¼ãƒ‰
                    loadImages('global'); // åˆæœŸç”»åƒãƒ­ãƒ¼ãƒ‰
                } else {
                    status.innerText = "âŒ æœªè¨±å¯ID: " + user.login;
                }
            } catch (err) { status.innerText = "âš ï¸ ã‚¨ãƒ©ãƒ¼: " + err.message; }
        }

        function logout() { localStorage.removeItem('gh_token'); location.reload(); }

        function switchPanel(id) {
            document.querySelectorAll('.panel').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(e => e.classList.remove('active'));
            document.getElementById('panel-' + id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // --- è¨€èªåˆ‡ã‚Šæ›¿ãˆ ---
        function switchLang(lang) {
            document.querySelectorAll('.lang-group').forEach(e => e.classList.remove('active'));
            document.getElementById('group-' + lang).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active'));
            event.currentTarget.classList.add('active');
            currentLang = lang;
            updatePreview();
        }

        // --- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDç”Ÿæˆ & å­˜åœ¨ãƒã‚§ãƒƒã‚¯ ---
        function generateIdFromEn() {
            const enName = document.getElementById('inProjectEn').value;
            const warning = document.getElementById('idWarning');
            const idField = document.getElementById('projectId');

            if (!enName) {
                idField.value = "";
                warning.innerText = "âš ï¸ è‹±èªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆIDç”Ÿæˆã«å¿…è¦ã§ã™ï¼‰";
                loadImages('global');
                return;
            }

            // IDç”Ÿæˆ: å°æ–‡å­—åŒ–ã€ã‚¹ãƒšãƒ¼ã‚¹ã‚’ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã«ã€è‹±æ•°å­—ä»¥å¤–å‰Šé™¤
            const id = enName.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
            idField.value = id;
            warning.innerText = "";
            
            checkProjectExistence(id);
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        async function checkProjectExistence(id) {
            const token = localStorage.getItem('gh_token');
            const urlStatus = document.getElementById('urlStatus');
            const previewUrl = document.getElementById('previewUrl');
            const iframe = document.getElementById('hpIframe');
            const iframeContainer = document.getElementById('iframeContainer');
            const placeholder = document.getElementById('iframePlaceholder');

            previewUrl.innerText = `https://${GITHUB_CONFIG.owner}.github.io/${GITHUB_CONFIG.repo}/${id}/index.html`;
            urlStatus.innerText = "CHECKING...";

            try {
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„APIã§ãƒ•ã‚©ãƒ«ãƒ€ãƒã‚§ãƒƒã‚¯
                const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${id}`, {
                    headers: { Authorization: `token ${token}` }
                });

                if (res.ok) {
                    // å­˜åœ¨ã™ã‚‹å ´åˆ
                    isNewProject = false;
                    urlStatus.innerText = "âœ… EXIST (æ—¢å­˜)";
                    urlStatus.style.color = "green";
                    document.getElementById('imgSourceLabel').innerText = `(ã‚½ãƒ¼ã‚¹: ${id}/)`;
                    loadImages('local', id); // ãã®ãƒ•ã‚©ãƒ«ãƒ€ã®ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰
                    
                    // Iframeè¡¨ç¤º
                    iframe.src = previewUrl.innerText;
                    iframeContainer.style.display = 'block';
                    placeholder.style.display = 'none';

                } else {
                    // å­˜åœ¨ã—ãªã„å ´åˆ
                    isNewProject = true;
                    urlStatus.innerText = "ğŸ†• NEW (æ–°è¦)";
                    urlStatus.style.color = "orange";
                    document.getElementById('imgSourceLabel').innerText = `(ã‚½ãƒ¼ã‚¹: index_phot/)`;
                    loadImages('global'); // å…±é€šç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰

                    // Iframeéè¡¨ç¤º
                    iframe.src = "";
                    iframeContainer.style.display = 'none';
                    placeholder.style.display = 'flex';
                }
            } catch (e) {
                console.error(e);
            }
        }

        // --- ç”»åƒãƒ­ãƒ¼ãƒ‰ ---
        async function loadImages(mode, projectId) {
            const grid = document.getElementById('imageGrid');
            grid.innerHTML = '<p style="padding:10px; text-align:center;">Loading...</p>';
            let images = [];

            if (mode === 'global') {
                // index_phot.js ã‹ã‚‰èª­ã¿è¾¼ã¿
                images = (typeof photoList !== 'undefined') ? photoList : [];
                renderImageGrid(images, 'index_phot');
            } else {
                // GitHub APIã§ãƒ•ã‚©ãƒ«ãƒ€å†…æ¤œç´¢
                const token = localStorage.getItem('gh_token');
                try {
                    const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${projectId}`, {
                        headers: { Authorization: `token ${token}` }
                    });
                    const data = await res.json();
                    // png, jpgã®ã¿æŠ½å‡º
                    images = data.filter(f => f.name.match(/\.(png|jpg|jpeg)$/i)).map(f => f.name);
                    renderImageGrid(images, projectId);
                } catch (e) {
                    grid.innerHTML = '<p>ç”»åƒå–å¾—ã‚¨ãƒ©ãƒ¼</p>';
                }
            }
        }

        function renderImageGrid(list, folder) {
            const grid = document.getElementById('imageGrid');
            grid.innerHTML = '';
            if(list.length === 0) { grid.innerHTML = '<p>ç”»åƒãªã—</p>'; return; }

            list.forEach(img => {
                const div = document.createElement('div');
                div.className = 'img-option';
                div.innerHTML = `<img src="${folder}/${img}"><span class="option-text">${img}</span>`;
                div.onclick = () => {
                    // ä¿å­˜ç”¨ãƒ‘ã‚¹: ID + ãƒ•ã‚¡ã‚¤ãƒ«å (ä¿å­˜æ™‚ã«èª¿æ•´ã™ã‚‹ãŒã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã«ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’å…¥ã‚Œã‚‹)
                    document.getElementById('inImage').value = `${folder}/${img}`;
                    document.getElementById('selectedImageText').innerText = img;
                    toggleImageGrid();
                    updatePreview();
                };
                grid.appendChild(div);
            });
        }

        function toggleImageGrid() { document.getElementById('imageGrid').classList.toggle('open'); }

        // --- å±¥æ­´ãƒ­ãƒ¼ãƒ‰ (admin_master.js) ---
        function initHistory() {
            if (typeof adminMasterData === 'undefined') return;
            const sel = document.getElementById('projectHistory');
            // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’æŠ½å‡º
            const ids = [...new Set(adminMasterData.map(d => d.id))];
            ids.forEach(id => {
                const item = adminMasterData.find(d => d.id === id);
                const opt = document.createElement('option');
                opt.value = id;
                opt.innerText = item.project_ja || id;
                sel.appendChild(opt);
            });
        }

        function loadHistory(id) {
            if (!id) return;
            const data = adminMasterData.find(d => d.id === id);
            if (data) {
                // å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’ã‚»ãƒƒãƒˆ
                const langs = ['ja','en','de','fr','es'];
                const fields = ['Project','Title','Body']; // Title=News, Body=Desc
                
                langs.forEach(lang => {
                    const suffix = lang === 'ja' ? '' : lang.charAt(0).toUpperCase() + lang.slice(1);
                    document.getElementById(`inProject${suffix}`).value = data[`project_${lang}`] || "";
                    document.getElementById(`inTitle${suffix}`).value = data[`news_${lang}`] || ""; // News
                    document.getElementById(`inBody${suffix}`).value = data[`desc_${lang}`] || ""; // Desc
                });

                // IDå†ã‚»ãƒƒãƒˆï¼†ãƒã‚§ãƒƒã‚¯
                document.getElementById('inProjectEn').dispatchEvent(new Event('input'));
                
                // ç”»åƒã‚»ãƒƒãƒˆ
                if(data.image) {
                    const imgName = data.image.split('/').pop();
                    document.getElementById('selectedImageText').innerText = imgName;
                    document.getElementById('inImage').value = data.image; // ä¸€æ—¦ãã®ã¾ã¾å…¥ã‚Œã‚‹
                }
            }
        }

        // --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–° ---
        function updatePreview() {
            const s = currentLang==='ja'?'':currentLang.charAt(0).toUpperCase()+currentLang.slice(1);
            
            const proj = document.getElementById('inProject'+s).value || "Project Name";
            const title = document.getElementById('inTitle'+s).value || "News Title";
            const desc = document.getElementById('inBody'+s).value || "App Description";
            const date = document.getElementById('inDate').value;
            const cat = document.getElementById('inCategory').value;
            let img = document.getElementById('inImage').value;

            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
            document.getElementById('prevDate').innerText = date;
            document.getElementById('prevTag').innerText = cat;
            document.getElementById('prevTag').className = `tag-badge tag-${cat}`;
            document.getElementById('prevProjName').innerText = proj;
            document.getElementById('prevNewsTitle').innerText = title;

            document.getElementById('prevCardProj').innerText = proj;
            document.getElementById('prevCardDate').innerText = date;
            document.getElementById('prevCardTitle').innerText = title;
            document.getElementById('prevCardBadge').className = `card-badge tag-${cat}`;
            document.getElementById('prevCardBadge').innerText = cat;

            document.getElementById('prevAppProj').innerText = proj;
            document.getElementById('prevAppDesc').innerText = desc;
            
            // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
            const setImg = (id) => {
                const el = document.getElementById(id);
                el.src = img; 
                el.style.display = img ? 'block' : 'none';
            };
            setImg('prevCardImg'); setImg('prevAppImg');
        }


        // --- â˜…â˜…â˜… ä¿å­˜å‡¦ç† (æ ¸å¿ƒéƒ¨åˆ†) â˜…â˜…â˜… ---
        async function saveAll() {
            const token = localStorage.getItem('gh_token');
            const projectId = document.getElementById('projectId').value;
            
            if (!token) { alert("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„"); return; }
            if (!projectId) { alert("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆè‹±èªåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰"); return; }
            if (!confirm("å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ãƒ»ä¿å­˜ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;

            // 1. å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®åé›†
            const inputData = {
                id: projectId,
                date: document.getElementById('inDate').value,
                category: document.getElementById('inCategory').value,
                status: document.querySelector('input[name="appStatus"]:checked').value,
                // ç”»åƒãƒ‘ã‚¹ã¯ "id/filename" ã«çµ±ä¸€ã™ã‚‹
                imageName: document.getElementById('selectedImageText').innerText,
                imagePath: `${projectId}/${document.getElementById('selectedImageText').innerText}`,
                langs: {}
            };
            ['ja','en','de','fr','es'].forEach(lang => {
                const s = lang==='ja'?'':lang.charAt(0).toUpperCase()+lang.slice(1);
                inputData.langs[lang] = {
                    project: document.getElementById(`inProject${s}`).value,
                    news: document.getElementById(`inTitle${s}`).value,
                    desc: document.getElementById(`inBody${s}`).value
                };
            });

            try {
                // --- A. ç”»åƒã®ã‚³ãƒ”ãƒ¼ (æ–°è¦/å¤‰æ›´æ™‚) ---
                // index_photã«ã‚ã‚‹ç”»åƒã‚’ã€projectãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹
                const sourcePath = document.getElementById('inImage').value;
                if (sourcePath.startsWith('index_phot/')) {
                    await copyImageToProject(token, sourcePath, inputData.imagePath);
                }

                // --- B. HTMLã®ä½œæˆ (æ–°è¦æ™‚ã®ã¿) ---
                if (isNewProject) {
                    await createProjectHtml(token, projectId);
                }

                // --- C. 5ã¤ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–° ---
                
                // 1. admin_master.js (å…¨å…¥åŠ›ä¿å­˜ãƒ»æœ€æ–°1ä»¶)
                await updateAdminMaster(token, inputData);

                // 2. index_news.js (ãƒˆãƒƒãƒ—é€Ÿå ±ãƒ»20ä»¶)
                await updateIndexNews(token, inputData);

                // 3. apps_catalog.js (ä¸€è¦§ã‚«ã‚¿ãƒ­ã‚°ãƒ»ç´¹ä»‹æ–‡)
                await updateAppsCatalog(token, inputData);

                // 4. [id]/news.js (å€‹åˆ¥æœ€æ–°ãƒ»3ä»¶)
                await updateProjectNews(token, inputData, 3);

                // 5. [id]/old_news.js (ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ»å…¨ä»¶)
                await updateProjectOldNews(token, inputData);

                alert("âœ… å…¨ã¦ã®ä¿å­˜ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
                location.reload(); // ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦åæ˜ 

            } catch (e) {
                alert("âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + e.message);
                console.error(e);
            }
        }

        // --- Helper: ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿æ›¸ã ---
        async function fetchFile(token, path) {
            const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                headers: { Authorization: `token ${token}` }
            });
            if (!res.ok) return null;
            const json = await res.json();
            const content = decodeURIComponent(escape(atob(json.content)));
            // JSãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰JSONéƒ¨åˆ†ã‚’æŠ½å‡º (const x = [...]; ã® [...] éƒ¨åˆ†)
            const match = content.match(/\[.*\]/s) || content.match(/\{.*\}/s); 
            return { sha: json.sha, data: match ? JSON.parse(match[0]) : [] };
        }

        async function uploadFile(token, path, content, message, sha=null) {
            const body = { message: message, content: btoa(unescape(encodeURIComponent(content))) };
            if (sha) body.sha = sha;
            await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                method: "PUT",
                headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });
        }

        // --- C-1. Admin Master Update ---
        async function updateAdminMaster(token, input) {
            const file = await fetchFile(token, 'admin_master.js') || { sha: null, data: [] };
            let data = file.data;
            // IDã§æ¤œç´¢ã—ã€ã‚ã‚Œã°å‰Šé™¤ã—ã¦å…ˆé ­ã«è¿½åŠ ï¼ˆå¸¸ã«æœ€æ–°1ä»¶ï¼‰
            data = data.filter(d => d.id !== input.id);
            
            const entry = {
                id: input.id,
                image: input.imagePath,
                status: input.status,
                // ãƒ•ãƒ©ãƒƒãƒˆã«ä¿å­˜
                project_ja: input.langs.ja.project, news_ja: input.langs.ja.news, desc_ja: input.langs.ja.desc,
                project_en: input.langs.en.project, news_en: input.langs.en.news, desc_en: input.langs.en.desc,
                // ...ä»–è¨€èªã‚‚åŒæ§˜ã«ä¿å­˜
                // (çœç•¥ã›ãšæ›¸ãã®ãŒæœ›ã¾ã—ã„ãŒã€ã“ã“ã§ã¯æ§‹é€ ã®ã¿ç¤ºã™)
            };
            // â€»å®Ÿéš›ã®å®Ÿè£…ã§ã¯å…¨è¨€èªãƒ«ãƒ¼ãƒ—ã§ã‚»ãƒƒãƒˆ
            ['ja','en','de','fr','es'].forEach(l => {
                entry[`project_${l}`] = input.langs[l].project;
                entry[`news_${l}`] = input.langs[l].news;
                entry[`desc_${l}`] = input.langs[l].desc;
            });

            data.unshift(entry);
            const content = `const adminMasterData = ${JSON.stringify(data, null, 2)};`;
            await uploadFile(token, 'admin_master.js', content, 'Update Admin Master', file.sha);
        }

        // --- C-2. Index News Update ---
        async function updateIndexNews(token, input) {
            const file = await fetchFile(token, 'index_news.js') || { sha: null, data: [] };
            let data = file.data;
            
            const entry = {
                date: input.date,
                category: input.category,
                image: input.imagePath,
                link: `${input.id}/index.html`,
                // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿
                names: {}, titles: {}
            };
            ['ja','en','de','fr','es'].forEach(l => {
                entry.names[l] = input.langs[l].project;
                entry.titles[l] = input.langs[l].news;
            });

            data.unshift(entry);
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° (Release10 + Update10)
            const releaseCats = ['release','start','steam'];
            const releases = data.filter(d => releaseCats.includes(d.category)).slice(0, 10);
            const updates = data.filter(d => !releaseCats.includes(d.category)).slice(0, 10);
            const merged = [...releases, ...updates];
            // æ—¥ä»˜é †ã‚½ãƒ¼ãƒˆãªã©ãŒå¿…è¦ãªã‚‰ã“ã“ã§

            const content = `const indexNewsData = ${JSON.stringify(merged, null, 2)};`;
            await uploadFile(token, 'index_news.js', content, 'Update Index News', file.sha);
        }

        // --- C-3. Apps Catalog Update ---
        async function updateAppsCatalog(token, input) {
            const file = await fetchFile(token, 'apps_catalog.js') || { sha: null, data: [] };
            let data = file.data;
            data = data.filter(d => d.id !== input.id); // æ—¢å­˜å‰Šé™¤

            const entry = {
                id: input.id,
                status: input.status,
                image: input.imagePath,
                names: {}, descs: {} // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨ç´¹ä»‹æ–‡ã®ã¿
            };
            ['ja','en','de','fr','es'].forEach(l => {
                entry.names[l] = input.langs[l].project;
                entry.descs[l] = input.langs[l].desc;
            });

            data.unshift(entry); // æœ€æ–°ã‚’ä¸Šã«
            const content = `const appsCatalogData = ${JSON.stringify(data, null, 2)};`;
            await uploadFile(token, 'apps_catalog.js', content, 'Update Apps Catalog', file.sha);
        }

        // --- C-4/5. Project News Update ---
        async function updateProjectNews(token, input, limit) {
            const path = `${input.id}/news.js`;
            const file = await fetchFile(token, path) || { sha: null, data: [] };
            let data = file.data;

            const entry = {
                date: input.date,
                category: input.category,
                titles: {}, bodies: {} // ã‚¿ã‚¤ãƒˆãƒ«(=ãƒ‹ãƒ¥ãƒ¼ã‚¹)ã®ã¿ã€‚è©³ç´°æœ¬æ–‡ãªã—
            };
            ['ja','en','de','fr','es'].forEach(l => {
                entry.titles[l] = input.langs[l].news;
                entry.bodies[l] = input.langs[l].news; // æœ¬æ–‡ã‚‚ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨åŒã˜
            });

            data.unshift(entry);
            if (limit) data = data.slice(0, limit);

            const content = `const projectNewsData = ${JSON.stringify(data, null, 2)};`;
            await uploadFile(token, path, `Update ${input.id} news`, file.sha);
        }

        async function updateProjectOldNews(token, input) {
            const path = `${input.id}/old_news.js`;
            const file = await fetchFile(token, path) || { sha: null, data: [] };
            let data = file.data;
            // æ§‹é€ ã¯ news.js ã¨åŒã˜ã€‚åˆ¶é™ãªã—
            const entry = {
                date: input.date,
                category: input.category,
                titles: {}, bodies: {}
            };
            ['ja','en','de','fr','es'].forEach(l => {
                entry.titles[l] = input.langs[l].news;
                entry.bodies[l] = input.langs[l].news;
            });
            data.unshift(entry);
            const content = `const projectOldNewsData = ${JSON.stringify(data, null, 2)};`;
            await uploadFile(token, path, `Archive ${input.id} news`, file.sha);
        }

        // --- A. ç”»åƒã‚³ãƒ”ãƒ¼ ---
        async function copyImageToProject(token, srcPath, destPath) {
            // ãƒã‚¤ãƒŠãƒªå–å¾—
            const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${srcPath}`, {
                headers: { Authorization: `token ${token}` }
            });
            const json = await res.json();
            
            // å®›å…ˆãƒã‚§ãƒƒã‚¯
            const check = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${destPath}`, {
                headers: { Authorization: `token ${token}` }
            });
            
            // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (shaãŒã‚ã‚Œã°ä¸Šæ›¸ã)
            const body = { 
                message: "Copy image", 
                content: json.content, // base64ã®ã¾ã¾è»¢é€
                sha: check.ok ? (await check.json()).sha : undefined
            };
            
            await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${destPath}`, {
                method: "PUT",
                headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });
        }

        // --- B. HTMLç”Ÿæˆ ---
        async function createProjectHtml(token, id) {
            const path = `${id}/index.html`;
            // ç°¡æ˜“ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
            const htmlContent = `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Page</title>
    <script src="news.js"></script>
    <style>body{font-family:sans-serif; padding:20px; color:#333;}</style>
</head>
<body>
    <h1>${id} (Auto Generated)</h1>
    <p>This page was generated by KEI Lab Admin.</p>
    <div id="news-container"></div>
    <script>
        // Sample loader
        if(typeof projectNewsData !== 'undefined') {
            document.getElementById('news-container').innerHTML = projectNewsData.map(n => 
                \`<p><strong>\${n.date}</strong>: \${n.titles.ja || n.titles.en}</p>\`
            ).join('');
        }
    <\/script>
</body>
</html>`;
            
            await uploadFile(token, path, htmlContent, "Create Project Page");
        }

    </script>
</body>
</html>
