<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEI Lab ãƒã‚¹ã‚¿ãƒ¼ãƒ»ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ</title>

    <!-- 3ã¤ã®ä¸»è¦ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ -->
    <script src="admin_master.js"></script>
    <script src="index_news.js"></script>
    <script src="apps_catalog.js"></script>
    
    <script src="allowed_users.js"></script>
    <script src="index_phot.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@400;500;900&display=swap');

        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: #1e1e1e; color: #ddd; height: 100vh; overflow: hidden; }
        #mainWrapper { display: none; height: 100%; }

        /* --- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-container-split { display: flex; width: 850px; height: 550px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-left { width: 40%; padding: 40px; display: flex; flex-direction: column; justify-content: center; background: #f9f9f9; border-right: 1px solid #eee; }
        .login-left input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ccc; border-radius: 5px; }
        .login-left button { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login-left button:hover { background: #003d82; }
        .login-right { width: 60%; padding: 40px; overflow-y: auto; color: #333; line-height: 1.6; }
        .login-right h3 { border-bottom: 2px solid #0056b3; padding-bottom: 10px; margin-top: 0; }
        .login-right ol { padding-left: 20px; margin-bottom: 20px; }
        .login-right li { margin-bottom: 8px; font-size: 0.9rem; }
        .warning-box { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 10px; border-radius: 5px; font-size: 0.85rem; margin-top: 15px; }

        /* --- ãƒ¡ã‚¤ãƒ³ç”»é¢ --- */
        .dashboard { display: grid; grid-template-columns: 250px 1fr; height: 100%; }
        .sidebar { background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
        .sidebar h1 { font-size: 1.2rem; color: #fff; margin: 20px 10px; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
        .menu-btn { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 5px; color: #aaa; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .menu-btn:hover { background: #3c3c3c; color: #fff; }
        .menu-btn.active { background: #007acc; color: white; }
        .spacer { flex-grow: 1; min-height: 20px; border-bottom: 1px solid #333; margin-bottom: 10px; }

        .main-content { position: relative; overflow: hidden; height: 100%; }
        .panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; padding: 30px; box-sizing: border-box; }
        .panel.active { display: block; }

        /* --- CMSãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (40:60) --- */
        .cms-layout { display: flex; height: 100%; gap: 0; }
        .editor-area { width: 40%; overflow-y: auto; padding-right: 20px; height: 100%; box-sizing: border-box; }
        .preview-area { width: 60%; background: #e0e0e0; color: #333; overflow-y: auto; padding: 20px; height: 100%; box-sizing: border-box; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-top: 5px; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        /* ãƒ©ãƒ™ãƒ«è¡Œã®ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹è¨­å®šï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¹ã‚¤ãƒƒãƒé…ç½®ç”¨ï¼‰ */
        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .label-row label { margin: 0; }

        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #555; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        /* --- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆè–„ããƒ»å°ã•ãï¼‰ --- */
        #inPrivacy::placeholder { font-size: 0.8rem; color: #999; line-height: 1.5; }
        .input-white { background-color: #ffffff !important; color: #333 !important; border: 1px solid #ccc !important; font-weight: bold; }
        
        .row-group { display: flex; gap: 10px; }
        .row-group > div { flex: 1; }

        .input-group { display: flex; width: 100%; }
        .input-group input { flex: 1; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; border-right: 0 !important; }
        .input-group select { flex: 1; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; background-color: #e6e6e6 !important; color: #0056b3 !important; cursor: pointer; }

        .editor-lang-tabs { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .edit-tab { padding: 8px 15px; background: #333; color: #aaa; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .edit-tab:hover { background: #444; color: #fff; }
        .edit-tab.active { background: #007acc; color: white; }
        
        .lang-input-group { display: none; animation: fadeIn 0.3s; }
        .lang-input-group.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¹ã‚¤ãƒƒãƒ */
        .status-switch { display: flex; gap: 10px; background: #333; padding: 2px 8px; border-radius: 4px; }
        .status-label { color: #fff; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; cursor: pointer; font-weight: normal; margin: 0; }
        .status-label input { width: auto; margin: 0; }

        /* ç”»åƒé¸æŠ (ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º) */
        .custom-select-wrapper { position: relative; user-select: none; width: 100%; }
        .custom-select { position: relative; display: flex; flex-direction: column; }
        .custom-select__trigger { position: relative; display: flex; align-items: center; justify-content: space-between; padding: 10px; font-size: 1rem; font-weight: bold; color: #333; background: #ffffff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; }
        
        .custom-options { 
            position: absolute; display: block; top: 100%; left: 0; right: 0; 
            border: 1px solid #ccc; border-top: 0; background: #fff; 
            transition: all 0.3s; opacity: 0; visibility: hidden; pointer-events: none; z-index: 100; 
            max-height: 400px; overflow-y: auto; border-radius: 0 0 4px 4px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
            padding: 10px;
        }
        .custom-select.open .custom-options { opacity: 1; visibility: visible; pointer-events: all; }
        
        .custom-option { 
            position: relative; display: flex; flex-direction: column; align-items: center; text-align: center;
            padding: 5px; border: 1px solid #eee; border-radius: 4px;
            cursor: pointer; transition: all 0.2s; color: #333; 
        }
        .custom-option:hover { background-color: #f2f9fc; border-color: #0056b3; color: #0056b3; }
        
        .option-img { 
            width: 75px; height: 75px; 
            object-fit: cover; border-radius: 4px; 
            margin-bottom: 5px;
            border: 1px solid #ddd; 
        }
        .option-text { 
            font-size: 0.8rem; font-weight: bold; 
            word-break: break-all;
        }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ --- */
        .preview-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 10px; }
        .preview-label { font-size: 0.8rem; color: #666; font-weight: bold; border-bottom: 1px dashed #999; display: block; margin-bottom: 10px; }
        
        .news-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #ccc; }
        .news-date { font-family: 'Roboto', sans-serif; color: #666; width: 100px; font-size: 0.9rem; }
        .news-tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; margin-right: 15px; color: white; width: 110px; text-align: center; }
        .tag-release { background: #0056b3; } .tag-update  { background: #e67e22; } .tag-start   { background: #8e44ad; } .tag-steam   { background: #2c3e50; } .tag-game    { background: #27ae60; }
        .news-link { text-decoration: none; color: #333; font-weight: 500; font-family: 'Noto Serif JP', serif; }

        .preview-split-row { display: flex; border: 1px solid #ccc; border-radius: 8px; overflow: hidden; margin-bottom: 30px; }
        .split-col { flex: 1; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .split-col.left { background: #f0f0f0; border-right: 1px solid #ddd; }
        .split-col.right { background: #e8e8e8; }

        /* å…±é€šã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .highlight-card { width: 100%; max-width: 300px; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); }
        .highlight-img-area { width: 100%; height: 160px; overflow: hidden; background: #eee; position: relative; }
        .highlight-img { width: 100%; height: 100%; object-fit: cover; object-position: center; transition: opacity 0.3s; }
        .highlight-category-badge { position: absolute; bottom: 0; left: 0; color: white; font-size: 0.8rem; padding: 4px 12px; border-top-right-radius: 8px; font-weight: bold; z-index: 2; }
        
        /* æœ€æ–°ã®æ´»å‹•ç”¨ */
        .highlight-card.dimmed { opacity: 0.4; }
        .highlight-content-tight { padding: 5px 0 0 0; text-align: left; }
        .highlight-title-tight { 
            font-family: 'Noto Serif JP', serif; font-size: 1rem; font-weight: 900; color: #333; line-height: 1.5; margin: 0; 
            width: 18em; white-space: normal;
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
            height: 4.5em; 
        }
        .highlight-meta { font-size: 0.75rem; color: #666; margin-bottom: 2px; font-family: 'Roboto', sans-serif; }

        /* ã‚¢ãƒ—ãƒªç´¹ä»‹ç”¨ */
        .coming-soon-overlay { 
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg); 
            font-size: 1.8rem; font-weight: 900; color: #fff; text-shadow: 2px 2px 0 #000, -1px -1px 0 #000; 
            border: 3px solid #fff; padding: 5px 20px; box-shadow: 3px 3px 0 rgba(0,0,0,0.5); z-index: 10; pointer-events: none;
        }
        .highlight-img.coming-soon-mode { opacity: 0.5; filter: grayscale(50%); }

        .project-name-badge {
            position: absolute; bottom: 0; left: 0; z-index: 5;
            background: #0056b3; color: #fff;
            font-family: 'Roboto', sans-serif; font-weight: 900; font-size: 0.9rem;
            padding: 5px 12px; 
            border-top-right-radius: 8px; box-shadow: 2px -2px 5px rgba(0,0,0,0.3);
            max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        .app-desc-content { padding: 8px 10px; text-align: left; }
        .app-desc-text {
            font-family: 'Noto Serif JP', serif; font-size: 0.9rem; color: #444; line-height: 1.5;
            width: 20em; height: 6em;
            display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;
        }

        .page-preview { font-family: 'Noto Serif JP', serif; line-height: 1.8; margin-top: 20px; background: white; padding: 20px; border-radius: 8px; }
        .page-preview h1 { border-bottom: 3px solid #0056b3; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; font-size: 1.5rem; }
        .page-preview img { max-width: 100%; border-radius: 10px; margin: 20px 0; }
        #prevBody, .news-link { white-space: pre-wrap; }

        button { padding: 12px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; width: 100%; }
        .btn-save { background: #27ae60; color: white; }
        .btn-copy { background: #e67e22; color: white; margin-top: 20px; }

        /* --- ãƒ“ãƒ«ãƒ‰ç›£è¦–ç”¨ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ --- */
        #build-toast {
            position: fixed; bottom: 20px; right: 20px;
            background: #2c3e50; color: #fff; padding: 15px 25px; border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3); z-index: 10000;
            display: none; align-items: center; gap: 15px; font-family: sans-serif;
            animation: slideInUp 0.5s ease-out forwards;
        }
        @keyframes slideInUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .spinner {
            width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .toast-btn { background: #27ae60; color: white; border: none; padding: 8px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .toast-btn:hover { background: #219653; }
    </style>
</head>
<body>
    <div id="build-toast">
        <div id="toast-icon" class="spinner"></div>
        <div id="toast-msg" style="font-size: 0.9rem;">ğŸ”„ ã‚µã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ...</div>
    </div>
    
    <div id="loginOverlay">
        <div class="login-container-split">
            <div class="login-left">
                <h2>ğŸš€ KEI Lab Admin</h2>
                <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
                <button onclick="checkIdentity()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div id="authStatus"></div>
            </div>
            <div class="login-right">
                <h3>ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œæ‰‹é †</h3>
                <ol>
                    <li><a href="https://github.com/settings/tokens" target="_blank" style="color:#007acc; font-weight:bold;">GitHub Tokenè¨­å®šãƒšãƒ¼ã‚¸ã¸ç§»å‹• â†—</a></li>
                    <li>[Generate new token (classic)] ã‚’é¸æŠ</li>
                    <li>Expirationï¼ˆæœŸé™ï¼‰ã‚’è¨­å®šï¼ˆ90 daysæ¨å¥¨ï¼‰</li>
                    <li><strong>[repo]</strong> ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ï¼ˆå¿…é ˆï¼‰</li>
                    <li>ä¸€ç•ªä¸‹ã® [Generate token] ã‚’æŠ¼ã—ã¦ã‚³ãƒ”ãƒ¼</li>
                </ol>
                <div class="warning-box">
                    <strong>âš ï¸ è­¦å‘Šï¼š</strong><br>
                    ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ¼æ´©ã—ãŸå ´åˆã¯ã€ç›´ã¡ã«GitHubè¨­å®šãƒšãƒ¼ã‚¸ã§è©²å½“ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤ï¼ˆRevokeï¼‰ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>
        </div>
    </div>

    <div id="mainWrapper">
        <div class="dashboard">
            <div class="sidebar">
                <h1>ğŸš€ KEI Lab Admin</h1>
                <div class="menu-btn active" onclick="switchPanel('calc')">ğŸ’° åç›Šãƒ»ç§’æ•°è¨ˆç®—</div>
                <div class="menu-btn" onclick="switchPanel('cms')">ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†</div>
                <div class="menu-btn" onclick="switchPanel('projects')">ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</div>
                <div class="menu-btn" style="font-size:0.8rem; padding:10px 15px;" onclick="switchPanel('data-master')">ğŸ“„ admin_master.js</div>
                <div class="menu-btn" style="font-size:0.8rem; padding:10px 15px;" onclick="switchPanel('data-index')">ğŸ“„ index_news.js</div>
                <div class="menu-btn" style="font-size:0.8rem; padding:10px 15px;" onclick="switchPanel('data-catalog')">ğŸ“„ apps_catalog.js</div>
                <div class="menu-btn" style="font-size:0.8rem; padding:10px 15px;" onclick="switchPanel('data-project-html')">ğŸ“„ [project]/index.html</div>
                <div class="spacer"></div>
                <div class="menu-btn" onclick="switchPanel('users')">ğŸ‘¥ æ¨©é™ç®¡ç†</div>
                <div class="menu-btn" onclick="logout()" style="margin-top:auto; background:#c0392b; color:white;">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
            </div>

            <div class="main-content">
                <!-- è¨ˆç®—ãƒ‘ãƒãƒ« -->
                <div id="panel-calc" class="panel active">
                    <div class="calc-container">
                        <h2>ğŸ’° ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                        <div class="calc-grid">
                            <div><label>å‹•ç”»åºƒå‘Šå˜ä¾¡</label><input type="number" id="adPrice" value="1.5" step="0.1"></div>
                            <div><label>é€šè©±åŸä¾¡ (1åˆ†)</label><input type="number" id="callCost" value="3.0" step="0.1"></div>
                        </div>
                        <label>åˆ©ç›Šç‡ <span id="marginDisplay">20%</span></label>
                        <input type="range" id="margin" min="0" max="50" value="20" oninput="document.getElementById('marginDisplay').innerText = this.value + '%'">
                        <button class="btn-calc" onclick="calcSeconds()">è¨ˆç®—ã™ã‚‹</button>
                        <div class="calc-result-box"><div id="calcOutput" class="calc-number">--- ç§’</div></div>
                    </div>
                </div>

                <!-- CMSãƒ‘ãƒãƒ« -->
                <div id="panel-cms" class="panel">
                    <div class="cms-layout">
                        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ (40%) -->
                        <div class="editor-area">
                            <h2 style="display: flex; align-items: center; justify-content: space-between;">
                                <span>ğŸ“ è¨˜äº‹ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</span>
                                <span id="lastEditDatePop" style="display:none; font-size: 0.8rem; background: #e67e22; color: white; padding: 4px 12px; border-radius: 12px; font-weight: normal; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">å‰å›ç·¨é›†æ—¥: ----.--.--</span>
                            </h2>
                            
                            <div class="row-group">
                                <div class="form-group"><label>æ—¥ä»˜</label><input type="text" id="inDate" class="input-white"></div>
                                <div class="form-group">
                                    <label>ã‚«ãƒ†ã‚´ãƒª</label>
                                    <select id="inCategory" class="input-white" onchange="updatePreview()">
                                        <option value="update">æ›´æ–°æƒ…å ±</option>
                                        <option value="release">ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="start">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹</option>
                                        <option value="steam">Steamãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="game">ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (index_photãƒ•ã‚©ãƒ«ãƒ€)</label>
                                <input type="hidden" id="inImage" onchange="updatePreview()">
                                <div class="custom-select-wrapper">
                                    <div class="custom-select">
                                        <div class="custom-select__trigger" onclick="toggleImageSelect()"><span id="selectedImageText">ç”»åƒã‚’é¸æŠ...</span><span>â–¼</span></div>
                                        <div class="custom-options" id="imageOptions"></div>
                                    </div>
                                </div>
                            </div>

                            <hr style="border:0; border-top:1px dashed #555; margin: 20px 0;">

                            <div class="editor-lang-tabs">
                                <button class="edit-tab active" onclick="switchEditorLang('ja')">ğŸ‡¯ğŸ‡µ JP</button>
                                <button class="edit-tab" onclick="switchEditorLang('en')">ğŸ‡ºğŸ‡¸ EN</button>
                                <button class="edit-tab" onclick="switchEditorLang('de')">ğŸ‡©ğŸ‡ª DE</button>
                                <button class="edit-tab" onclick="switchEditorLang('fr')">ğŸ‡«ğŸ‡· FR</button>
                                <button class="edit-tab" onclick="switchEditorLang('es')">ğŸ‡ªğŸ‡¸ ES</button>
                            </div>

                            <!-- æ—¥æœ¬èª -->
                            <div id="group-ja" class="lang-input-group active">
                                <div class="form-group">
                                    <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå (JP)ã€€admin_master.js</label>
                                    <div class="input-group">
                                        <input type="text" id="inProject" class="input-white" oninput="autoFillProject()">
                                        <select id="projectSelectHelper" class="input-white" onchange="syncProjectSelect()"><option value="">â–¼ å±¥æ­´...</option></select>
                                    </div>
                                </div>
                                <div class="form-group"><label>ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ (JP)</label><textarea id="inTitle" class="input-white" rows="2" oninput="updatePreview()"></textarea></div>
                                
                                <div class="form-group">
                                    <div class="label-row">
                                        <label>ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ (JP)</label>
                                        <div class="status-switch">
                                            <label class="status-label"><input type="radio" name="appStatus" value="released" onchange="updatePreview()"> ãƒªãƒªãƒ¼ã‚¹æ¸ˆã¿</label>
                                            <label class="status-label"><input type="radio" name="appStatus" value="coming" checked onchange="updatePreview()"> Coming Soon</label>
                                        </div>
                                    </div>
                                    <textarea id="inBody" class="input-white" rows="3" oninput="updatePreview()"></textarea>
                                </div>
                                <!-- â˜…è¿½åŠ : ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ (JP) -->
                                <div class="form-group">
                                    <label>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ (JP)</label>
                                    <textarea id="inPrivacy" class="input-white" rows="8" placeholder="ï¼‘ï¼EUã®GDPRï¼ˆä¸€èˆ¬ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦å‰‡ï¼‰: ãƒ‰ã‚¤ãƒ„èªãƒ»ãƒ•ãƒ©ãƒ³ã‚¹èªãƒ»ã‚¹ãƒšã‚¤ãƒ³èªåœã«å‘ã‘ã¦é…ä¿¡ã™ã‚‹å ´åˆã€GDPRã®éµå®ˆãŒå¿…é ˆã§ã™ã€‚ã€ŒCookieã®åˆ©ç”¨ã€ã€ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å–å¾—ç›®çš„ã€ã€Œãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜å ´æ‰€ï¼ˆæ—¥æœ¬ã‹ç±³å›½ã‹ï¼‰ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹æ¨©åˆ©ãŒã‚ã‚‹ã“ã¨ã€ã‚’æ˜è¨˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚&#10;ï¼’ï¼ã‚«ãƒªãƒ•ã‚©ãƒ«ãƒ‹ã‚¢å·æ¶ˆè²»è€…ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ³• (CCPA): è‹±èªï¼ˆç±³å›½ï¼‰å‘ã‘ã«ã¯ã€ã€Œç§ã®å€‹äººæƒ…å ±ã‚’è²©å£²ã—ãªã„ã§ãã ã•ã„ï¼ˆDo Not Sell My Personal Infoï¼‰ã€ã¨ã„ã†è¦å®šã«é–¢ã™ã‚‹è¨˜è¼‰ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼ˆä»Šå›ã¯å€‹äººæƒ…å ±ã®è²©å£²ã¯ãªã„ã¨æ€ã„ã¾ã™ãŒã€ãã®æ—¨ã‚’æ˜è¨˜ã™ã‚‹ã¨å®‰å…¨ã§ã™ï¼‰ã€‚&#10;ï¼“ï¼AdMobã®è¨˜è¼‰: Google AdMobã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€ã€Œç¬¬ä¸‰è€…ã®åºƒå‘Šé…ä¿¡äº‹æ¥­è€…ãŒCookieã‚’ä½¿ç”¨ã—ã¦åºƒå‘Šã‚’é…ä¿¡ã—ã¦ã„ã‚‹ã“ã¨ã€ã‚’å…¨è¨€èªã§å¿…ãšè¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚"></textarea>
                                </div>
                            </div>

                            <!-- å¤šè¨€èª -->
                            <div id="group-en" class="lang-input-group">
                                <div class="form-group"><label>Project (EN)</label><input type="text" id="inProjectEn" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>Title (EN)</label><textarea id="inTitleEn" class="input-white" rows="2" oninput="updatePreview()"></textarea></div>
                                <div class="form-group"><label>App Intro (EN)</label><textarea id="inBodyEn" class="input-white" rows="3" oninput="updatePreview()"></textarea></div>
                                <!-- â˜…è¿½åŠ  -->
                                <div class="form-group"><label>Privacy Policy (EN)</label><textarea id="inPrivacyEn" class="input-white" rows="2" placeholder="ï¼•ã‚«å›½ã®æ³•å¾‹ãƒ»æƒ…å‹¢ãƒ»é€šä¿¡ç¶²ã«åˆã‚ã›ãŸãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚"></textarea></div>
                            </div>
                            <div id="group-de" class="lang-input-group"><div class="form-group"><label>Project (DE)</label><input type="text" id="inProjectDe" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (DE)</label><textarea id="inTitleDe" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (DE)</label><textarea id="inBodyDe" class="input-white" rows="3" oninput="updatePreview()"></textarea></div>
                                <div class="form-group"><label>Datenschutz (DE)</label><textarea id="inPrivacyDe" class="input-white" rows="2" placeholder="ï¼•ã‚«å›½ã®æ³•å¾‹ãƒ»æƒ…å‹¢ãƒ»é€šä¿¡ç¶²ã«åˆã‚ã›ãŸãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚"></textarea></div>
                            </div>
                            <div id="group-fr" class="lang-input-group"><div class="form-group"><label>Project (FR)</label><input type="text" id="inProjectFr" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (FR)</label><textarea id="inTitleFr" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (FR)</label><textarea id="inBodyFr" class="input-white" rows="3" oninput="updatePreview()"></textarea></div>
                                <div class="form-group"><label>ConfidentialitÃ© (FR)</label><textarea id="inPrivacyFr" class="input-white" rows="2" placeholder="ï¼•ã‚«å›½ã®æ³•å¾‹ãƒ»æƒ…å‹¢ãƒ»é€šä¿¡ç¶²ã«åˆã‚ã›ãŸãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚"></textarea></div>
                            </div>
                            <div id="group-es" class="lang-input-group"><div class="form-group"><label>Project (ES)</label><input type="text" id="inProjectEs" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (ES)</label><textarea id="inTitleEs" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (ES)</label><textarea id="inBodyEs" class="input-white" rows="3" oninput="updatePreview()"></textarea></div>
                                <div class="form-group"><label>Privacidad (ES)</label><textarea id="inPrivacyEs" class="input-white" rows="2" placeholder="ï¼•ã‚«å›½ã®æ³•å¾‹ãƒ»æƒ…å‹¢ãƒ»é€šä¿¡ç¶²ã«åˆã‚ã›ãŸãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚"></textarea></div>
                            </div>

                            <button class="btn-save" style="margin-top:20px;" onclick="saveToGitHub()">ğŸš€ GitHubã¸æ›´æ–°ä¿å­˜</button>
                        </div>

                        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (60%) -->
                        <div class="preview-area">
                            <div class="preview-header">
                                <h2 style="border:none; margin:0; font-size:1.1rem; color:#333;">ğŸ‘ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                            </div>
                            
                            <div style="margin-bottom:30px;">
                                <span class="preview-label">â–¼ ãŠçŸ¥ã‚‰ã› (News List)</span>
                                <div class="news-item">
                                    <span class="news-date" id="prevDate">2026.03.15</span>
                                    <span class="news-tag tag-update" id="prevTag">æ›´æ–°æƒ…å ±</span>
                                    <div style="flex:1;">
                                        <span style="font-weight:bold; margin-right:10px; color:#333;" id="prevProjectName">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                        <span class="news-link" id="prevTitle">ã‚¿ã‚¤ãƒˆãƒ«</span>
                                    </div>
                                </div>
                            </div>

                            <div class="preview-split-row">
                                <div class="split-col left">
                                    <span class="preview-label" style="margin-bottom:10px;">â–¼ æœ€æ–°ã®æ´»å‹• (Highlights)</span>
                                    <div class="highlight-card" id="prevHighlightCard">
                                        <div class="highlight-img-area">
                                            <img src="" alt="No Image" id="prevImg" class="highlight-img">
                                            <span class="highlight-category-badge tag-update" id="prevCardCatBadge">æ›´æ–°æƒ…å ±</span>
                                        </div>
                                        <div class="highlight-content-tight">
                                            <div class="highlight-meta" style="padding:0 10px;">
                                                <span class="meta-date" id="prevCardDate">2026.03.15</span> | 
                                                <span class="meta-proj" id="prevCardProj">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                            </div>
                                            <div class="highlight-title-tight" id="prevCardTitle" style="padding:0 10px 10px 10px;">ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="split-col right">
                                    <span class="preview-label" style="margin-bottom:10px;">â–¼ ã‚¢ãƒ—ãƒªç´¹ä»‹ (App List)</span>
                                    <div class="highlight-card">
                                        <div class="highlight-img-area">
                                            <img src="" alt="No Image" id="prevAppImg" class="highlight-img">
                                            <div id="comingSoonOverlay" class="coming-soon-overlay">Coming Soon</div>
                                            <div class="project-name-badge" id="prevAppProj">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</div>
                                        </div>
                                        <div class="app-desc-content">
                                            <div class="app-desc-text" id="prevAppDesc">ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <span class="preview-label">â–¼ è©³ç´°ãƒšãƒ¼ã‚¸ (Project Page)</span>
                            <div id="realPagePreview" style="display:none; width:100%; height:400px; border:1px solid #ccc; background:#fff;">
                                <iframe id="prevIframe" style="width:100%; height:100%; border:none;"></iframe>
                            </div>
                            <div id="simulatedPagePreview" class="page-preview">
                                <h1 id="prevPageTitle">ã‚¿ã‚¤ãƒˆãƒ«</h1>
                                <!-- â˜…è¿½åŠ : ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼è¡¨ç¤ºé ˜åŸŸ -->
                                <div id="prevPageCatchcopy" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; color: #333; line-height: 1.5; white-space: pre-wrap;">ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</div>
                                
                                <div style="display:none;">
                                    <span id="prevPageDate"></span> | <span id="prevPageProject"></span>
                                </div>
                                <img src="" id="prevPageImg" style="display:none;">
                                <div id="prevBody">æœ¬æ–‡...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="panel-projects" class="panel">
                    <div class="calc-container">
                        <h2>ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</h2>
                        <p>ã“ã“ã§ç™»éŒ²ã•ã‚ŒãŸã‚¢ãƒ—ãƒªä¸€è¦§ï¼ˆapps_catalog.jsï¼‰ã‚’ç®¡ç†ã—ã¾ã™ï¼ˆå®Ÿè£…æº–å‚™ä¸­ï¼‰</p>
                    </div>
                </div>
                <div id="panel-data-master" class="panel">
                    <div class="calc-container" style="max-width:100%;">
                        <h2>ğŸ“„ admin_master.js (ç›´æ¥ç·¨é›†)</h2>
                        <textarea id="raw-admin-master" style="width:100%; height:50vh; background:#1e1e1e; color:#0f0; font-family:monospace; padding:10px;"></textarea>
                        <button class="btn-save" onclick="saveRawData('admin_master.js', 'raw-admin-master')">ğŸ’¾ ä¸Šæ›¸ãä¿å­˜</button>
                    </div>
                </div>
                <div id="panel-data-index" class="panel">
                    <div class="calc-container" style="max-width:100%;">
                        <h2>ğŸ“„ index_news.js (ç›´æ¥ç·¨é›†)</h2>
                        <textarea id="raw-index-news" style="width:100%; height:50vh; background:#1e1e1e; color:#0f0; font-family:monospace; padding:10px;"></textarea>
                        <button class="btn-save" onclick="saveRawData('index_news.js', 'raw-index-news')">ğŸ’¾ ä¸Šæ›¸ãä¿å­˜</button>
                    </div>
                </div>
                <div id="panel-data-catalog" class="panel">
                    <div class="calc-container" style="max-width:100%;">
                        <h2>ğŸ“„ apps_catalog.js (ç›´æ¥ç·¨é›†)</h2>
                        <textarea id="raw-apps-catalog" style="width:100%; height:50vh; background:#1e1e1e; color:#0f0; font-family:monospace; padding:10px;"></textarea>
                        <button class="btn-save" onclick="saveRawData('apps_catalog.js', 'raw-apps-catalog')">ğŸ’¾ ä¸Šæ›¸ãä¿å­˜</button>
                    </div>
                </div>
                <div id="panel-data-project-html" class="panel">
                    <div class="calc-container" style="max-width:100%;">
                        <h2>ğŸ“„ [project]/index.html (ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)</h2>
                        <p style="color:#aaa;">ç¾åœ¨å…¥åŠ›ä¸­ã®å†…å®¹ã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹HTMLã‚³ãƒ¼ãƒ‰ã§ã™ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰ã€‚ä¿å­˜æ™‚ã«ã“ã®å†…å®¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œã‚‰ã‚Œã¾ã™ã€‚</p>
                        <textarea id="raw-project-html" style="width:100%; height:50vh; background:#1e1e1e; color:#0f0; font-family:monospace; padding:10px;" readonly></textarea>
                    </div>
                </div>
                <div id="panel-users" class="panel">
                    <div class="calc-container">
                        <h2>ğŸ‘¥ ç·¨é›†æ¨©é™è€…ã®ç®¡ç†</h2>
                        <div style="display:flex; gap:10px; margin-bottom:20px;">
                            <input type="text" id="newUserId" placeholder="GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼ID" class="input-white" style="flex:1;">
                            <button class="btn-save" style="width:auto; margin-top:0;" onclick="addUser()">è¿½åŠ </button>
                        </div>
                        <ul id="userList" style="background:#1e1e1e; padding:20px; border-radius:8px; list-style:none; max-height:300px; overflow-y:auto; border:1px solid #444;"></ul>
                        <button class="btn-copy" onclick="saveUsersToGitHub()">ğŸ’¾ æ¨©é™è¨­å®šã‚’GitHubã«ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
            // â–¼â–¼â–¼ è¨­å®š â–¼â–¼â–¼
            const GITHUB_CONFIG = { owner: "KeiAppLab", repo: "KeiAppLab" };
            let previewLang = 'ja';
            let currentProjectId = ""; // ç¾åœ¨å…¥åŠ›ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID
            
            // --- èªè¨¼ãƒ»åˆæœŸåŒ– ---
            async function checkIdentity() {
                const token = document.getElementById('tokenInput').value.trim() || arguments[0];
                const status = document.getElementById('authStatus');
                if (!token) { status.innerText = "âš ï¸ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›"; status.style.color = "orange"; return; }
                status.innerText = "ç¢ºèªä¸­..."; status.style.color = "black";
                try {
                    const res = await fetch("https://api.github.com/user", { headers: { Authorization: `token ${token}` } });
                    if (!res.ok) throw new Error("ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³");
                    const user = await res.json();
                    if (typeof allowedUsersData !== 'undefined' && allowedUsersData.includes(user.login)) {
                        localStorage.setItem('gh_token', token);
                        showDashboard();
                    } else { status.innerText = "âŒ æœªè¨±å¯ID: " + user.login; status.style.color = "red"; }
                } catch (err) { status.innerText = "âš ï¸ " + err.message; status.style.color = "red"; }
            }
            
            function showDashboard() {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainWrapper').style.display = 'block';
                updatePreview();
                initProjectList(); // admin_master.js ã‹ã‚‰å±¥æ­´ã‚’ç”Ÿæˆ
                initImageSelector(); // åˆå›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒãƒªã‚¹ãƒˆ
            }
            
            function logout() { localStorage.removeItem('gh_token'); location.reload(); }
            window.addEventListener('load', () => {
                const t = localStorage.getItem('gh_token'); if(t) checkIdentity(t); renderUserList();
            });
            
            // --- ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ ---
            function switchPanel(id) {
                document.querySelectorAll('.panel').forEach(e => e.classList.remove('active'));
                document.querySelectorAll('.menu-btn').forEach(e => e.classList.remove('active'));
                document.getElementById('panel-' + id).classList.add('active');
                event.currentTarget.classList.add('active');
    
                // ãƒ‘ãƒãƒ«ãŒé–‹ã‹ã‚ŒãŸã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’JSONæ–‡å­—åˆ—ã«ã—ã¦è¡¨ç¤º
                if (id === 'data-master') {
                    document.getElementById('raw-admin-master').value = JSON.stringify(typeof adminMasterData !== 'undefined' ? adminMasterData :[], null, 4);
                } else if (id === 'data-index') {
                    document.getElementById('raw-index-news').value = JSON.stringify(typeof indexNewsData !== 'undefined' ? indexNewsData :[], null, 4);
                } else if (id === 'data-catalog') {
                    document.getElementById('raw-apps-catalog').value = JSON.stringify(typeof appsCatalogData !== 'undefined' ? appsCatalogData :[], null, 4);
                } else if (id === 'data-project-html') {
                    // â˜…è¿½åŠ : ç¾åœ¨å…¥åŠ›ä¸­ã®å†…å®¹ã‹ã‚‰HTMLã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦è¡¨ç¤º
                    const dummyId = currentProjectId || "new_project_id";
                    // ç¾åœ¨ã®ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›å†…å®¹ã‚’åé›†
                    const inputData = getInputData(dummyId);
                    // HTMLæ–‡å­—åˆ—ã‚’ç”Ÿæˆ
                    const htmlCode = generateProjectHtmlString(dummyId, inputData);
                    document.getElementById('raw-project-html').value = htmlCode;
                }
            }
            

    // --- CMSãƒ­ã‚¸ãƒƒã‚¯: åˆæœŸåŒ–ã¨å…¥åŠ›è£œåŠ© ---
            
            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’å–å¾—ã™ã‚‹ä¾¿åˆ©é–¢æ•°
            function getTodayString() {
                const d = new Date();
                return d.getFullYear() + '.' + (d.getMonth()+1).toString().padStart(2,'0') + '.' + d.getDate().toString().padStart(2,'0');
            }
            
            // åˆæœŸåŒ–æ™‚ã«ä»Šæ—¥ã®æ—¥ä»˜ã‚’ã‚»ãƒƒãƒˆ
            document.getElementById('inDate').value = getTodayString();
            
            function switchEditorLang(lang) {
                document.querySelectorAll('.lang-input-group').forEach(e => e.classList.remove('active'));
                document.getElementById('group-' + lang).classList.add('active');
                document.querySelectorAll('.edit-tab').forEach(e => e.classList.remove('active'));
                event.currentTarget.classList.add('active');
                previewLang = lang; updatePreview();
            }
            
            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå±¥æ­´ (admin_master.js ã‹ã‚‰ç”Ÿæˆ)
            function initProjectList() {
                if (typeof adminMasterData === 'undefined') return;
                const sel = document.getElementById('projectSelectHelper');
                sel.innerHTML = '<option value="">â–¼ å±¥æ­´...</option>';
                adminMasterData.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.project_id; 
                    option.textContent = item.project_ja || item.project_id;
                    sel.appendChild(option);
                });
            }
            
            // å±¥æ­´é¸æŠæ™‚ã®è‡ªå‹•å…¥åŠ›
            function syncProjectSelect() {
                const sel = document.getElementById('projectSelectHelper');
                const pid = sel.value;
                if(pid){ 
                    const item = adminMasterData.find(d => d.project_id === pid);
                    if(item) fillForm(item);
                    sel.selectedIndex=0; 
                }
            }
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«åŸ‹ã‚è¾¼ã‚€å‡¦ç†
            function fillForm(data) {
                const langs = ['ja', 'en', 'de', 'fr', 'es'];
                langs.forEach(lang => {
                    const suffix = lang === 'ja' ? '' : lang.charAt(0).toUpperCase() + lang.slice(1);
                    document.getElementById('inProject' + suffix).value = data['project_' + lang] || "";
                    document.getElementById('inTitle' + suffix).value = data['title_' + lang] || "";
                    document.getElementById('inBody' + suffix).value = data['body_' + lang] || "";
                });
                
                setImageValue(data.image || "");
                
                if (data.status) {
                    const radio = document.querySelector(`input[name="appStatus"][value="${data.status}"]`);
                    if(radio) radio.checked = true;
                }
    
                // â˜…å¤‰æ›´: æ—¥ä»˜ã‚’POPã«è¡¨ç¤ºã™ã‚‹
                const pop = document.getElementById('lastEditDatePop');
                if (data.date) {
                    pop.textContent = "å‰å›ç·¨é›†æ—¥: " + data.date;
                    pop.style.display = "inline-block";
                } else {
                    pop.style.display = "none";
                }
                
                currentProjectId = data.project_id;
                updatePreview();
                checkProjectImages(data.project_id);
                checkProjectUrl(data.project_id);
            }
            
// â˜…ä¿®æ­£: æ—¥æœ¬èªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å¤‰æ›´ã—ãŸæ™‚ã®å‡¦ç†ï¼ˆå®Œå…¨ãƒªã‚»ãƒƒãƒˆå¯¾å¿œï¼‰
            function autoFillProject() {
                const val = document.getElementById('inProject').value.trim();
                
                // å…¥åŠ›æ¬„ãŒç©ºã®å ´åˆã®å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
                if(!val) { 
                    clearFieldsExcept('inProject');
                    document.getElementById('inDate').value = getTodayString();
                    document.getElementById('lastEditDatePop').style.display = "none"; // â˜…è¿½åŠ : POPã‚’æ¶ˆã™
                    currentProjectId = "";
                    setImageValue("");
                    initImageSelector(); // ç”»åƒãƒªã‚¹ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                    checkProjectUrl(""); // iframeãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’éè¡¨ç¤ºã«æˆ»ã™
                    updatePreview(); 
                    return; 
                }
    
                if (typeof adminMasterData !== 'undefined') {
                    const post = adminMasterData.find(p => p.project_ja === val);
                    if (post) {
                        // å±¥æ­´ã¨å®Œå…¨ã«ä¸€è‡´ã™ã‚Œã°ã€ãã®ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å…¥åŠ›
                        fillForm(post);
                    } else {
                        // å±¥æ­´ã«å­˜åœ¨ã—ãªã„æ–‡å­—ãŒæ‰“ãŸã‚ŒãŸå ´åˆ =ã€Œæ–°è¦ä½œæˆã€ã¨åˆ¤æ–­ã—ã¦ä»–ã‚’ã‚¯ãƒªã‚¢
                        clearFieldsExcept('inProject');
                        document.getElementById('inDate').value = getTodayString();
                        document.getElementById('lastEditDatePop').style.display = "none"; // â˜…è¿½åŠ : POPã‚’æ¶ˆã™
                        currentProjectId = "";
                        setImageValue("");
                        initImageSelector();
                        checkProjectUrl(""); 
                    }
                }
                updatePreview();
            }
    
            // ç‰¹å®šã®IDä»¥å¤–ã®è¨€èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç©ºã«ã™ã‚‹é–¢æ•°
            function clearFieldsExcept(excludeId) {
                const langs = ['ja', 'en', 'de', 'fr', 'es'];
                langs.forEach(lang => {
                    const suffix = lang === 'ja' ? '' : lang.charAt(0).toUpperCase() + lang.slice(1);
                    if ('inProject' + suffix !== excludeId) {
                        document.getElementById('inProject' + suffix).value = "";
                    }
                    document.getElementById('inTitle' + suffix).value = "";
                    document.getElementById('inBody' + suffix).value = "";
                });
            }
    
            // è‹±èªåå…¥åŠ›ã§IDç”Ÿæˆ
            document.getElementById('inProjectEn').addEventListener('input', async function() {
                const enName = this.value.trim();
                if (enName) {
                    currentProjectId = enName.replace(/\s+/g, '_').toLowerCase();
                    await checkProjectImages(currentProjectId);
                    checkProjectUrl(currentProjectId);
                }
                updatePreview();
            });
            
            // --- ç”»åƒé¸æŠãƒ­ã‚¸ãƒƒã‚¯ ---
            
            // â˜…ä¿®æ­£: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”»åƒã¨index_photç”»åƒã‚’ä¸¡æ–¹ãƒªã‚¹ãƒˆã«å‡ºã™
            async function checkProjectImages(projectId) {
                const token = localStorage.getItem('gh_token');
                let projectList = [];
                
                // 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã®ç”»åƒã‚’ãƒã‚§ãƒƒã‚¯
                if (token && projectId) {
                    try {
                        const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${projectId}`, {
                            headers: { Authorization: `token ${token}` }
                        });
                        if (res.ok) {
                            const files = await res.json();
                            // projectId/xxx.png ã¨ã„ã†ãƒ‘ã‚¹æƒ…å ±ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã™ã‚‹
                            projectList = files.filter(f => f.name.endsWith('.png')).map(f => ({ path: projectId + "/" + f.name, name: f.name }));
                        }
                    } catch (e) { /* ãƒ•ã‚©ãƒ«ãƒ€ãŒãªã„å ´åˆã¯ç„¡è¦– */ }
                }
                
                // 2. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(index_phot)ã®ç”»åƒã‚’ãƒªã‚¹ãƒˆåŒ–
                const defaultList = (typeof photoList !== 'undefined') ? photoList.map(n => ({ path: "index_phot/" + n, name: n })) : [];
                
                // 3. ä¸¡æ–¹ã®ãƒªã‚¹ãƒˆã‚’åˆä½“ã•ã›ã¦è¡¨ç¤º
                const combinedList = [...projectList, ...defaultList];
                renderImageSelectorCombined(combinedList);
            }
            
            function initImageSelector() {
                const defaultList = (typeof photoList !== 'undefined') ? photoList.map(n => ({ path: "index_phot/" + n, name: n })) : [];
                renderImageSelectorCombined(defaultList);
            }
            
            // åˆä½“ãƒªã‚¹ãƒˆç”¨ã®æç”»é–¢æ•°
            function renderImageSelectorCombined(listObj) {
                const c = document.getElementById('imageOptions'); 
                c.innerHTML='';
                listObj.forEach(item => {
                    const d = document.createElement('div'); 
                    d.className = 'custom-option';
                    d.onclick = () => { selectImage(item.path, item.name) }; 
                    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¡¨ç¤º
                    d.innerHTML = `<img src="${item.path}" class="option-img" onerror="this.src='https://via.placeholder.com/75'"><span class="option-text">${item.name}</span>`;
                    c.appendChild(d);
                });
            }
            
            function toggleImageSelect(){ document.querySelector('.custom-select').classList.toggle('open'); }
            function selectImage(p, n){ 
                document.getElementById('inImage').value = p; 
                document.getElementById('selectedImageText').textContent = n; 
                document.querySelector('.custom-select').classList.remove('open'); 
                updatePreview(); 
            }
            function setImageValue(p){ 
                document.getElementById('inImage').value = p; 
                document.getElementById('selectedImageText').textContent = p.split('/').pop() || "ç”»åƒã‚’é¸æŠ..."; 
            }
            window.onclick=e=>{ if(!e.target.closest('.custom-select')) document.querySelector('.custom-select').classList.remove('open'); }
            
            
            // --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ ---
            function checkProjectUrl(projectId) {
                // ç°¡æ˜“ãƒ­ã‚¸ãƒƒã‚¯: adminMasterDataã«IDãŒã‚ã‚Œã°ã€Œæ—¢å­˜ã€ã¨ã¿ãªã—ã¦iframeè¡¨ç¤º
                const exists = typeof adminMasterData !== 'undefined' && adminMasterData.some(d => d.project_id === projectId);
                const iframe = document.getElementById('prevIframe');
                const realPreview = document.getElementById('realPagePreview');
                const simPreview = document.getElementById('simulatedPagePreview');
                
                if (exists) {
                    realPreview.style.display = 'block';
                    simPreview.style.display = 'none';
                    iframe.src = `https://${GITHUB_CONFIG.owner.toLowerCase()}.github.io/${GITHUB_CONFIG.repo}/${projectId}/index.html`;
                } else {
                    realPreview.style.display = 'none';
                    simPreview.style.display = 'block';
                }
            }
            
            function updatePreview() {
                const date = document.getElementById('inDate').value;
                const cat = document.getElementById('inCategory').value;
                const img = document.getElementById('inImage').value;
                const s = previewLang==='ja'?'':previewLang.charAt(0).toUpperCase()+previewLang.slice(1);
                
                const proj = document.getElementById('inProject'+s).value || "Project";
                const title = document.getElementById('inTitle'+s).value || "Title";
                const body = document.getElementById('inBody'+s).value || "App Intro Body...";
                const statusRadio = document.querySelector('input[name="appStatus"]:checked');
                const isComingSoon = statusRadio && statusRadio.value === 'coming';
            
                // 1. ãŠçŸ¥ã‚‰ã›ãƒªã‚¹ãƒˆ (Titleã‚’è¡¨ç¤º)
                document.getElementById('prevDate').textContent=date;
                document.getElementById('prevTitle').textContent=title;
                document.getElementById('prevProjectName').textContent=proj;
                const tag = document.getElementById('prevTag');
                tag.className='news-tag tag-'+cat;
                // å¤šè¨€èªãƒãƒƒãƒ”ãƒ³ã‚°çœç•¥
                tag.textContent = cat; 
            
                // ç”»åƒ
                const setImg = (id) => {
                    const el = document.getElementById(id); el.src=img;
                    el.style.display = img ? 'block' : 'none';
                };
                setImg('prevImg'); setImg('prevAppImg'); setImg('prevPageImg');
            
                // 2. æœ€æ–°ã®æ´»å‹• (Titleã‚’è¡¨ç¤º)
                const card1 = document.getElementById('prevHighlightCard');
                // ãƒªãƒªãƒ¼ã‚¹æ ä»¥å¤–ã¯å°‘ã—è–„ãã™ã‚‹ãªã©ã®å‡¦ç†ãŒã‚ã‚Œã°ã“ã“ã«
                if(['release','start','steam'].includes(cat)) { card1.classList.remove('dimmed'); } else { card1.classList.add('dimmed'); }
    
                document.getElementById('prevCardTitle').textContent=title;
                document.getElementById('prevCardProj').textContent=proj;
                document.getElementById('prevCardDate').textContent=date;
                const badge = document.getElementById('prevCardCatBadge');
                badge.textContent=cat; badge.className='highlight-category-badge tag-'+cat;
                
                // 3. ã‚¢ãƒ—ãƒªç´¹ä»‹ (Bodyã‚’è¡¨ç¤º)
                document.getElementById('prevAppProj').textContent = proj;
                document.getElementById('prevAppDesc').textContent = body; // ã“ã“ã¯ç´¹ä»‹æ–‡
                const appImg = document.getElementById('prevAppImg');
                const overlay = document.getElementById('comingSoonOverlay');
                if(isComingSoon) { appImg.classList.add('coming-soon-mode'); overlay.style.display = 'block'; } else { appImg.classList.remove('coming-soon-mode'); overlay.style.display = 'none'; }
            
                // 4. è©³ç´°ãƒšãƒ¼ã‚¸ (ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
                document.getElementById('prevPageTitle').textContent=proj;
                // â˜…è¿½åŠ : ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸‹ã«ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ã‚’è¡¨ç¤º
                document.getElementById('prevPageCatchcopy').textContent=title;
                
                document.getElementById('prevPageDate').textContent="";
                document.getElementById('prevPageProject').textContent="";
                
                // â˜…ä¿®æ­£: æœ¬æ–‡ã®divã« white-space: pre-wrap; ã‚’è¿½åŠ ã—ã¦æ”¹è¡Œã‚’åæ˜ 
                let simHtml = `
                    <div style="margin-bottom: 20px; line-height:1.6; white-space: pre-wrap;">${body}</div>
                    
                    <h3 style="border-bottom:2px solid #ccc; padding-bottom:5px;">æœ€æ–°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹</h3>
                    <div style="margin-top:10px; padding:15px; background:#f9f9f9; border-left:4px solid #0056b3; border-radius:4px;">
                        <div style="color:#666; font-size:0.8rem; margin-bottom:5px;">${date}</div>
                        <div style="font-weight:bold;">${title}</div>
                    </div>
                    
                    <div style="margin-top:15px; text-align:right;">
                        <a href="#" style="color:#0056b3; text-decoration:none;">â–¶ ã™ã¹ã¦ã®æ›´æ–°å±¥æ­´ã‚’è¦‹ã‚‹ã€‚</a>
                    </div>
                `;
                document.getElementById('prevBody').innerHTML = simHtml;
            }
            
            // --- â˜…æ ¸å¿ƒï¼šä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ ---
            async function saveToGitHub() {
                const token = localStorage.getItem("gh_token");
                if (!token) { alert("èªè¨¼ãŒå¿…è¦ã§ã™"); return; }
            
                // 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDãƒã‚§ãƒƒã‚¯
                const projectEn = document.getElementById('inProjectEn').value.trim();
                if (!projectEn) { alert("âš ï¸ è‹±èªã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆIDç”Ÿæˆã«å¿…è¦ã§ã™ï¼‰"); return; }
                
                const projectId = projectEn.replace(/\s+/g, '_').toLowerCase();
                
                if(!confirm(`ä»¥ä¸‹ã®IDã§ä¿å­˜å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™ã€‚\nProject ID: ${projectId}\n\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) return;
            
                // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®åé›†
                const inputData = getInputData(projectId);
            
                try {
                    // --- A. admin_master.js (ç®¡ç†è€…ç”¨ãƒ»ä¸Šæ›¸ã) ---
                    let newMasterData = (typeof adminMasterData !== 'undefined') ? [...adminMasterData] : [];
                    const idx = newMasterData.findIndex(d => d.project_id === projectId);
                    if(idx >= 0) newMasterData[idx] = inputData.master; // ä¸Šæ›¸ã
                    else newMasterData.push(inputData.master); // æ–°è¦
                    
                    await writeJsFile('admin_master.js', newMasterData, "Update admin_master");
            
                    // --- B. index_news.js (ãƒˆãƒƒãƒ—ç”¨ãƒ»é€Ÿå ±) ---
                    let indexNews = (typeof indexNewsData !== 'undefined') ? [...indexNewsData] : [];
                    indexNews.unshift(inputData.indexItem);
                    
                    // ãƒªãƒªãƒ¼ã‚¹æ (10)ã¨æ›´æ–°æ (10)ã«åˆ†ã‘ã¦æŠ½å‡º
                    const releaseCats = ['release', 'start', 'steam'];
                    const updateCats = ['update', 'game'];
                    
                    const releases = indexNews.filter(i => releaseCats.includes(i.category)).slice(0, 10);
                    const updates = indexNews.filter(i => updateCats.includes(i.category)).slice(0, 10);
                    const newIndexNews = [...releases, ...updates];
                    
                    await writeJsFile('index_news.js', newIndexNews, "Update index_news");
            
                    // --- C. apps_catalog.js (ä¸€è¦§ç”¨ãƒ»ã‚«ã‚¿ãƒ­ã‚°) ---
                    let catalog = (typeof appsCatalogData !== 'undefined') ? [...appsCatalogData] : [];
                    const catIdx = catalog.findIndex(d => d.project_id === projectId);
                    if(catIdx >= 0) catalog[catIdx] = inputData.catalogItem;
                    else catalog.push(inputData.catalogItem);
                    
                    await writeJsFile('apps_catalog.js', catalog, "Update apps_catalog");
            
                    // --- D. [id]/news.js (å€‹åˆ¥æœ€æ–°3ä»¶) ---
                    const newsPath = `${projectId}/news.js`;
                    let currentAppNews = await fetchExistingJs(newsPath) || [];
                    currentAppNews.unshift(inputData.newsItem);
                    const newAppNews = currentAppNews.slice(0, 3); // æœ€æ–°3ä»¶
                    
                    await writeJsFile(newsPath, newAppNews, `Update ${projectId} news`);
            
                    // --- E. [id]/old_news.js (ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–) ---
                    const oldNewsPath = `${projectId}/old_news.js`;
                    let currentOldNews = await fetchExistingJs(oldNewsPath) || [];
                    currentOldNews.unshift(inputData.newsItem); // å…¨ä»¶ä¿å­˜ï¼ˆå‰Šé™¤ãªã—ï¼‰
                    
                    await writeJsFile(oldNewsPath, currentOldNews, `Update ${projectId} archive`);
            
// --- F. ç”»åƒã‚³ãƒ”ãƒ¼ & HTMLç”Ÿæˆ (æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ™‚) ---
                    // ç”»åƒãƒ‘ã‚¹ãŒ index_phot/ å§‹ã¾ã‚Šãªã‚‰ã€ãã‚Œã‚’/index.png ã«ã‚³ãƒ”ãƒ¼
                    if (inputData.master.image.startsWith('index_phot/')) {
                        await copyImageToProject(inputData.master.image, `${projectId}/index.png`);
                    }
            
                    // HTMLç”Ÿæˆ (/index.html ãŒãªã‘ã‚Œã°ä½œæˆ)
                    // â˜…ä¿®æ­£: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿(inputData)ã‚’æ¸¡ã—ã¦ã€HTMLå†…ã«é™çš„ã«åŸ‹ã‚è¾¼ã‚€
                    await createProjectHtml(projectId, inputData);
            
                    // â˜…è¿½åŠ : ä¿å­˜å®Œäº†å¾Œã«ã€Œå‰å›ç·¨é›†æ—¥POPã€ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                    const pop = document.getElementById('lastEditDatePop');
                    if(pop) pop.style.display = "none";

                    // ç›£è¦–é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™
                    startBuildMonitor();
            
                } catch (err) {
                    console.error(err);
                    alert("âŒ ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + err.message);
                }
            }

// ç›´æ¥ç·¨é›†ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼ˆå®‰å…¨å¯¾ç­–ãƒ»ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå¼·åŒ–ç‰ˆï¼‰
            async function saveRawData(filename, textareaId) {
                const textarea = document.getElementById(textareaId);
                let parsedData;
                
                // 1. JSONã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚º
                try {
                    // å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è§£é‡ˆï¼ˆæ§‹æ–‡ãŒé–“é•ã£ã¦ã„ã‚Œã°ã“ã“ã§å¼¾ãï¼‰
                    parsedData = JSON.parse(textarea.value); 
                } catch (e) {
                    alert("âŒ JSONã®æ›¸ãæ–¹ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚\nã€Œ , (ã‚«ãƒ³ãƒ) ã€ã®ä»˜ã‘å¿˜ã‚Œã‚„ã€ã€Œ \" (ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³) ã€ã®æ¶ˆã—å¿˜ã‚ŒãŒãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n\nè©³ç´°: " + e.message);
                    return; // ã‚¨ãƒ©ãƒ¼ãªã‚‰é€šä¿¡ã•ã›ãšã«ã“ã“ã§å‡¦ç†ã‚’æ­¢ã‚ã‚‹ï¼ˆå®‰å…¨ã‚¬ãƒ¼ãƒ‰ï¼‰
                }

                // 2. ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ãƒã‚§ãƒƒã‚¯ï¼ˆæ„å›³ã—ãªã„å½¢å¼ã¸ã®ç ´å£Šé˜²æ­¢ï¼‰
                if (!Array.isArray(parsedData)) {
                    alert("âŒ ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ¼ã‚¿ã¯å…¨ä½“ãŒ [ ] ã§å›²ã¾ã‚ŒãŸé…åˆ—å½¢å¼ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
                    return;
                }

                // 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æœ€çµ‚ç¢ºèª
                if(!confirm(`${filename} ã‚’æ‰‹å‹•ã§ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) return;
                
                try {
                    // ä¿å­˜ã™ã‚‹ç›´å‰ã«ã€ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ä¸­èº«ã‚’æ©Ÿæ¢°ãŒèª­ã¿ã‚„ã™ã„ã‚ˆã†ã«ç¶ºéº—ã«è‡ªå‹•æ•´å½¢ã™ã‚‹
                    textarea.value = JSON.stringify(parsedData, null, 4);
                    
                    // GitHubã¸æ›¸ãè¾¼ã¿
                    await writeJsFile(filename, parsedData, `Manual edit ${filename}`);
                    alert("âœ… ä¿å­˜ã—ã¾ã—ãŸï¼");
                    location.reload();
                } catch (e) {
                    // GitHub API ã®é€šä¿¡ã‚¨ãƒ©ãƒ¼ã¯ã“ã¡ã‚‰ã§ã‚­ãƒ£ãƒƒãƒ
                    alert("âŒ GitHubã¸ã®ä¿å­˜ä¸­ã«é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n" + e.message);
                }
            }
            
            // ãƒ‡ãƒ¼ã‚¿åé›†ãƒ˜ãƒ«ãƒ‘ãƒ¼
            function getInputData(pid) {
                const date = document.getElementById('inDate').value;
                const cat = document.getElementById('inCategory').value;
                const img = document.getElementById('inImage').value; // ãƒ•ãƒ«ãƒ‘ã‚¹
                const status = document.querySelector('input[name="appStatus"]:checked').value;
                
                // å¤šè¨€èªãƒ‡ãƒ¼ã‚¿ã®å–å¾—
                const langs = ['ja', 'en', 'de', 'fr', 'es'];
                let names={}, titles={}, bodies={}, privacies={};
                langs.forEach(l => {
                    const s = l==='ja'?'':l.charAt(0).toUpperCase()+l.slice(1);
                    names['project_'+l] = document.getElementById('inProject'+s).value;
                    titles['title_'+l] = document.getElementById('inTitle'+s).value;
                    bodies['body_'+l] = document.getElementById('inBody'+s).value;
                    // â˜…è¿½åŠ : ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®å–å¾—
                    privacies['privacy_'+l] = document.getElementById('inPrivacy'+s) ? document.getElementById('inPrivacy'+s).value : "";
                });
            
                // 1. Masterç”¨ ã« privacies ã‚’è¿½åŠ 
                const master = { project_id: pid, date, category: cat, image: img, status, ...names, ...titles, ...bodies, ...privacies };
            
                // 2. Indexç”¨ (ãŠçŸ¥ã‚‰ã›é‡è¦–ãƒ»ç´¹ä»‹æ–‡ãªã—ãƒ»ç”»åƒã¯å›ºå®šãƒ‘ã‚¹åŒ–)
                const indexItem = {
                    id: Date.now(), // ä¸€æ„ã®ID
                    date, category: cat,
                    image: `${pid}/index.png`, // å›ºå®šãƒ‘ã‚¹
                    link: `${pid}/index.html`,
                    ...names, ...titles // ç´¹ä»‹æ–‡ãªã—
                };
            
                // 3. Catalogç”¨ (ç´¹ä»‹æ–‡é‡è¦–ãƒ»ãŠçŸ¥ã‚‰ã›ãªã—)
                const catalogItem = {
                    project_id: pid,
                    status,
                    image: `${pid}/index.png`,
                    ...names, ...bodies // ãŠçŸ¥ã‚‰ã›ãªã—
                };
            
                // 4. AppNewsç”¨ (ãŠçŸ¥ã‚‰ã›ã®ã¿)
                const newsItem = {
                    date, category: cat,
                    ...titles // ãŠçŸ¥ã‚‰ã›ã®ã¿
                };
            
                return { master, indexItem, catalogItem, newsItem };
            }
            
            // GitHub API ãƒ˜ãƒ«ãƒ‘ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿
            async function writeJsFile(path, dataObj, msg) {
                const token = localStorage.getItem("gh_token");
                // æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®SHAã‚’å–å¾—ã—ã¦ä¸Šæ›¸ã
                let sha = null;
                try {
                    const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                        headers: { Authorization: `token ${token}` }
                    });
                    if (res.ok) {
                        const json = await res.json();
                        sha = json.sha;
                    }
                } catch(e) {}
            
                // JSãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã«å¤‰æ›
                // pathã‹ã‚‰å¤‰æ•°åã‚’æ¨æ¸¬ (ç°¡æ˜“çš„)
                let varName = "data";
                if(path.includes("admin_master")) varName = "adminMasterData";
                else if(path.includes("index_news")) varName = "indexNewsData";
                else if(path.includes("apps_catalog")) varName = "appsCatalogData";
                else if(path.includes("old_news")) varName = "oldNewsData"; // å…ˆã«åˆ¤å®š
                else if(path.includes("news")) varName = "newsData";
            
                const contentStr = `const ${varName} = ${JSON.stringify(dataObj, null, 4)};`;
                const encoded = btoa(unescape(encodeURIComponent(contentStr)));
            
                const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                    method: "PUT",
                    headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ message: msg, content: encoded, sha: sha })
                });
                if (!res.ok) throw new Error(`Failed to write ${path}`);
            }
            
            // GitHub API ãƒ˜ãƒ«ãƒ‘ãƒ¼: æ—¢å­˜JSã®èª­ã¿è¾¼ã¿
            async function fetchExistingJs(path) {
                const token = localStorage.getItem("gh_token");
                try {
                    const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                        headers: { Authorization: `token ${token}` } // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿æ¨å¥¨
                    });
                    if (!res.ok) return null;
                    const json = await res.json();
                    const content = decodeURIComponent(escape(atob(json.content)));
                    // JSONéƒ¨åˆ†ã‚’æŠ½å‡º
                    const match = content.match(/\[.*\]/s); // é…åˆ—ã‚’æ¢ã™
                    if (match) return JSON.parse(match[0]);
                } catch (e) { console.log("File not found or parse error:", path); }
                return null;
            }
            
            // ç”»åƒã‚³ãƒ”ãƒ¼
            async function copyImageToProject(srcPath, destPath) {
                const token = localStorage.getItem("gh_token");
                // 1. å…ƒç”»åƒã‚’ãƒã‚¤ãƒŠãƒª(Blob->Base64)ã§å–å¾—
                const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${srcPath}`, {
                    headers: { Authorization: `token ${token}` }
                });
                if(!res.ok) return; // ç”»åƒãŒãªã„
                const data = await res.json();
                const content = data.content; // Base64ã®ã¾ã¾
            
                // 2. å®›å…ˆã«æ›¸ãè¾¼ã¿ (å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã—ã¦ä¸Šæ›¸ãã™ã‚‹ã‹ã€å¸¸ã«ã™ã‚‹ã‹ã€‚ã“ã“ã§ã¯å¸¸ã«ä¸Šæ›¸ã)
                let sha = null;
                try {
                    const check = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${destPath}`, {
                         headers: { Authorization: `token ${token}` }
                    });
                    if(check.ok) sha = (await check.json()).sha;
                } catch(e){}
            
                await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${destPath}`, {
                    method: "PUT",
                    headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "Copy image to project folder",
                        content: content,
                        sha: sha
                    })
                });
            }
            
// HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ (å®Œå…¨ç‹¬ç«‹å‹ãƒ»å¤šè¨€èªå¯¾å¿œãƒ»é€šä¿¡æœ€é©åŒ–æ¸ˆã¿)
           // --- â˜…è¿½åŠ : HTMLæ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ç‹¬ç«‹é–¢æ•° ---
            function generateProjectHtmlString(projectId, inputData) {
                const projectJa = inputData.master.project_ja || projectId;
                const appDataJson = JSON.stringify(inputData.master);
    
                return `<!DOCTYPE html>
    <html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>${projectJa}</title>
        <script src="news.js"><\/script>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@500;900&display=swap');
            body { font-family: 'Noto Serif JP', serif; background: #fff; color: #333; padding: 0; margin: 0; line-height: 1.8; overflow-x: hidden; }
            .top-nav { position: fixed; top: 15px; left: 50%; transform: translateX(-50%); width: 100%; max-width: 1100px; padding: 0 20px; box-sizing: border-box; display: flex; justify-content: space-between; align-items: flex-start; z-index: 1000; pointer-events: none; }
            .top-nav > * { pointer-events: auto; }
            .back-btn { cursor: pointer; font-family: 'Roboto', sans-serif; font-weight: 900; color: #0056b3; text-decoration: none; display: flex; align-items: center; gap: 5px; background: rgba(255,255,255,0.8); padding: 5px 10px; border-radius: 8px; backdrop-filter: blur(2px); }
            .back-btn:hover { color: #003d82; }
            .lang-menu-wrapper { position: relative; }
            .lang-main-btn { background: #0056b3; color: #fff; border: none; padding: 8px 15px; border-radius: 20px; font-family: 'Roboto', sans-serif; font-weight: 900; cursor: pointer; z-index: 10; position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
            .lang-sub-btns { position: absolute; top: 10px; right: 0; display: flex; flex-direction: row-reverse; pointer-events: none; }
            .lang-circle { width: 35px; height: 35px; border-radius: 50%; color: white; border: none; font-family: 'Roboto', sans-serif; font-weight: bold; font-size: 0.8rem; display: flex; justify-content: center; align-items: center; cursor: pointer; position: absolute; right: 0; top: 0; opacity: 0; transform: translateY(0) translateX(0); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
            .lang-ja { background: #e74c3c; z-index: 5; } .lang-en { background: #3498db; z-index: 4; } .lang-de { background: #f1c40f; color: #333; z-index: 3; } .lang-fr { background: #9b59b6; z-index: 2; } .lang-es { background: #e67e22; z-index: 1; }
            .lang-menu-wrapper.open .lang-sub-btns { pointer-events: auto; }
            .lang-menu-wrapper.open .lang-circle { opacity: 1; }
            .lang-menu-wrapper.open .lang-circle:nth-child(1) { transform: translateY(45px) translateX(0); }
            .lang-menu-wrapper.open .lang-circle:nth-child(2) { transform: translateY(45px) translateX(-45px); }
            .lang-menu-wrapper.open .lang-circle:nth-child(3) { transform: translateY(45px) translateX(-90px); }
            .lang-menu-wrapper.open .lang-circle:nth-child(4) { transform: translateY(45px) translateX(-135px); }
            .lang-menu-wrapper.open .lang-circle:nth-child(5) { transform: translateY(45px) translateX(-180px); }
            .main-content { max-width: 800px; margin: 80px auto 40px auto; padding: 20px; }
            h1 { border-bottom: 3px solid #0056b3; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; font-size: 1.5rem; }
            .catchcopy { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; color: #333; line-height: 1.5; white-space: pre-wrap; }
            img { max-width: 100%; border-radius: 10px; margin: 20px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
            .app-desc { margin-bottom: 30px; line-height: 1.8; white-space: pre-wrap; }
            .news-box { margin-top: 15px; padding: 15px; background: #f9f9f9; border-left: 4px solid #0056b3; border-radius:4px; animation: fadeIn 0.5s; }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            .date { color: #666; font-size: 0.8rem; margin-bottom: 5px; }
            .history-link { display: inline-block; margin-top: 15px; color: #0056b3; text-decoration: none; font-weight:bold; cursor: pointer; padding: 10px; border-radius: 5px; background: #f0f8ff; }
            .history-link:hover { text-decoration: underline; background: #e0f0ff; }
            
            /* â˜…è¿½åŠ : å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆåˆ¥çª“é¢¨ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
            .history-modal { display: none; margin-top: 10px; padding: 20px; background: #fff; border: 2px solid #0056b3; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); max-height: 400px; overflow-y: auto; position: relative; animation: fadeIn 0.3s; }
            .modal-close { position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 1.5rem; font-weight: bold; color: #999; }
            .modal-close:hover { color: #333; }
            .history-list-item { display: flex; align-items: flex-start; gap: 15px; border-bottom: 1px solid #eee; padding: 10px 0; }
            .history-list-item:last-child { border-bottom: none; }
            .history-date { font-family: 'Roboto', sans-serif; font-size: 0.85rem; color: #666; white-space: nowrap; padding-top: 3px; }
            .history-title { font-weight: bold; color: #333; line-height: 1.4; }

            .footer { margin-top: 50px; padding-top: 20px; border-top: 1px solid #eee; text-align: center; font-size: 0.85rem; color: #666; }
            .footer a { color: #0056b3; text-decoration: none; font-weight: bold; }
        </style>
    </head>
    <body>
        <div class="top-nav">
            <a href="#" class="back-btn" onclick="goBack(event)">ğŸ”™ <span id="back-text">æˆ»ã‚‹</span></a>
            <div class="lang-menu-wrapper" id="langMenu">
                <button class="lang-main-btn" onclick="toggleLangMenu()">Language â–¼</button>
                <div class="lang-sub-btns">
                    <button class="lang-circle lang-es" onclick="changeLang('es')">ES</button>
                    <button class="lang-circle lang-fr" onclick="changeLang('fr')">FR</button>
                    <button class="lang-circle lang-de" onclick="changeLang('de')">DE</button>
                    <button class="lang-circle lang-en" onclick="changeLang('en')">EN</button>
                    <button class="lang-circle lang-ja" onclick="changeLang('ja')">JP</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <h1 id="app-title">Loading...</h1>
            <!-- â˜…è¿½åŠ : å®Ÿéš›ã®HTMLå´ã«ã‚‚ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼æ ã‚’è¨­ã‘ã‚‹ -->
            <div id="app-catchcopy" class="catchcopy"></div>
            
            <img src="index.png" alt="App Image">
            <div id="app-desc" class="app-desc"></div>
            
            <h3 id="news-heading" style="border-bottom:2px solid #ccc; padding-bottom:5px;">æœ€æ–°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹</h3>
            <div id="news-container"></div>
            
            <div style="text-align: right; position: relative;">
                <a class="history-link" id="history-link" onclick="loadOldNews(event)">â–¶ ã™ã¹ã¦ã®æ›´æ–°å±¥æ­´ã‚’è¦‹ã‚‹ã€‚</a>
                <!-- â˜…è¿½åŠ : ãƒ¢ãƒ¼ãƒ€ãƒ«é ˜åŸŸ -->
                <div id="history-modal" class="history-modal" style="text-align: left;">
                    <span class="modal-close" onclick="document.getElementById('history-modal').style.display='none'">Ã—</span>
                    <h4 id="modal-heading" style="margin-top:0; color:#0056b3;">æ›´æ–°å±¥æ­´</h4>
                    <div id="modal-content"></div>
                </div>
            </div>
            <div class="footer">
                <a href="#" id="privacy-link" onclick="checkPrivacy(event)">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a><br><br>
                Â© 2026 å•“ App Lab | <a href="../app-ads.txt" target="_blank">app-ads.txt</a>
            </div>
        </div>
        <script>
            const appData = ${appDataJson};
            let currentLang = localStorage.getItem('selectedLang') || 'ja';
            const texts = {
                ja: { back: "æˆ»ã‚‹", backTop: "å•“(KEI)App Labã¸æˆ»ã‚‹", news: "æœ€æ–°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹", history: "â–¶ ã™ã¹ã¦ã®æ›´æ–°å±¥æ­´ã‚’è¦‹ã‚‹ã€‚", loading: "èª­ã¿è¾¼ã¿ä¸­...", noNews: "ç¾åœ¨ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚", privacy: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼", privAlert: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¯ç¾åœ¨æº–å‚™ä¸­ï¼ˆå®Ÿè£…äºˆå®šï¼‰ã§ã™ã€‚" },
                en: { back: "Back", backTop: "Back to KEI App Lab", news: "Latest News", history: "â–¶ View all history", loading: "Loading...", noNews: "No news available.", privacy: "Privacy Policy", privAlert: "Privacy Policy is currently under preparation." },
                de: { back: "ZurÃ¼ck", backTop: "ZurÃ¼ck zu KEI App Lab", news: "Aktuelle News", history: "â–¶ Gesamten Verlauf", loading: "Wird geladen...", noNews: "Keine Nachrichten.", privacy: "Datenschutzrichtlinie", privAlert: "Die Datenschutzrichtlinie ist in Vorbereitung." },
                fr: { back: "Retour", backTop: "Retour Ã  KEI App Lab", news: "DerniÃ¨res Nouvelles", history: "â–¶ Voir tout l'historique", loading: "Chargement...", noNews: "Aucune nouvelle.", privacy: "Politique de confidentialitÃ©", privAlert: "La politique de confidentialitÃ© est en cours de prÃ©paration." },
                es: { back: "Volver", backTop: "Volver a KEI App Lab", news: "Ãšltimas Noticias", history: "â–¶ Ver todo el historial", loading: "Cargando...", noNews: "No hay noticias.", privacy: "PolÃ­tica de privacidad", privAlert: "La polÃ­tica de privacidad estÃ¡ en preparaciÃ³n." }
            };
            function goBack(e) { e.preventDefault(); if (history.length <= 1 || document.referrer === "") window.location.href = "../index.html"; else history.back(); }
            function toggleLangMenu() { document.getElementById('langMenu').classList.toggle('open'); }
            function changeLang(lang) { currentLang = lang; localStorage.setItem('selectedLang', lang); document.getElementById('langMenu').classList.remove('open'); renderPage(); }
            function renderPage(targetData = null) {
                const suffix = currentLang === 'ja' ? '' : '_' + currentLang;
                const t = texts[currentLang] || texts.en;
                const isDirectLink = (history.length <= 1 || document.referrer === "");
                document.getElementById('back-text').textContent = isDirectLink ? t.backTop : t.back;
                document.getElementById('news-heading').textContent = t.news;
                const hLink = document.getElementById('history-link');
                if(hLink.style.display !== 'none') hLink.textContent = t.history;
                document.getElementById('privacy-link').textContent = t.privacy;
                
                const projName = appData['project' + suffix] || appData.project_ja || '${projectId}';
                document.getElementById('app-title').textContent = projName;
                
                // â˜…è¿½åŠ : ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ã¨æœ¬æ–‡ã®æµã—è¾¼ã¿ï¼ˆæ”¹è¡Œå¯¾å¿œæ¸ˆã¿ï¼‰
                document.getElementById('app-catchcopy').textContent = appData['title' + suffix] || appData.title_ja || '';
                document.getElementById('app-desc').textContent = appData['body' + suffix] || appData.body_ja || '';
    
                const dataToRender = targetData || (typeof newsData !== 'undefined' ? newsData : []);
                const container = document.getElementById('news-container');
                container.innerHTML = '';
                if(dataToRender.length > 0){
                    dataToRender.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'news-box';
                        const title = item['title' + suffix] || item.title_ja || item.title_en || '';
                        div.innerHTML = '<div class="date">' + item.date + '</div><div style="font-weight:bold; white-space: pre-wrap;">' + title + '</div>';
                        container.appendChild(div);
                    });
                } else { container.innerHTML = '<p>' + t.noNews + '</p>'; }
            }
// --- å‹•çš„ãƒ­ãƒ¼ãƒ‰ï¼šå…¨å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’åˆ¥çª“ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰ã«è¡¨ç¤º ---
            function loadOldNews(e) {
                e.preventDefault(); 
                const link = document.getElementById('history-link'); 
                const modal = document.getElementById('history-modal');
                const modalContent = document.getElementById('modal-content');
                const t = texts[currentLang] || texts.en;
                
                // ã™ã§ã«é–‹ã„ã¦ã„ã‚‹å ´åˆã¯é–‰ã˜ã‚‹
                if (modal.style.display === 'block') {
                    modal.style.display = 'none';
                    return;
                }

                link.textContent = t.loading; link.style.pointerEvents = 'none';
                const script = document.createElement('script'); script.src = 'old_news.js';
                
                script.onload = () => { 
                    link.textContent = t.history; // ãƒ†ã‚­ã‚¹ãƒˆã‚’å…ƒã«æˆ»ã™
                    link.style.pointerEvents = 'auto';
                    modal.style.display = 'block'; // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
                    
                    modalContent.innerHTML = '';
                    if(typeof oldNewsData !== 'undefined' && oldNewsData.length > 0) {
                        const suffix = currentLang === 'ja' ? '' : '_' + currentLang;
                        oldNewsData.forEach(item => {
                            const title = item['title' + suffix] || item.title_ja || item.title_en || '';
                            // â˜…ä¿®æ­£: æ—¥ä»˜ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ¨ªã«ä¸¦ã¹ã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
                            modalContent.innerHTML += \`<div class="history-list-item"><div class="history-date">\${item.date}</div><div class="history-title">\${title}</div></div>\`;
                        });
                    } else {
                        modalContent.innerHTML = '<p>' + t.noNews + '</p>';
                    }
                };
                script.onerror = () => { 
                    link.textContent = 'Data Load Error'; link.style.pointerEvents = 'auto'; 
                };
                document.body.appendChild(script);
            }
            async function checkPrivacy(e) { e.preventDefault(); const t = texts[currentLang] || texts.en; try { const res = await fetch('../privacy.html', { method: 'HEAD' }); if (res.ok) window.location.href = '../privacy.html'; else throw new Error('Not Found'); } catch (err) { alert(t.privAlert); } }
            document.addEventListener("DOMContentLoaded", () => { renderPage(); });
        <\/script>
    </body>
    </html>`;
            }     
            async function createProjectHtml(projectId, inputData) {
                const path = `${projectId}/index.html`;
                const token = localStorage.getItem("gh_token");
                
                const check = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                     headers: { Authorization: `token ${token}` }
                });
                if(check.ok) return; 
            
                const htmlContent = generateProjectHtmlString(projectId, inputData);
                const encoded = btoa(unescape(encodeURIComponent(htmlContent)));

                // â˜…è¿½åŠ : å®Ÿéš›ã«GitHubã¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€ä¿¡ã™ã‚‹å‡¦ç†
                await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                    method: "PUT",
                    headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "Create project index.html",
                        content: encoded
                    })
                });
            }
            
            // --- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ»è¨ˆç®— (å¾©å…ƒæ¸ˆã¿) ---
            function renderUserList() {
                const list = document.getElementById('userList');
                if(!list) return;
                list.innerHTML = '';
                if (typeof allowedUsersData !== 'undefined') {
                    allowedUsersData.forEach((user, index) => {
                        const li = document.createElement('li');
                        li.style = "display:flex; justify-content:space-between; align-items:center; padding:5px 0; border-bottom:1px solid #444; color:#fff;";
                        li.innerHTML = `<span>${user}</span><button style="background:#c0392b; width:auto; padding:2px 8px; font-size:0.8rem; margin:0;" onclick="removeUser(${index})">å‰Šé™¤</button>`;
                        list.appendChild(li);
                    });
                }
            }
            function addUser() {
                const input = document.getElementById('newUserId');
                const id = input.value.trim();
                if(!id) return;
                if(allowedUsersData.includes(id)) { alert("æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™"); return; }
                allowedUsersData.push(id);
                input.value = '';
                renderUserList();
            }
            function removeUser(index) {
                if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) { allowedUsersData.splice(index, 1); renderUserList(); }
            }
            async function saveUsersToGitHub() {
                const token = localStorage.getItem("gh_token");
                if (!token) { alert("èªè¨¼ãŒå¿…è¦ã§ã™"); return; }
                if(!confirm("GitHubä¸Šã® allowed_users.js ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
                const jsonString = JSON.stringify(allowedUsersData, null, 4);
                const content = `// ç·¨é›†æ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆ\nconst allowedUsersData = ${jsonString};`;
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                try {
                    const getRes = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/allowed_users.js`, { headers: { Authorization: `token ${token}` } });
                    const fileData = await getRes.json();
                    const putRes = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/allowed_users.js`, {
                        method: "PUT",
                        headers: { Authorization: `token ${token}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ message: "Update allowed users list", content: encodedContent, sha: fileData.sha })
                    });
                    if (putRes.ok) alert("æ¨©é™è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸï¼"); else alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                } catch (err) { alert("ã‚¨ãƒ©ãƒ¼: " + err.message); }
            }
    
            function calcSeconds() {
                const adPrice = parseFloat(document.getElementById('adPrice').value);
                const callCost = parseFloat(document.getElementById('callCost').value);
                const margin = parseFloat(document.getElementById('margin').value);
                const costPerSec = callCost / 60;
                const profit = adPrice * (margin / 100);
                const seconds = Math.floor((adPrice - profit) / costPerSec);
                document.getElementById('calcOutput').innerText = seconds + " ç§’";
            }

            // --- GitHub Actions ç›£è¦–ãƒ­ã‚¸ãƒƒã‚¯ ---
            async function startBuildMonitor() {
                const toast = document.getElementById('build-toast');
                const icon = document.getElementById('toast-icon');
                const msg = document.getElementById('toast-msg');
                
                // ãƒˆãƒ¼ã‚¹ãƒˆã‚’è¡¨ç¤º
                toast.style.display = 'flex';
                icon.className = 'spinner';
                icon.textContent = '';
                msg.innerHTML = `ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜å®Œäº†ã€‚<br>GitHubã§å…¬é–‹æº–å‚™ä¸­...ï¼ˆç´„1ã€œ3åˆ†ï¼‰`;
    
                const token = localStorage.getItem("gh_token");
                // GitHub Actionsã®æœ€æ–°ã®å®Ÿè¡Œå±¥æ­´(1ä»¶)ã‚’å–å¾—ã™ã‚‹API
                const apiUrl = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/actions/runs?per_page=1`;
    
                // GitHubå´ã®Actionèµ·å‹•ã«æ•°ç§’ãƒ©ã‚°ãŒã‚ã‚‹ãŸã‚ã€5ç§’å¾…ã£ã¦ã‹ã‚‰ç›£è¦–é–‹å§‹
                await new Promise(resolve => setTimeout(resolve, 5000));
    
                // 10ç§’ã«1å›ã€é€²æ—ã‚’ç¢ºèªã™ã‚‹ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆ
                const checkInterval = setInterval(async () => {
                    try {
                        const res = await fetch(apiUrl, { headers: { Authorization: `token ${token}` } });
                        if (!res.ok) throw new Error("API Limit or Error");
                        const data = await res.json();
                        
                        if (data.workflow_runs && data.workflow_runs.length > 0) {
                            const run = data.workflow_runs[0];
                            
                            // çŠ¶æ…‹ãŒã€Œå®Œäº†(completed)ã€ã«ãªã£ãŸã‚‰
                            if (run.status === 'completed') {
                                clearInterval(checkInterval); // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
                                
                                if (run.conclusion === 'success') {
                                    // æˆåŠŸæ™‚ï¼šãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                                    icon.className = '';
                                    icon.textContent = 'âœ…';
                                    msg.innerHTML = `å…¬é–‹æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸï¼<br><button class="toast-btn" onclick="location.reload()">æœ€æ–°çŠ¶æ…‹ã«ãƒªãƒ­ãƒ¼ãƒ‰</button>`;
                                } else {
                                    // å¤±æ•—æ™‚
                                    icon.className = '';
                                    icon.textContent = 'âŒ';
                                    msg.innerHTML = `å…¬é–‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚<br><a href="https://github.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/actions" target="_blank" style="color:#ffcccc;">Actionsã‚’ç¢ºèª</a>`;
                                }
                            }
                        }
                    } catch (e) {
                        clearInterval(checkInterval);
                        icon.className = '';
                        icon.textContent = 'âš ï¸';
                        msg.textContent = "ç›£è¦–é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€è£ã§å‡¦ç†ã¯é€²ã‚“ã§ã„ã¾ã™ã€‚";
                    }
                }, 10000); // 10,000ãƒŸãƒªç§’ = 10ç§’é–“éš”ã§ãƒã‚§ãƒƒã‚¯
            }
        </script>
    </body>
    </html>
