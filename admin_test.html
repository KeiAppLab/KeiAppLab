<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEI Lab ãƒã‚¹ã‚¿ãƒ¼ãƒ»ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ</title>

    <script src="news_data.js"></script>
    <script src="allowed_users.js"></script>
    <script src="index_phot.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@400;500;900&display=swap');

        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: #1e1e1e; color: #ddd; height: 100vh; overflow: hidden; }
        #mainWrapper { display: none; height: 100%; }

        /* --- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-container-split { display: flex; width: 800px; height: 500px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-left { width: 40%; padding: 40px; display: flex; flex-direction: column; justify-content: center; background: #f9f9f9; border-right: 1px solid #eee; }
        .login-left input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ccc; border-radius: 5px; }
        .login-left button { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login-left button:hover { background: #003d82; }
        .login-right { width: 60%; padding: 40px; overflow-y: auto; color: #333; line-height: 1.6; }

        /* --- ãƒ¡ã‚¤ãƒ³ç”»é¢ --- */
        .dashboard { display: grid; grid-template-columns: 250px 1fr; height: 100%; }
        .sidebar { background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
        .sidebar h1 { font-size: 1.2rem; color: #fff; margin: 20px 10px; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
        .menu-btn { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 5px; color: #aaa; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .menu-btn:hover { background: #3c3c3c; color: #fff; }
        .menu-btn.active { background: #007acc; color: white; }
        .spacer { flex-grow: 1; min-height: 20px; border-bottom: 1px solid #333; margin-bottom: 10px; }

        .main-content { position: relative; overflow: hidden; height: 100%; }
        .panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; padding: 30px; box-sizing: border-box; }
        .panel.active { display: block; }

        /* --- CMSãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (40:60ã«å¤‰æ›´) --- */
        .cms-layout { display: flex; height: 100%; gap: 0; /* éš™é–“ãªã—ã§èƒŒæ™¯åˆ†ã‘ã‚‹ãŸã‚ */ }
        .editor-area { width: 40%; overflow-y: auto; padding-right: 20px; height: 100%; box-sizing: border-box; }
        .preview-area { width: 60%; background: #e0e0e0; color: #333; overflow-y: auto; padding: 20px; height: 100%; box-sizing: border-box; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-top: 5px; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #555; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .input-white { background-color: #ffffff !important; color: #333 !important; border: 1px solid #ccc !important; font-weight: bold; }
        
        /* æ¨ªä¸¦ã³ç”¨ */
        .row-group { display: flex; gap: 10px; }
        .row-group > div { flex: 1; }

        .input-group { display: flex; width: 100%; }
        .input-group input { flex: 1; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; border-right: 0 !important; }
        .input-group select { flex: 1; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; background-color: #e6e6e6 !important; color: #0056b3 !important; cursor: pointer; }

        .editor-lang-tabs { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .edit-tab { padding: 8px 15px; background: #333; color: #aaa; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .edit-tab:hover { background: #444; color: #fff; }
        .edit-tab.active { background: #007acc; color: white; }
        
        .lang-input-group { display: none; animation: fadeIn 0.3s; }
        .lang-input-group.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¹ã‚¤ãƒƒãƒ */
        .status-switch { display: flex; gap: 10px; margin-bottom: 5px; background: #333; padding: 5px; border-radius: 4px; width: fit-content; }
        .status-label { color: #aaa; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .status-label input { width: auto; margin: 0; }

        /* ç”»åƒé¸æŠ */
        .custom-select-wrapper { position: relative; user-select: none; width: 100%; }
        .custom-select { position: relative; display: flex; flex-direction: column; }
        .custom-select__trigger { position: relative; display: flex; align-items: center; justify-content: space-between; padding: 10px; font-size: 1rem; font-weight: bold; color: #333; background: #ffffff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; }
        .custom-options { position: absolute; display: block; top: 100%; left: 0; right: 0; border: 1px solid #ccc; border-top: 0; background: #fff; transition: all 0.3s; opacity: 0; visibility: hidden; pointer-events: none; z-index: 100; max-height: 300px; overflow-y: auto; border-radius: 0 0 4px 4px; }
        .custom-select.open .custom-options { opacity: 1; visibility: visible; pointer-events: all; }
        .custom-option { position: relative; display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; transition: all 0.2s; color: #333; }
        .custom-option:hover { background-color: #f2f9fc; color: #0056b3; }
        .option-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; margin-right: 15px; border: 1px solid #ddd; }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ --- */
        .preview-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 10px; }
        .preview-label { font-size: 0.8rem; color: #666; font-weight: bold; border-bottom: 1px dashed #999; display: block; margin-bottom: 10px; }
        
        .news-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #ccc; }
        .news-date { font-family: 'Roboto', sans-serif; color: #666; width: 100px; font-size: 0.9rem; }
        .news-tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; margin-right: 15px; color: white; width: 110px; text-align: center; }
        .tag-release { background: #0056b3; } .tag-update  { background: #e67e22; } .tag-start   { background: #8e44ad; } .tag-steam   { background: #2c3e50; } .tag-game    { background: #27ae60; }
        .news-link { text-decoration: none; color: #333; font-weight: 500; font-family: 'Noto Serif JP', serif; }

        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼åˆ†å‰²ã‚³ãƒ³ãƒ†ãƒŠ */
        .preview-split-row { display: flex; border: 1px solid #ccc; border-radius: 8px; overflow: hidden; margin-bottom: 30px; }
        .split-col { flex: 1; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .split-col.left { background: #f0f0f0; border-right: 1px solid #ddd; }
        .split-col.right { background: #e8e8e8; }

        /* å…±é€šã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .highlight-card { width: 100%; max-width: 300px; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); }
        .highlight-img-area { width: 100%; height: 160px; overflow: hidden; background: #eee; position: relative; }
        .highlight-img { width: 100%; height: 100%; object-fit: cover; object-position: center; transition: opacity 0.3s; }
        .highlight-category-badge { position: absolute; bottom: 0; left: 0; color: white; font-size: 0.8rem; padding: 4px 12px; border-top-right-radius: 8px; font-weight: bold; z-index: 2; }
        
        /* æœ€æ–°ã®æ´»å‹•ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .highlight-card.dimmed { opacity: 0.4; } /* åŠé€æ˜åŒ– */
        .highlight-content-tight { padding: 5px 0 0 0; text-align: left; } /* ä½™ç™½ãªã— */
        .highlight-title-tight { 
            font-family: 'Noto Serif JP', serif; font-size: 1rem; font-weight: 900; color: #333; line-height: 1.4; margin: 0; 
            width: 18em; /* 18æ–‡å­—åˆ¶é™ */
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
        }
        .highlight-meta { font-size: 0.75rem; color: #666; margin-bottom: 2px; font-family: 'Roboto', sans-serif; }

        /* ã‚¢ãƒ—ãƒªç´¹ä»‹ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .coming-soon-overlay { 
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg); 
            font-size: 1.8rem; font-weight: 900; color: #fff; text-shadow: 2px 2px 0 #000, -1px -1px 0 #000; 
            border: 3px solid #fff; padding: 5px 20px; box-shadow: 3px 3px 0 rgba(0,0,0,0.5); z-index: 10; pointer-events: none;
        }
        .highlight-img.coming-soon-mode { opacity: 0.5; filter: grayscale(50%); }

        .project-name-badge {
            position: absolute; bottom: 5px; left: 5px; z-index: 5;
            background: rgba(255, 255, 255, 0.95); color: #111;
            font-family: 'Roboto', sans-serif; font-weight: 900; font-size: 0.85rem;
            padding: 3px 8px; border: 2px solid #333; border-radius: 4px;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
        }

        .app-desc-content { padding: 15px; text-align: left; }
        .app-desc-text {
            font-family: 'Noto Serif JP', serif; font-size: 0.9rem; color: #444; line-height: 1.6;
            height: 6.4em; /* 4è¡Œåˆ†ç¢ºä¿ (1.6 * 4) */
            overflow: hidden;
        }

        /* è©³ç´°ãƒšãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .page-preview { font-family: 'Noto Serif JP', serif; line-height: 1.8; margin-top: 20px; background: white; padding: 20px; border-radius: 8px; }
        .page-preview h1 { border-bottom: 3px solid #0056b3; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; font-size: 1.5rem; }
        .page-preview img { max-width: 100%; border-radius: 10px; margin: 20px 0; }
        #prevBody, .news-link { white-space: pre-wrap; }

        button { padding: 12px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; width: 100%; }
        .btn-save { background: #27ae60; color: white; }
        .btn-copy { background: #e67e22; color: white; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="loginOverlay">
        <div class="login-container-split">
            <div class="login-left">
                <h2>ğŸš€ KEI Lab Admin</h2>
                <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
                <button onclick="checkIdentity()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div id="authStatus"></div>
            </div>
            <div class="login-right">
                <h3>ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ</h3><ol><li>Generate new token</li><li>Check [repo]</li></ol>
            </div>
        </div>
    </div>

    <div id="mainWrapper">
        <div class="dashboard">
            <div class="sidebar">
                <h1>ğŸš€ KEI Lab Admin</h1>
                <div class="menu-btn active" onclick="switchPanel('calc')">ğŸ’° åç›Šãƒ»ç§’æ•°è¨ˆç®—</div>
                <div class="menu-btn" onclick="switchPanel('cms')">ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†</div>
                <div class="menu-btn" onclick="switchPanel('projects')">ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</div>
                <div class="spacer"></div>
                <div class="menu-btn" onclick="switchPanel('users')">ğŸ‘¥ æ¨©é™ç®¡ç†</div>
                <div class="menu-btn" onclick="logout()" style="margin-top:auto; background:#c0392b; color:white;">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
            </div>

            <div class="main-content">
                <!-- è¨ˆç®—ãƒ‘ãƒãƒ« -->
                <div id="panel-calc" class="panel active">
                    <div class="calc-container">
                        <h2>ğŸ’° ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                        <!-- è¨ˆç®—æ©Ÿã®ä¸­èº«ã¯çœç•¥ã›ãšç¶­æŒ -->
                        <div class="calc-grid">
                            <div><label>å‹•ç”»åºƒå‘Šå˜ä¾¡</label><input type="number" id="adPrice" value="1.5" step="0.1"></div>
                            <div><label>é€šè©±åŸä¾¡ (1åˆ†)</label><input type="number" id="callCost" value="3.0" step="0.1"></div>
                        </div>
                        <label>åˆ©ç›Šç‡ <span id="marginDisplay">20%</span></label>
                        <input type="range" id="margin" min="0" max="50" value="20" oninput="document.getElementById('marginDisplay').innerText = this.value + '%'">
                        <button class="btn-calc" onclick="calcSeconds()">è¨ˆç®—ã™ã‚‹</button>
                        <div class="calc-result-box"><div id="calcOutput" class="calc-number">--- ç§’</div></div>
                    </div>
                </div>

                <!-- CMSãƒ‘ãƒãƒ« -->
                <div id="panel-cms" class="panel">
                    <div class="cms-layout">
                        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ (40%) -->
                        <div class="editor-area">
                            <h2>ğŸ“ è¨˜äº‹ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h2>
                            
                            <!-- æ—¥ä»˜ã¨ã‚«ãƒ†ã‚´ãƒªã‚’åŒã˜åˆ—ã« -->
                            <div class="row-group">
                                <div class="form-group"><label>æ—¥ä»˜</label><input type="text" id="inDate" class="input-white"></div>
                                <div class="form-group">
                                    <label>ã‚«ãƒ†ã‚´ãƒª</label>
                                    <select id="inCategory" class="input-white" onchange="updatePreview()">
                                        <option value="update">æ›´æ–°æƒ…å ±</option>
                                        <option value="release">ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="start">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹</option>
                                        <option value="steam">Steamãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="game">ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (index_photãƒ•ã‚©ãƒ«ãƒ€)</label>
                                <input type="hidden" id="inImage" onchange="updatePreview()">
                                <div class="custom-select-wrapper">
                                    <div class="custom-select">
                                        <div class="custom-select__trigger" onclick="toggleImageSelect()"><span id="selectedImageText">ç”»åƒã‚’é¸æŠ...</span><span>â–¼</span></div>
                                        <div class="custom-options" id="imageOptions"></div>
                                    </div>
                                </div>
                            </div>

                            <hr style="border:0; border-top:1px dashed #555; margin: 20px 0;">

                            <div class="editor-lang-tabs">
                                <button class="edit-tab active" onclick="switchEditorLang('ja')">ğŸ‡¯ğŸ‡µ JP</button>
                                <button class="edit-tab" onclick="switchEditorLang('en')">ğŸ‡ºğŸ‡¸ EN</button>
                                <button class="edit-tab" onclick="switchEditorLang('de')">ğŸ‡©ğŸ‡ª DE</button>
                                <button class="edit-tab" onclick="switchEditorLang('fr')">ğŸ‡«ğŸ‡· FR</button>
                                <button class="edit-tab" onclick="switchEditorLang('es')">ğŸ‡ªğŸ‡¸ ES</button>
                            </div>

                            <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆï¼ˆå…¨è¨€èªå…±é€šã®è¨­å®šã¨ã—ã¦é…ç½®ã€ã¾ãŸã¯å„è¨€èªé€£å‹•ï¼‰ -->
                            <div class="form-group" sty<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEI Lab ãƒã‚¹ã‚¿ãƒ¼ãƒ»ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ</title>

    <script src="news_data.js"></script>
    <script src="allowed_users.js"></script>
    <script src="index_phot.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@400;500;700;900&display=swap');

        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: #1e1e1e; color: #ddd; height: 100vh; overflow: hidden; }
        #mainWrapper { display: none; height: 100%; }

        /* --- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-container-split { display: flex; width: 800px; height: 500px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-left { width: 40%; padding: 40px; display: flex; flex-direction: column; justify-content: center; background: #f9f9f9; border-right: 1px solid #eee; }
        .login-left input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ccc; border-radius: 5px; }
        .login-left button { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login-right { width: 60%; padding: 40px; overflow-y: auto; color: #333; line-height: 1.6; }

        /* --- ãƒ¡ã‚¤ãƒ³ç”»é¢ --- */
        .dashboard { display: grid; grid-template-columns: 250px 1fr; height: 100%; }
        .sidebar { background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
        .sidebar h1 { font-size: 1.2rem; color: #fff; margin: 20px 10px; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
        .menu-btn { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 5px; color: #aaa; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .menu-btn:hover { background: #3c3c3c; color: #fff; }
        .menu-btn.active { background: #007acc; color: white; }
        .spacer { flex-grow: 1; min-height: 20px; border-bottom: 1px solid #333; margin-bottom: 10px; }

        .main-content { position: relative; overflow: hidden; height: 100%; }
        .panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; padding: 30px; box-sizing: border-box; }
        .panel.active { display: block; }

        /* --- CMSãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (æ¯”ç‡å¤‰æ›´) --- */
        .cms-layout { display: flex; height: 100%; gap: 20px; }
        /* ç·¨é›†ã‚¨ãƒªã‚¢ã‚’å°ã•ã(35%)ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å¤§ãã(65%) */
        .editor-area { width: 35%; overflow-y: auto; padding-right: 10px; height: 100%; }
        .preview-area { width: 65%; background: #e0e0e0; color: #333; border-radius: 8px; overflow-y: auto; padding: 0; height: 100%; display: flex; flex-direction: column; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-top: 5px; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; box-sizing: border-box; font-size: 0.95rem; }
        .input-white { background-color: #ffffff !important; color: #333 !important; border: 1px solid #ccc !important; font-weight: bold; }

        /* æ—¥ä»˜ã¨ã‚«ãƒ†ã‚´ãƒªã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ã‚¯ãƒ©ã‚¹ */
        .form-row { display: flex; gap: 10px; }
        .form-row .form-group { flex: 1; }

        /* å…¥åŠ›é€£çµ */
        .input-group { display: flex; width: 100%; }
        .input-group input { flex: 1; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; border-right: 0 !important; }
        .input-group select { flex: 1; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; background-color: #e6e6e6 !important; color: #0056b3 !important; cursor: pointer; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */
        .status-toggle { display: flex; gap: 15px; margin-bottom: 5px; align-items: center; }
        .status-toggle label { margin: 0; color: #fff; cursor: pointer; display: flex; align-items: center; gap: 5px; }

        /* è¨€èªã‚¿ãƒ– */
        .editor-lang-tabs { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid #555; padding-bottom: 10px; flex-wrap: wrap; }
        .edit-tab { padding: 5px 10px; background: #333; color: #aaa; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.8rem; }
        .edit-tab.active { background: #007acc; color: white; }
        
        .lang-input-group { display: none; }
        .lang-input-group.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ç”»åƒé¸æŠ */
        .custom-select-wrapper { position: relative; user-select: none; width: 100%; }
        .custom-select__trigger { display: flex; align-items: center; justify-content: space-between; padding: 8px; background: #fff; color: #333; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .custom-options { position: absolute; display: block; top: 100%; left: 0; right: 0; background: #fff; z-index: 100; max-height: 200px; overflow-y: auto; display: none; border: 1px solid #ccc; }
        .custom-select.open .custom-options { display: block; }
        .custom-option { display: flex; align-items: center; padding: 5px; border-bottom: 1px solid #eee; cursor: pointer; color: #333; }
        .custom-option:hover { background-color: #f2f9fc; }
        .option-img { width: 40px; height: 40px; object-fit: cover; margin-right: 10px; }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ --- */
        .preview-content-wrapper { padding: 20px; }
        .preview-header { border-bottom: 1px solid #ccc; padding: 10px 20px; margin-bottom: 0; background: #dcdcdc; }
        .preview-label { font-size: 0.8rem; color: #555; font-weight: bold; border-bottom: 1px dashed #999; display: block; margin-bottom: 10px; }

        /* èƒŒæ™¯åˆ†å‰²ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        .split-background {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            border: 1px solid #ccc;
            margin-bottom: 30px;
        }
        .split-left { background-color: #f0f0f0; padding: 20px; border-right: 1px solid #ddd; } /* Highlightsç”¨ */
        .split-right { background-color: #e8e8e8; padding: 20px; } /* App Listç”¨ */

        /* å…±é€šã‚«ãƒ¼ãƒ‰åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .card-base {
            width: 100%; 
            background: #fff; 
            border-radius: 10px; 
            overflow: hidden; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            transition: transform 0.2s;
            max-width: 320px;
            margin: 0 auto;
        }

        /* --- æœ€æ–°ã®æ´»å‹• (Highlights) --- */
        .highlight-img-area { width: 100%; height: 180px; overflow: hidden; background: #333; position: relative; }
        .highlight-img { width: 100%; height: 100%; object-fit: cover; }
        .highlight-category-badge { position: absolute; bottom: 0; left: 0; color: white; font-size: 0.8rem; padding: 4px 12px; border-top-right-radius: 8px; font-weight: bold; z-index: 2; }
        .highlight-content { padding: 0; text-align: left; } /* ä½™ç™½ãªã— */
        
        .highlight-meta { 
            font-size: 0.75rem; color: #666; font-family: 'Roboto', sans-serif; 
            padding: 5px 10px 0 10px; /* ãƒ¡ã‚¿æƒ…å ±ã®ä½™ç™½ */
        }

        /* æ–‡å­—éƒ¨åˆ†ï¼šä½™ç™½ãªã—ã€æ¨ª18æ–‡å­—åŸºæº– */
        .highlight-title { 
            font-family: 'Noto Serif JP', serif; 
            font-size: 1rem; /* 16px */
            font-weight: 900; 
            color: #333; 
            line-height: 1.4; 
            margin: 0; 
            padding: 5px 10px 10px 10px; /* å¿…è¦æœ€ä½é™ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
            width: 100%;
            box-sizing: border-box;
            /* 18æ–‡å­—ç¨‹åº¦ã§æ”¹è¡Œã•ã‚Œã‚‹ã‚ˆã†ã«èª¿æ•´ï¼ˆã‚«ãƒ¼ãƒ‰å¹…300-320pxæƒ³å®šï¼‰ */
            letter-spacing: 0.05em; 
        }

        /* åŠé€æ˜åŒ–ã‚¯ãƒ©ã‚¹ */
        .opacity-half { opacity: 0.5; }

        /* --- ã‚¢ãƒ—ãƒªç´¹ä»‹ (App List) --- */
        .app-img-area { width: 100%; height: 180px; overflow: hidden; background: #333; position: relative; }
        .app-img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        
        /* Coming Soon æ–œã‚æ–‡å­— */
        .coming-soon-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            color: white;
            font-weight: 900;
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            white-space: nowrap;
            display: none;
            z-index: 10;
        }
        /* Coming Soonæ™‚ã®ç”»åƒåŠé€æ˜ */
        .is-coming .app-img { opacity: 0.4; }
        .is-coming .coming-soon-text { display: block; }

        .app-content { padding: 10px; text-align: left; height: 140px; /* é«˜ã•å›ºå®š */ display: flex; flex-direction: column; }
        
        /* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆå·¦ä¸‹ã€æ ä»˜ãï¼‰ */
        .app-proj-name {
            display: inline-block;
            border: 2px solid #333;
            padding: 2px 8px;
            font-size: 0.8rem;
            font-weight: 900;
            color: #333;
            margin-bottom: 8px;
            align-self: flex-start;
            background: #fff;
        }

        /* ç´¹ä»‹æ–‡ï¼ˆ4è¡Œç¢ºä¿ï¼‰ */
        .app-desc-text {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #444;
            font-weight: 500;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            height: 6em; /* 1.5em * 4è¡Œ */
        }

        /* --- ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ --- */
        .news-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #ccc; }
        .news-date { font-family: 'Roboto', sans-serif; color: #666; width: 100px; font-size: 0.9rem; }
        .news-tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; margin-right: 15px; color: white; width: 110px; text-align: center; }
        .tag-release { background: #0056b3; } .tag-update  { background: #e67e22; } .tag-start   { background: #8e44ad; } .tag-steam   { background: #2c3e50; } .tag-game    { background: #27ae60; }

        /* è©³ç´°ãƒšãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .page-preview { font-family: 'Noto Serif JP', serif; line-height: 1.8; background: white; padding: 20px; border-radius: 8px; }
        .page-preview h1 { border-bottom: 3px solid #0056b3; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; font-size: 1.5rem; }
        .page-preview img { max-width: 100%; border-radius: 10px; margin: 20px 0; }

        button { padding: 12px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; width: 100%; }
        .btn-save { background: #27ae60; color: white; }
        .btn-copy { background: #e67e22; color: white; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-container-split">
            <div class="login-left">
                <h2>ğŸš€ KEI Lab Admin</h2>
                <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
                <button onclick="checkIdentity()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div id="authStatus"></div>
            </div>
            <div class="login-right">
                <h3>ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œæ‰‹é †</h3>
                <ol><li>Generate new token (classic)</li><li>Check [repo]</li></ol>
            </div>
        </div>
    </div>

    <div id="mainWrapper">
        <div class="dashboard">
            <div class="sidebar">
                <h1>ğŸš€ KEI Lab Admin</h1>
                <div class="menu-btn active" onclick="switchPanel('calc')">ğŸ’° åç›Šãƒ»ç§’æ•°è¨ˆç®—</div>
                <div class="menu-btn" onclick="switchPanel('cms')">ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†</div>
                <div class="menu-btn" onclick="switchPanel('projects')">ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</div>
                <div class="spacer"></div>
                <div class="menu-btn" onclick="switchPanel('users')">ğŸ‘¥ æ¨©é™ç®¡ç†</div>
                <div class="menu-btn" onclick="logout()" style="margin-top:auto; background:#c0392b; color:white;">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
            </div>

            <div class="main-content">
                <!-- è¨ˆç®—ãƒ‘ãƒãƒ« -->
                <div id="panel-calc" class="panel active">
                    <div class="calc-container">
                        <h2>ğŸ’° ç„¡æ–™é€šè©±ç§’æ•° ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                        <div class="calc-grid">
                            <div><label>å‹•ç”»åºƒå‘Šå˜ä¾¡</label><input type="number" id="adPrice" value="1.5" step="0.1"></div>
                            <div><label>é€šè©±åŸä¾¡ (1åˆ†)</label><input type="number" id="callCost" value="3.0" step="0.1"></div>
                        </div>
                        <label>åˆ©ç›Šç‡ <span id="marginDisplay">20%</span></label>
                        <input type="range" id="margin" min="0" max="50" value="20" oninput="document.getElementById('marginDisplay').innerText = this.value + '%'">
                        <button class="btn-calc" onclick="calcSeconds()">è¨ˆç®—ã™ã‚‹</button>
                        <div class="calc-result-box"><div id="calcOutput" class="calc-number">--- ç§’</div></div>
                    </div>
                </div>

                <!-- CMSãƒ‘ãƒãƒ« -->
                <div id="panel-cms" class="panel">
                    <div class="cms-layout">
                        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ (35%) -->
                        <div class="editor-area">
                            <h2>ğŸ“ è¨˜äº‹ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h2>
                            
                            <!-- æ—¥ä»˜ã¨ã‚«ãƒ†ã‚´ãƒªã‚’åŒã˜åˆ—ã« -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label>æ—¥ä»˜</label>
                                    <input type="text" id="inDate" class="input-white">
                                </div>
                                <div class="form-group">
                                    <label>ã‚«ãƒ†ã‚´ãƒª</label>
                                    <select id="inCategory" class="input-white" onchange="updatePreview()">
                                        <option value="update">æ›´æ–°æƒ…å ±</option>
                                        <option value="release">ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="start">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹</option>
                                        <option value="steam">Steamãƒªãƒªãƒ¼ã‚¹</option>
                                        <option value="game">ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (index_photãƒ•ã‚©ãƒ«ãƒ€)</label>
                                <input type="hidden" id="inImage" onchange="updatePreview()">
                                <div class="custom-select-wrapper">
                                    <div class="custom-select">
                                        <div class="custom-select__trigger" onclick="toggleImageSelect()"><span id="selectedImageText">ç”»åƒã‚’é¸æŠ...</span><span>â–¼</span></div>
                                        <div class="custom-options" id="imageOptions"></div>
                                    </div>
                                </div>
                            </div>

                            <hr style="border:0; border-top:1px dashed #555; margin: 20px 0;">

                            <div class="editor-lang-tabs">
                                <button class="edit-tab active" onclick="switchEditorLang('ja')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                                <button class="edit-tab" onclick="switchEditorLang('en')">ğŸ‡ºğŸ‡¸ English</button>
                                <button class="edit-tab" onclick="switchEditorLang('de')">ğŸ‡©ğŸ‡ª Deutsch</button>
                                <button class="edit-tab" onclick="switchEditorLang('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
                                <button class="edit-tab" onclick="switchEditorLang('es')">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
                            </div>

                            <!-- æ—¥æœ¬èª -->
                            <div id="group-ja" class="lang-input-group active">
                                <div class="form-group">
                                    <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå (JP)ã€€news_data.js</label>
                                    <div class="input-group">
                                        <input type="text" id="inProject" class="input-white" oninput="autoFillProject()">
                                        <select id="projectSelectHelper" class="input-white" onchange="syncProjectSelect()"><option value="">â–¼ å±¥æ­´...</option></select>
                                    </div>
                                </div>
                                <!-- 2è¡Œã«å¤‰æ›´ -->
                                <div class="form-group"><label>ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ (JP)</label><textarea id="inTitle" class="input-white" rows="2" oninput="updatePreview()"></textarea></div>
                                
                                <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆã¨3è¡Œå…¥åŠ› -->
                                <div class="form-group">
                                    <div style="display:flex; justify-content:space-between; align-items:end;">
                                        <label>ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ (JP)</label>
                                        <div class="status-toggle">
                                            <label style="font-size:0.8rem;"><input type="radio" name="appStatus" value="released" checked onchange="updatePreview()"> ãƒªãƒªãƒ¼ã‚¹æ¸ˆ</label>
                                            <label style="font-size:0.8rem;"><input type="radio" name="appStatus" value="coming" onchange="updatePreview()"> Coming Soon</label>
                                        </div>
                                    </div>
                                    <textarea id="inBody" class="input-white" rows="3" oninput="updatePreview()"></textarea>
                                </div>
                            </div>

                            <!-- å¤šè¨€èª (å¾©æ´») -->
                            <div id="group-en" class="lang-input-group"><div class="form-group"><label>Project (EN)</label><input type="text" id="inProjectEn" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (EN)</label><textarea id="inTitleEn" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (EN)</label><textarea id="inBodyEn" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>
                            <div id="group-de" class="lang-input-group"><div class="form-group"><label>Project (DE)</label><input type="text" id="inProjectDe" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (DE)</label><textarea id="inTitleDe" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (DE)</label><textarea id="inBodyDe" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>
                            <div id="group-fr" class="lang-input-group"><div class="form-group"><label>Project (FR)</label><input type="text" id="inProjectFr" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (FR)</label><textarea id="inTitleFr" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (FR)</label><textarea id="inBodyFr" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>
                            <div id="group-es" class="lang-input-group"><div class="form-group"><label>Project (ES)</label><input type="text" id="inProjectEs" class="input-white" oninput="updatePreview()"></div><div class="form-group"><label>Title (ES)</label><textarea id="inTitleEs" class="input-white" rows="2" oninput="updatePreview()"></textarea></div><div class="form-group"><label>App Intro (ES)</label><textarea id="inBodyEs" class="input-white" rows="3" oninput="updatePreview()"></textarea></div></div>

                            <button class="btn-save" onclick="addPost()">ãƒªã‚¹ãƒˆã«è¿½åŠ  (ä¸€æ™‚ä¿å­˜)</button>
                            <button class="btn-copy" onclick="saveToGitHub()">ğŸš€ GitHubã¸ç›´æ¥ä¿å­˜</button>
                        </div>

                        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (65%) -->
                        <div class="preview-area">
                            <div class="preview-header">
                                <h2 style="border:none; margin:0; font-size:1.1rem; color:#333;">ğŸ‘ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                            </div>
                            
                            <div class="preview-content-wrapper">
                                <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ -->
                                <span class="preview-label">â–¼ ãŠçŸ¥ã‚‰ã› (News List)</span>
                                <div class="news-item" style="margin-bottom:30px;">
                                    <span class="news-date" id="prevDate">2026.03.15</span>
                                    <span class="news-tag tag-update" id="prevTag">æ›´æ–°æƒ…å ±</span>
                                    <div style="flex:1;">
                                        <span style="font-weight:bold; margin-right:10px; color:#333;" id="prevProjectName">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                        <span class="news-link" id="prevTitle">ã‚¿ã‚¤ãƒˆãƒ«</span>
                                    </div>
                                </div>

                                <!-- èƒŒæ™¯ã‚’åŠåˆ†ã«åˆ†å‰²ã—ãŸã‚³ãƒ³ãƒ†ãƒŠ -->
                                <div class="split-background">
                                    <!-- å·¦ï¼šæœ€æ–°ã®æ´»å‹• -->
                                    <div class="split-left">
                                        <span class="preview-label">â–¼ æœ€æ–°ã®æ´»å‹• (Highlights)</span>
                                        <div class="card-base" id="highlightCardBase">
                                            <div class="highlight-img-area">
                                                <img src="" alt="No Image" id="prevImg" class="highlight-img">
                                                <span class="highlight-category-badge tag-update" id="prevCardCatBadge">æ›´æ–°æƒ…å ±</span>
                                            </div>
                                            <div class="highlight-content">
                                                <div class="highlight-meta">
                                                    <span class="meta-date" id="prevCardDate">2026.03.15</span> | 
                                                    <span class="meta-proj" id="prevCardProj">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                                </div>
                                                <!-- ä½™ç™½ãªã—ãƒ»18æ–‡å­—åŸºæº– -->
                                                <div class="highlight-title" id="prevCardTitle">ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- å³ï¼šã‚¢ãƒ—ãƒªç´¹ä»‹ -->
                                    <div class="split-right">
                                        <span class="preview-label">â–¼ ã‚¢ãƒ—ãƒªç´¹ä»‹ (App List)</span>
                                        <div class="card-base" id="appCardBase">
                                            <div class="app-img-area" id="appImgArea">
                                                <img src="" alt="No Image" id="prevAppImg" class="app-img">
                                                <!-- Coming Soonæ–œã‚æ–‡å­— -->
                                                <div class="coming-soon-text">Coming Soon</div>
                                            </div>
                                            <div class="app-content">
                                                <!-- å·¦ä¸‹ã«æ ä»˜ããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå -->
                                                <div class="app-proj-name" id="prevAppProj">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</div>
                                                <!-- ä¸‹ã«ç´¹ä»‹æ–‡ï¼ˆ4è¡Œï¼‰ -->
                                                <div class="app-desc-text" id="prevAppDesc">
                                                    ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™...
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p style="font-size:0.8rem; color:red; text-align:center;" id="highlightMsg"></p>

                                <!-- è©³ç´°ãƒšãƒ¼ã‚¸ -->
                                <span class="preview-label">â–¼ è©³ç´°ãƒšãƒ¼ã‚¸ (Project Page)</span>
                                <div class="page-preview">
                                    <h1 id="prevPageTitle">ã‚¿ã‚¤ãƒˆãƒ«</h1>
                                    <div style="color:#666; font-size:0.9rem; margin-bottom:20px;">
                                        <span id="prevPageDate">2026.03.15</span> | <span id="prevPageProject">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                    </div>
                                    <img src="" id="prevPageImg" style="display:none;">
                                    <div id="prevBody">æœ¬æ–‡...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="panel-projects" class="panel">
                    <div class="calc-container"><h2>ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</h2><p>å®Ÿè£…æº–å‚™ä¸­...</p></div>
                </div>
                <div id="panel-users" class="panel">
                    <div class="calc-container"><h2>ğŸ‘¥ ç·¨é›†æ¨©é™è€…ã®ç®¡ç†</h2><!-- æ—¢å­˜ã‚³ãƒ¼ãƒ‰çœç•¥ --></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®š
        const GITHUB_CONFIG = { owner: "KeiAppLab", repo: "KeiAppLab", path: "news_data.js" };
        let previewLang = 'ja';

        async function checkIdentity() {
            const token = document.getElementById('tokenInput').value.trim() || arguments[0];
            if (!token) return;
            try {
                const res = await fetch("https://api.github.com/user", { headers: { Authorization: `token ${token}` } });
                const user = await res.json();
                if (typeof allowedUsersData !== 'undefined' && allowedUsersData.includes(user.login)) {
                    localStorage.setItem('gh_token', token);
                    showDashboard();
                }
            } catch (e) {}
        }
        function showDashboard() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainWrapper').style.display = 'block';
            updatePreview(); initProjectList(); initImageSelector();
        }
        function logout() { localStorage.removeItem('gh_token'); location.reload(); }
        window.onload = () => { const t = localStorage.getItem('gh_token'); if(t) checkIdentity(t); };
        function switchPanel(id) {
            document.querySelectorAll('.panel').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(e => e.classList.remove('active'));
            document.getElementById('panel-' + id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        let allPosts = [];
        const today = new Date();
        document.getElementById('inDate').value = today.getFullYear() + '.' + (today.getMonth()+1).toString().padStart(2,'0') + '.' + today.getDate().toString().padStart(2,'0');

        function switchEditorLang(lang) {
            document.querySelectorAll('.lang-input-group').forEach(e => e.classList.remove('active'));
            document.getElementById('group-' + lang).classList.add('active');
            document.querySelectorAll('.edit-tab').forEach(e => e.classList.remove('active'));
            event.currentTarget.classList.add('active');
            previewLang = lang; updatePreview();
        }

        function initProjectList() {
            if (typeof newsData === 'undefined') return;
            const pSet = new Set(newsData.map(i => i.project).filter(p => p));
            const sel = document.getElementById('projectSelectHelper');
            sel.innerHTML = '<option value="">â–¼ å±¥æ­´...</option>';
            pSet.forEach(p => { const o = document.createElement('option'); o.value = p; o.textContent = p; sel.appendChild(o); });
        }
        function syncProjectSelect() {
            const sel = document.getElementById('projectSelectHelper');
            const inp = document.getElementById('inProject');
            if(sel.value){ inp.value = sel.value; autoFillProject(); sel.selectedIndex=0; }
        }
        function autoFillProject() {
            const val = document.getElementById('inProject').value.trim();
            const keys = {
                ja:['inProject','inTitle','inBody'], 
                en:['inProjectEn','inTitleEn','inBodyEn'], 
                de:['inProjectDe','inTitleDe','inBodyDe'], 
                fr:['inProjectFr','inTitleFr','inBodyFr'], 
                es:['inProjectEs','inTitleEs','inBodyEs']
            };
            if(!val) { 
                Object.values(keys).flat().forEach(id => document.getElementById(id).value = ""); 
                setImageValue(""); updatePreview(); return; 
            }
            if (typeof newsData !== 'undefined') {
                const post = newsData.slice().reverse().find(p => p.project === val);
