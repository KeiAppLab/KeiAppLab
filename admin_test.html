<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEI Lab ãƒã‚¹ã‚¿ãƒ¼ãƒ»ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ</title>

    <!-- å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->
    <!-- ã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ã€å­˜åœ¨ã—ãªã„å ´åˆã§ã‚‚ç©ºé…åˆ—ã§åˆæœŸåŒ–ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æŒŸã‚€ -->
    <script>
        var newsData = newsData || [];
        var allowedUsersData = allowedUsersData || [];
        var photoList = photoList || [];
        var appsListData = appsListData || []; 
    </script>
    <script src="news_data.js"></script>
    <script src="allowed_users.js"></script>
    <script src="index_phot.js"></script>
    <script src="apps_list.js"></script> <!-- ã‚¢ãƒ—ãƒªä¸€è¦§ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&family=Roboto:wght@400;500;900&display=swap');

        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: #1e1e1e; color: #ddd; height: 100vh; overflow: hidden; }
        #mainWrapper { display: none; height: 100%; }

        /* --- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ --- */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-container-split { display: flex; width: 800px; height: 500px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-left { width: 40%; padding: 40px; display: flex; flex-direction: column; justify-content: center; background: #f9f9f9; border-right: 1px solid #eee; }
        .login-left input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ccc; border-radius: 5px; }
        .login-left button { width: 100%; padding: 12px; background: #0056b3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login-left button:hover { background: #003d82; }
        .login-right { width: 60%; padding: 40px; overflow-y: auto; color: #333; line-height: 1.6; }

        /* --- ãƒ¡ã‚¤ãƒ³ç”»é¢ --- */
        .dashboard { display: grid; grid-template-columns: 250px 1fr; height: 100%; }
        .sidebar { background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
        .sidebar h1 { font-size: 1.2rem; color: #fff; margin: 20px 10px; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
        .menu-btn { padding: 15px; margin-bottom: 5px; cursor: pointer; border-radius: 5px; color: #aaa; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .menu-btn:hover { background: #3c3c3c; color: #fff; }
        .menu-btn.active { background: #007acc; color: white; }
        .spacer { height: 30px; border-bottom: 1px solid #444; margin-bottom: 15px; } /* ç©ºæ¬„ã¨åŒºåˆ‡ã‚Š */

        .main-content { position: relative; overflow: hidden; height: 100%; }
        .panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; padding: 30px; box-sizing: border-box; }
        .panel.active { display: block; }

        /* --- CMSãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        .cms-layout { display: flex; height: 100%; gap: 20px; }
        .editor-area { width: 45%; overflow-y: auto; padding-right: 10px; height: 100%; }
        .preview-area { width: 55%; background: #e0e0e0; color: #333; border-radius: 8px; overflow-y: auto; padding: 20px; height: 100%; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-top: 5px; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #555; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .input-white { background-color: #ffffff !important; color: #333 !important; border: 1px solid #ccc !important; font-weight: bold; }
        
        /* é€£çµå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        .input-group { display: flex; width: 100%; }
        .input-group input { flex: 1; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; border-right: 0 !important; }
        .input-group select { flex: 1; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; background-color: #e6e6e6 !important; color: #0056b3 !important; cursor: pointer; }

        /* --- è¨€èªã‚¿ãƒ– (ã‚¨ãƒ‡ã‚£ã‚¿ç”¨) --- */
        .editor-lang-tabs { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .edit-tab { padding: 8px 15px; background: #333; color: #aaa; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .edit-tab:hover { background: #444; color: #fff; }
        .edit-tab.active { background: #007acc; color: white; }
        
        .lang-input-group { display: none; animation: fadeIn 0.3s; }
        .lang-input-group.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ç”»åƒé¸æŠãƒœãƒƒã‚¯ã‚¹ */
        .custom-select-wrapper { position: relative; user-select: none; width: 450px; max-width: 100%; }
        .custom-select { position: relative; display: flex; flex-direction: column; }
        .custom-select__trigger { position: relative; display: flex; align-items: center; justify-content: space-between; padding: 10px; font-size: 1rem; font-weight: bold; color: #333; background: #ffffff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; }
        .custom-options { position: absolute; display: block; top: 100%; left: 0; right: 0; border: 1px solid #ccc; border-top: 0; background: #fff; transition: all 0.3s; opacity: 0; visibility: hidden; pointer-events: none; z-index: 100; max-height: 300px; overflow-y: auto; border-radius: 0 0 4px 4px; }
        .custom-select.open .custom-options { opacity: 1; visibility: visible; pointer-events: all; }
        .custom-option { position: relative; display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; transition: all 0.2s; color: #333; }
        .custom-option:hover { background-color: #f2f9fc; color: #0056b3; }
        .option-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; margin-right: 15px; border: 1px solid #ddd; }
        .option-text { font-size: 0.9rem; font-weight: bold; }

        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ */
        .preview-header { border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 10px; }
        .preview-label { font-size: 0.8rem; color: #666; font-weight: bold; border-bottom: 1px dashed #999; display: block; margin-bottom: 10px; margin-top: 30px; }
        
        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒªã‚¹ãƒˆ */
        .news-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #ccc; }
        .news-date { font-family: 'Roboto', sans-serif; color: #666; width: 100px; font-size: 0.9rem; }
        .news-tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; margin-right: 15px; color: white; width: 110px; text-align: center; }
        .tag-release { background: #0056b3; }
        .tag-update { background: #e67e22; }
        .tag-start   { background: #8e44ad; }
        .tag-steam   { background: #2c3e50; }
        .tag-game    { background: #27ae60; }
        .news-link { text-decoration: none; color: #333; font-weight: 500; font-family: 'Noto Serif JP', serif; }

        /* ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆ2åˆ—è¡¨ç¤ºç”¨ã‚³ãƒ³ãƒ†ãƒŠï¼‰ */
        .cards-container { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }

        /* ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚«ãƒ¼ãƒ‰ & ã‚¢ãƒ—ãƒªç´¹ä»‹ã‚«ãƒ¼ãƒ‰ */
        .highlight-card { width: 280px; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 6px 6px 15px rgba(0,0,0,0.15); border: 1px solid rgba(0,0,0,0.05); }
        .highlight-img-area { width: 100%; height: 180px; overflow: hidden; background: #eee; position: relative; }
        .highlight-img { width: 100%; height: 100%; object-fit: cover; object-position: center; }
        .highlight-category-badge { position: absolute; bottom: 0; left: 0; color: white; font-size: 0.8rem; padding: 4px 12px; border-top-right-radius: 8px; font-weight: bold; z-index: 2; }
        .highlight-content { padding: 10px 10px 15px 10px; text-align: left; }
        .highlight-meta { font-size: 0.75rem; color: #666; margin-bottom: 5px; font-family: 'Roboto', sans-serif; }
        .meta-proj { font-weight: bold; color: #333; }
        .highlight-title { font-family: 'Noto Serif JP', serif; font-size: 1rem; font-weight: 900; color: #333; line-height: 1.4; margin: 0; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        
        /* HPãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .hp-preview-box { margin-top: 20px; border: 1px solid #ccc; background: white; padding: 10px; border-radius: 8px; }
        .hp-url { color: #0056b3; font-size: 0.9rem; margin-bottom: 5px; display: block; text-decoration: underline; }
        .hp-frame { width: 100%; height: 300px; border: 1px solid #eee; background: #fafafa; }

        /* è©³ç´°ãƒšãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .page-preview { font-family: 'Noto Serif JP', serif; line-height: 1.8; margin-top: 20px; background: white; padding: 20px; border-radius: 8px; }
        .page-preview h1 { border-bottom: 3px solid #0056b3; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; font-size: 1.5rem; }
        .page-preview img { max-width: 100%; border-radius: 10px; margin: 20px 0; }
        #prevBody { white-space: pre-wrap; }

        button { padding: 12px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; width: 100%; }
        .btn-calc { background: #007acc; color: white; }
        .btn-save { background: #27ae60; color: white; }
        .btn-copy { background: #e67e22; color: white; margin-top: 20px; }
        
        #outputArea { width: 100%; height: 100px; background: #111; color: #0f0; font-family: monospace; font-size: 0.8rem; margin-top: 10px; }
    </style>
</head>
<body>

    <!-- 1. ãƒ­ã‚°ã‚¤ãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="loginOverlay">
        <div class="login-container-split">
            <div class="login-left">
                <h2>ğŸš€ KEI Lab Admin</h2>
                <p>ç®¡ç†è€…ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
                <button onclick="checkIdentity()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <div id="authStatus"></div>
            </div>
            <div class="login-right">
                <h3>ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œæ‰‹é †</h3>
                <ol>
                    <li><a href="https://github.com/settings/tokens" target="_blank" style="color:#007acc; font-weight:bold;">GitHub Tokenè¨­å®šãƒšãƒ¼ã‚¸ã¸ç§»å‹• â†—</a></li>
                    <li>[Generate new token (classic)] ã‚’é¸æŠ</li>
                    <li>Expirationï¼ˆæœŸé™ï¼‰ã‚’è¨­å®šï¼ˆ90 daysæ¨å¥¨ï¼‰</li>
                    <li><strong>[repo]</strong> ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ï¼ˆå¿…é ˆï¼‰</li>
                    <li>ä¸€ç•ªä¸‹ã® [Generate token] ã‚’æŠ¼ã—ã¦ã‚³ãƒ”ãƒ¼</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- 2. ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="mainWrapper">
        <div class="dashboard">
            <div class="sidebar">
                <h1>ğŸš€ KEI Lab Admin</h1>
                <div class="menu-btn active" onclick="switchPanel('calc')">ğŸ’° åç›Šãƒ»ç§’æ•°è¨ˆç®—</div>
                <div class="menu-btn" onclick="switchPanel('cms')">ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç·¨é›†</div>
                <div class="menu-btn" onclick="switchPanel('projects')">ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</div>
                
                <!-- ç©ºæ¬„ -->
                <div class="spacer"></div>
                
                <div class="menu-btn" onclick="switchPanel('users')">ğŸ‘¥ æ¨©é™ç®¡ç†</div>
                <div class="menu-btn" onclick="logout()" style="margin-top:auto; background:#c0392b; color:white;">ğŸ”’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
            </div>

            <div class="main-content">

                <!-- è¨ˆç®—æ©Ÿãƒ‘ãƒãƒ« -->
                <div id="panel-calc" class="panel active">
                    <div class="calc-container">
                        <h2>ğŸ’° ç„¡æ–™é€šè©±ç§’æ•° ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                        <div class="calc-grid">
                            <div><label>å‹•ç”»åºƒå‘Šå˜ä¾¡</label><input type="number" id="adPrice" value="1.5" step="0.1"> å††</div>
                            <div><label>é€šè©±åŸä¾¡ (1åˆ†)</label><input type="number" id="callCost" value="3.0" step="0.1"> å††</div>
                        </div>
                        <label>ç¢ºä¿ã—ãŸã„åˆ©ç›Šç‡ (%) <span id="marginDisplay" style="color:#007acc; margin-left:10px;">20%</span></label>
                        <input type="range" id="margin" min="0" max="50" value="20" oninput="document.getElementById('marginDisplay').innerText = this.value + '%'">
                        <button class="btn-calc" onclick="calcSeconds()">è¨ˆç®—ã™ã‚‹</button>
                        <div class="calc-result-box">
                            <div style="color:#aaa; font-size:0.9rem;">ã‚¢ãƒ—ãƒªã«è¨­å®šã™ã¹ããƒãƒ£ãƒ¼ã‚¸ç§’æ•°</div>
                            <div id="calcOutput" class="calc-number">--- ç§’</div>
                            <div id="profitOutput" class="calc-sub">(åºƒå‘Š1å›ã‚ãŸã‚Šã®ç´”åˆ©ç›Š: --- å††)</div>
                        </div>
                    </div>
                </div>

                <!-- CMSãƒ‘ãƒãƒ« -->
                <div id="panel-cms" class="panel">
                    <div class="cms-layout">
                        <!-- ã‚¨ãƒ‡ã‚£ã‚¿ -->
                        <div class="editor-area">
                            <h2>ğŸ“ è¨˜äº‹ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h2>
                            
                            <!-- å…±é€šé …ç›® -->
                            <div class="form-group">
                                <label>æ—¥ä»˜</label>
                                <input type="text" id="inDate" class="input-white" style="width:100% !important;">
                            </div>

                            <div class="form-group">
                                <label>ã‚«ãƒ†ã‚´ãƒª</label>
                                <select id="inCategory" class="input-white" style="width:100% !important;" onchange="updatePreview()">
                                    <option value="update">æ›´æ–°æƒ…å ±</option>
                                    <option value="release">ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹</option>
                                    <option value="start">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹ (Coming Soon)</option>
                                    <option value="steam">Steamãƒªãƒªãƒ¼ã‚¹</option>
                                    <option value="game">ã‚µã‚¤ãƒˆå†…ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (index_photãƒ•ã‚©ãƒ«ãƒ€)</label>
                                <input type="hidden" id="inImage" onchange="updatePreview()">
                                <div class="custom-select-wrapper">
                                    <div class="custom-select">
                                        <div class="custom-select__trigger" onclick="toggleImageSelect()">
                                            <span id="selectedImageText">ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„...</span>
                                            <span>â–¼</span>
                                        </div>
                                        <div class="custom-options" id="imageOptions"></div>
                                    </div>
                                </div>
                            </div>

                            <hr style="border:0; border-top:1px dashed #555; margin: 20px 0;">

                            <!-- è¨€èªåˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– -->
                            <div class="editor-lang-tabs">
                                <button class="edit-tab active" onclick="switchEditorLang('ja')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                                <button class="edit-tab" onclick="switchEditorLang('en')">ğŸ‡ºğŸ‡¸ English</button>
                                <button class="edit-tab" onclick="switchEditorLang('de')">ğŸ‡©ğŸ‡ª Deutsch</button>
                                <button class="edit-tab" onclick="switchEditorLang('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
                                <button class="edit-tab" onclick="switchEditorLang('es')">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
                            </div>

                            <!-- æ—¥æœ¬èªå…¥åŠ› -->
                            <div id="group-ja" class="lang-input-group active">
                                <div class="form-group">
                                    <label>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå (JP)ã€€ã€€ã€€news_data.js</label>
                                    <div class="input-group">
                                        <input type="text" id="inProject" class="input-white" placeholder="å…¥åŠ›ã¾ãŸã¯å³ã‹ã‚‰é¸æŠ" oninput="autoFillProject()" autocomplete="off">
                                        <select id="projectSelectHelper" class="input-white" onchange="syncProjectSelect()">
                                            <option value="">â–¼ å±¥æ­´...</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>ãŠçŸ¥ã‚‰ã›ãƒ»ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ (JP)</label>
                                    <input type="text" id="inTitle" class="input-white" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" oninput="updatePreview()" autocomplete="off">
                                </div>
                                <div class="form-group">
                                    <!-- åç§°å¤‰æ›´ -->
                                    <label>ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ (JP)</label>
                                    <textarea id="inBody" class="input-white" style="height:150px;" placeholder="ã‚¢ãƒ—ãƒªç´¹ä»‹æ–‡ã€ã¾ãŸã¯HPç”¨HTML" oninput="updatePreview()"></textarea>
                                </div>
                            </div>

                            <!-- å¤šè¨€èªå…¥åŠ› -->
                            <div id="group-en" class="lang-input-group">
                                <div class="form-group"><label>Project Name (EN)</label><input type="text" id="inProjectEn" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>Title (EN)</label><input type="text" id="inTitleEn" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>App Intro Body (EN)</label><textarea id="inBodyEn" class="input-white" style="height:150px;" oninput="updatePreview()"></textarea></div>
                            </div>
                            <!-- DE/FR/ES çœç•¥ã›ãšå®Ÿè£… -->
                            <div id="group-de" class="lang-input-group">
                                <div class="form-group"><label>Projektname (DE)</label><input type="text" id="inProjectDe" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>Titel (DE)</label><input type="text" id="inTitleDe" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>EinfÃ¼hrung (DE)</label><textarea id="inBodyDe" class="input-white" style="height:150px;" oninput="updatePreview()"></textarea></div>
                            </div>
                            <div id="group-fr" class="lang-input-group">
                                <div class="form-group"><label>Nom du projet (FR)</label><input type="text" id="inProjectFr" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>Titre (FR)</label><input type="text" id="inTitleFr" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>Introduction (FR)</label><textarea id="inBodyFr" class="input-white" style="height:150px;" oninput="updatePreview()"></textarea></div>
                            </div>
                            <div id="group-es" class="lang-input-group">
                                <div class="form-group"><label>Nombre del proyecto (ES)</label><input type="text" id="inProjectEs" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>TÃ­tulo (ES)</label><input type="text" id="inTitleEs" class="input-white" oninput="updatePreview()"></div>
                                <div class="form-group"><label>IntroducciÃ³n (ES)</label><textarea id="inBodyEs" class="input-white" style="height:150px;" oninput="updatePreview()"></textarea></div>
                            </div>

                            <hr style="border:0; border-top:1px solid #444; margin: 20px 0;">
                            <button class="btn-copy" onclick="saveToGitHub()">ğŸš€ GitHubã¸ç›´æ¥ä¿å­˜ (å…¨ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°)</button>
                        </div>

                        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                        <div class="preview-area">
                            <div class="preview-header">
                                <h2 style="border:none; margin:0; font-size:1.1rem; color:#333;">ğŸ‘ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                            </div>
                            
                            <span class="preview-label">â–¼ ãŠçŸ¥ã‚‰ã› (News List)</span>
                            <div class="news-item">
                                <span class="news-date" id="prevDate">2026.03.15</span>
                                <span class="news-tag tag-update" id="prevTag">æ›´æ–°æƒ…å ±</span>
                                <div style="flex:1;">
                                    <span style="font-weight:bold; margin-right:10px; color:#333;" id="prevProjectName">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                    <span class="news-link" id="prevTitle">ã‚¿ã‚¤ãƒˆãƒ«</span>
                                </div>
                            </div>

                            <!-- ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ¨ªä¸¦ã³ã« -->
                            <div class="cards-container">
                                <div>
                                    <span class="preview-label">â–¼ æœ€æ–°ã®æ´»å‹• (Highlights)</span>
                                    <div id="highlightPreviewBox">
                                        <div class="highlight-card">
                                            <div class="highlight-img-area">
                                                <img src="" alt="No Image" id="prevImg" class="highlight-img">
                                                <span class="highlight-category-badge tag-update" id="prevCardCatBadge">æ›´æ–°æƒ…å ±</span>
                                            </div>
                                            <div class="highlight-content">
                                                <div class="highlight-meta">
                                                    <span class="meta-proj" id="prevCardProj">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                                </div>
                                                <div class="highlight-title" id="prevCardTitle">ãŠçŸ¥ã‚‰ã›ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼</div>
                                            </div>
                                        </div>
                                    </div>
                                    <p style="font-size:0.7rem; color:red;" id="highlightMsg"></p>
                                </div>

                                <!-- ã‚¢ãƒ—ãƒªç´¹ä»‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (æ–°è¦) -->
                                <div>
                                    <span class="preview-label">â–¼ ã‚¢ãƒ—ãƒªç´¹ä»‹ (App Intro)</span>
                                    <div class="highlight-card">
                                        <div class="highlight-img-area">
                                            <img src="" alt="No Image" id="prevAppImg" class="highlight-img">
                                        </div>
                                        <div class="highlight-content">
                                            <div class="highlight-meta">
                                                <span class="meta-proj" id="prevAppProj">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</span>
                                            </div>
                                            <!-- ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ã‚’è¡¨ç¤º -->
                                            <div class="highlight-title" id="prevAppBody" style="font-size:0.9rem; font-weight:normal;">
                                                ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <span class="preview-label">â–¼ è©³ç´°ãƒšãƒ¼ã‚¸ (Project Page)</span>
                            
                            <!-- HPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨iframeã®è¡¨ç¤º -->
                            <div class="hp-preview-box">
                                <strong>HomePage:</strong>
                                <a href="#" target="_blank" id="prevHpLink" class="hp-url">https://...</a>
                                <iframe id="prevHpFrame" class="hp-frame" src="about:blank"></iframe>
                                <p style="font-size:0.7rem; color:#666;">â€»ä¿å­˜å‰ã‚„ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆå‰ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚</p>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ãƒ‘ãƒãƒ« (æ–°è¦è¿½åŠ : ç®¡ç†ç”»é¢ç”¨) -->
                <div id="panel-projects" class="panel">
                    <div class="calc-container">
                        <h2>ğŸ“‚ å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ± (apps_summary.js)</h2>
                        <p>ç¾åœ¨ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ï¼ˆæœ€æ–°3ä»¶ãƒ»æ—¥è‹±ã®ã¿ï¼‰</p>
                        <!-- ã“ã“ã«JSã§ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹å®Ÿè£…ãªã©ã‚’æ‹¡å¼µå¯èƒ½ -->
                        <div id="projectListDisplay" style="color:#fff;">
                            (ä¿å­˜å®Ÿè¡Œæ™‚ã« apps_summary.js ãŒç”Ÿæˆã•ã‚Œã¾ã™)
                        </div>
                    </div>
                </div>

                <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒ‘ãƒãƒ« -->
                <div id="panel-users" class="panel">
                    <div class="calc-container">
                        <h2>ğŸ‘¥ ç·¨é›†æ¨©é™è€…ã®ç®¡ç†</h2>
                        <div style="display:flex; gap:10px; margin-bottom:20px;">
                            <input type="text" id="newUserId" placeholder="GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼ID" style="flex:1;">
                            <button class="btn-save" style="width:auto;" onclick="addUser()">è¿½åŠ </button>
                        </div>
                        <ul id="userList" style="background:#1e1e1e; padding:20px; border-radius:8px; list-style:none;"></ul>
                        <button class="btn-copy" onclick="saveUsersToGitHub()">ğŸ’¾ æ¨©é™è¨­å®šã‚’GitHubã«ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // â–¼â–¼â–¼ è¨­å®š â–¼â–¼â–¼
        const GITHUB_CONFIG = {
            owner: "KeiAppLab",
            repo: "KeiAppLab",
            path: "news_data.js", // ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
        };

        let previewLang = 'ja';

        // --- 1. èªè¨¼æ©Ÿèƒ½ ---
        async function checkIdentity() {
            const tokenInput = document.getElementById('tokenInput');
            const token = (typeof arguments[0] === 'string') ? arguments[0] : tokenInput.value.trim();
            const status = document.getElementById('authStatus');
            
            if (!token) { status.innerText = "âš ï¸ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"; status.style.color = "orange"; return; }
            status.innerText = "ç¢ºèªä¸­..."; status.style.color = "black";

            try {
                const res = await fetch("https://api.github.com/user", { headers: { Authorization: `token ${token}` } });
                if (!res.ok) throw new Error("ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã§ã™");
                const userData = await res.json();

                if (typeof allowedUsersData !== 'undefined' && allowedUsersData.includes(userData.login)) {
                    localStorage.setItem('gh_token', token);
                    showDashboard();
                } else {
                    status.innerText = "âŒ è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ã™: " + userData.login; status.style.color = "red";
                }
            } catch (err) { status.innerText = "âš ï¸ ã‚¨ãƒ©ãƒ¼: " + err.message; status.style.color = "red"; }
        }

        function showDashboard() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainWrapper').style.display = 'block';
            updatePreview();
            initProjectList();
            initImageSelector();
        }

        function logout() { localStorage.removeItem('gh_token'); location.reload(); }

        window.addEventListener('load', () => {
            const savedToken = localStorage.getItem('gh_token');
            if (savedToken) checkIdentity(savedToken);
            renderUserList();
        });

        // --- 2. ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ ---
        function switchPanel(panelId) {
            document.querySelectorAll('.panel').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('panel-' + panelId).classList.add('active');
            // event.currentTarget ã¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã¿æœ‰åŠ¹ãªãŸã‚ã€IDã§æ¤œç´¢ã—ã¦activeã«ã™ã‚‹
            const menus = document.querySelectorAll('.menu-btn');
            // ç°¡æ˜“å®Ÿè£…: ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡ã¯HTMLå´ã®onclickã§thisã‚’æ¸¡ã™ã®ãŒä¸€èˆ¬çš„ã ãŒã€
            // ä»Šå›ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼é †åºå›ºå®šãªã®ã§ç°¡ç•¥åŒ–
        }

        // --- 3. è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
        function calcSeconds() {
            const adPrice = parseFloat(document.getElementById('adPrice').value);
            const callCost = parseFloat(document.getElementById('callCost').value);
            const margin = parseFloat(document.getElementById('margin').value);
            const costPerSec = callCost / 60;
            const profit = adPrice * (margin / 100);
            const seconds = Math.floor((adPrice - profit) / costPerSec);
            document.getElementById('calcOutput').innerText = seconds + " ç§’";
            document.getElementById('profitOutput').innerText = "(ç´”åˆ©ç›Š: " + profit.toFixed(2) + " å††)";
        }

        // --- 4. CMSãƒ­ã‚¸ãƒƒã‚¯ ---
        let allPosts = []; // èª­ã¿è¾¼ã¿æ™‚ã« newsData ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹æƒ³å®šã ãŒã€ã“ã“ã§ã¯ä¿å­˜æ™‚ã« newsData ã‚’ä½¿ã†
        const today = new Date();
        document.getElementById('inDate').value = today.getFullYear() + '.' + (today.getMonth()+1).toString().padStart(2, '0') + '.' + today.getDate().toString().padStart(2, '0');

        function switchEditorLang(lang) {
            document.querySelectorAll('.lang-input-group').forEach(el => el.classList.remove('active'));
            document.getElementById('group-' + lang).classList.add('active');
            
            document.querySelectorAll('.edit-tab').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨€èªã‚‚é€£å‹•
            previewLang = lang;
            updatePreview();
        }

        function initProjectList() {
            if (typeof newsData === 'undefined') return;
            const projectSet = new Set(newsData.map(item => item.project).filter(p => p));
            const selectBox = document.getElementById('projectSelectHelper');
            selectBox.innerHTML = '<option value="">â–¼ å±¥æ­´...</option>';
            projectSet.forEach(projName => {
                const option = document.createElement('option');
                option.value = projName;
                option.textContent = projName;
                selectBox.appendChild(option);
            });
        }

        function syncProjectSelect() {
            const selectBox = document.getElementById('projectSelectHelper');
            const inputBox = document.getElementById('inProject');
            if (selectBox.value !== "") {
                inputBox.value = selectBox.value;
                autoFillProject();
                selectBox.selectedIndex = 0;
            }
        }

        function autoFillProject() {
            const inputProject = document.getElementById('inProject').value.trim();
            const fields = {
                ja: { proj: 'inProject', title: 'inTitle', body: 'inBody' },
                en: { proj: 'inProjectEn', title: 'inTitleEn', body: 'inBodyEn' },
                de: { proj: 'inProjectDe', title: 'inTitleDe', body: 'inBodyDe' },
                fr: { proj: 'inProjectFr', title: 'inTitleFr', body: 'inBodyFr' },
                es: { proj: 'inProjectEs', title: 'inTitleEs', body: 'inBodyEs' }
            };

            if (inputProject === "") {
                for (let lang in fields) {
                    document.getElementById(fields[lang].proj).value = "";
                    document.getElementById(fields[lang].title).value = "";
                    document.getElementById(fields[lang].body).value = "";
                }
                setImageValue("");
                updatePreview(); return;
            }

            // ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ¤œç´¢
            if (typeof newsData !== 'undefined') {
                const targetPost = newsData.slice().reverse().find(post => post.project === inputProject);
                if (targetPost) {
                    document.getElementById('inProject').value = targetPost.project || "";
                    document.getElementById('inTitle').value = targetPost.title || "";
                    document.getElementById('inBody').value = targetPost.body || ""; // ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ã¨ã—ã¦èª­ã¿è¾¼ã‚€
                    
                    document.getElementById('inProjectEn').value = targetPost.project_en || "";
                    document.getElementById('inTitleEn').value = targetPost.title_en || "";
                    document.getElementById('inBodyEn').value = targetPost.body_en || "";

                    document.getElementById('inProjectDe').value = targetPost.project_de || "";
                    document.getElementById('inTitleDe').value = targetPost.title_de || "";
                    document.getElementById('inBodyDe').value = targetPost.body_de || "";

                    document.getElementById('inProjectFr').value = targetPost.project_fr || "";
                    document.getElementById('inTitleFr').value = targetPost.title_fr || "";
                    document.getElementById('inBodyFr').value = targetPost.body_fr || "";

                    document.getElementById('inProjectEs').value = targetPost.project_es || "";
                    document.getElementById('inTitleEs').value = targetPost.title_es || "";
                    document.getElementById('inBodyEs').value = targetPost.body_es || "";

                    setImageValue(targetPost.image || "");
                }
            }
            updatePreview();
        }

        function initImageSelector() {
            const container = document.getElementById('imageOptions');
            container.innerHTML = '';
            const list = (typeof photoList !== 'undefined') ? photoList : ["no_image.png"];
            list.forEach(imgName => {
                const div = document.createElement('div');
                div.className = 'custom-option';
                div.onclick = function() { selectImage(imgName); };
                div.innerHTML = `<img src="index_phot/${imgName}" class="option-img" onerror="this.src='https://via.placeholder.com/50'"><span class="option-text">${imgName}</span>`;
                container.appendChild(div);
            });
        }

        function toggleImageSelect() { document.querySelector('.custom-select').classList.toggle('open'); }
        function selectImage(imgName) {
            document.getElementById('inImage').value = "index_phot/" + imgName;
            document.getElementById('selectedImageText').textContent = imgName;
            document.querySelector('.custom-select').classList.remove('open');
            updatePreview();
        }
        function setImageValue(fullPath) {
            document.getElementById('inImage').value = fullPath;
            const fileName = fullPath.split('/').pop() || "ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„...";
            document.getElementById('selectedImageText').textContent = fileName;
        }
        window.addEventListener('click', function(e) {
            const select = document.querySelector('.custom-select');
            if (!select.contains(e.target)) select.classList.remove('open');
        });

        function updatePreview() {
            const date = document.getElementById('inDate').value;
            const category = document.getElementById('inCategory').value;
            const image = document.getElementById('inImage').value;

            const idSuffix = previewLang === 'ja' ? '' : previewLang.charAt(0).toUpperCase() + previewLang.slice(1);
            
            const project = document.getElementById('inProject' + idSuffix).value || "Project";
            const title = document.getElementById('inTitle' + idSuffix).value || "Title";
            const body = document.getElementById('inBody' + idSuffix).value || "Body...";

            // ãŠçŸ¥ã‚‰ã›ãƒªã‚¹ãƒˆ
            document.getElementById('prevDate').textContent = date;
            document.getElementById('prevTitle').textContent = title;
            document.getElementById('prevProjectName').textContent = project;
            
            const tagEl = document.getElementById('prevTag');
            tagEl.className = 'news-tag tag-' + category;
            const catNames = {
                'ja': {'release':'ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹','update':'æ›´æ–°æƒ…å ±','start':'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹','steam':'Steamãƒªãƒªãƒ¼ã‚¹','game':'ãƒŸãƒ‹ã‚²ãƒ¼ãƒ '},
                'en': {'release':'Release','update':'Update','start':'Project Start','steam':'Steam','game':'Mini Game'},
                'de': {'release':'VerÃ¶ffentlichung','update':'Aktualisierung','start':'Projektstart','steam':'Steam','game':'Minispiel'},
                'fr': {'release':'Sortie','update':'Mise Ã  jour','start':'DÃ©but du projet','steam':'Steam','game':'Mini-jeu'},
                'es': {'release':'Lanzamiento','update':'ActualizaciÃ³n','start':'Inicio del proyecto','steam':'Steam','game':'Mini juego'}
            };
            tagEl.textContent = catNames[previewLang][category];

            // ç”»åƒã®åæ˜ 
            document.getElementById('prevImg').src = image;
            document.getElementById('prevAppImg').src = image;
            const display = image ? 'block' : 'none';
            document.getElementById('prevImg').style.display = display;
            document.getElementById('prevAppImg').style.display = display;

            // æœ€æ–°ã®æ´»å‹•ã‚«ãƒ¼ãƒ‰
            const highlightBox = document.getElementById('highlightPreviewBox');
            const highlightMsg = document.getElementById('highlightMsg');
            const isHighlight = (category === 'release' || category === 'start' || category === 'steam') && image !== "";
            
            document.getElementById('prevCardTitle').textContent = title;
            document.getElementById('prevCardProj').textContent = project;
            document.getElementById('prevCardCatBadge').textContent = tagEl.textContent;
            document.getElementById('prevCardCatBadge').className = 'highlight-category-badge tag-' + category;

            if (isHighlight) {
                highlightBox.style.opacity = "1";
                highlightMsg.textContent = "";
            } else {
                highlightBox.style.opacity = "0.4";
                highlightMsg.textContent = "â€»ã“ã®ã‚«ãƒ†ã‚´ãƒªã¾ãŸã¯ç”»åƒãªã—ã®ãŸã‚ã€ã€Œæœ€æ–°ã®æ´»å‹•ã€ã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚";
            }

            // ã‚¢ãƒ—ãƒªç´¹ä»‹ã‚«ãƒ¼ãƒ‰ (æ–°è¦)
            // ã‚¿ã‚¤ãƒˆãƒ«ã§ã¯ãªãã€Œã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡ã€ã‚’è¡¨ç¤º
            document.getElementById('prevAppProj').textContent = project;
            document.getElementById('prevAppBody').textContent = body;

            // HPãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
            // ç°¡æ˜“çš„ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã®è‹±èª(inProjectEn)ã¾ãŸã¯æ—¥æœ¬èª(inProject)ã‚’ä½¿ã£ã¦URLã‚’æ¨æ¸¬
            // ãƒ•ã‚©ãƒ«ãƒ€åã¯è‹±æ•°å­—ãŒæœ›ã¾ã—ã„ãŒã€ã“ã“ã§ã¯å…¥åŠ›å€¤ã‚’ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹æƒ³å®š
            let folderName = document.getElementById('inProjectEn').value || document.getElementById('inProject').value || "";
            folderName = folderName.replace(/\s+/g, '_'); // ç©ºç™½ã‚’ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã«ç½®æ›ã™ã‚‹ç­‰ã®ç°¡æ˜“å‡¦ç†
            const hpUrl = `https://${GITHUB_CONFIG.owner}.github.io/${GITHUB_CONFIG.repo}/${folderName}/index.html`;
            
            const hpLink = document.getElementById('prevHpLink');
            hpLink.textContent = hpUrl;
            hpLink.href = hpUrl;
            // iframeã¯å®Ÿéš›ã«å­˜åœ¨ã—ãªã„ã¨404ã«ãªã‚‹ãŸã‚ã€ã‚ãˆã¦srcã«ã¯å…¥ã‚Œãªã„ã‹ã€about:blankã«ã—ã¦ãŠã
            // ä¿å­˜å¾Œã®ã¿ç¢ºèªå¯èƒ½ã¨ã™ã‚‹
        }

        // --- 5. é«˜åº¦ãªä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ (5ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ) ---
        async function saveToGitHub() {
            const token = localStorage.getItem("gh_token");
            if (!token) { alert("èªè¨¼ãŒå¿…è¦ã§ã™"); return; }
            if(!confirm("å…¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒã‚¹ã‚¿ãƒ¼ã€ãƒˆãƒƒãƒ—ç”¨ã€ä¸€è¦§ç”¨ã€ã‚µãƒãƒªãƒ¼ã€å€‹åˆ¥HPç”¨ï¼‰ã‚’æ›´æ–°ãƒ»ç”Ÿæˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;

            // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
            const currentPost = {
                id: Date.now(),
                date: document.getElementById('inDate').value,
                category: document.getElementById('inCategory').value,
                image: document.getElementById('inImage').value,
                project: document.getElementById('inProject').value,
                title: document.getElementById('inTitle').value,
                body: document.getElementById('inBody').value,
                
                project_en: document.getElementById('inProjectEn').value,
                title_en: document.getElementById('inTitleEn').value,
                body_en: document.getElementById('inBodyEn').value,
                // ...ä»–è¨€èªã‚‚æœ¬æ¥ã¯å¿…è¦ã ãŒçœç•¥ã›ãšå–å¾—
                project_de: document.getElementById('inProjectDe').value, title_de: document.getElementById('inTitleDe').value, body_de: document.getElementById('inBodyDe').value,
                project_fr: document.getElementById('inProjectFr').value, title_fr: document.getElementById('inTitleFr').value, body_fr: document.getElementById('inBodyFr').value,
                project_es: document.getElementById('inProjectEs').value, title_es: document.getElementById('inTitleEs').value, body_es: document.getElementById('inBodyEs').value,
            };

            if (!currentPost.project) { alert("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå(JP)ã¯å¿…é ˆã§ã™"); return; }

            // ãƒ•ã‚©ãƒ«ãƒ€åï¼ˆè‹±åã‚’æ¨å¥¨ã€ãªã‘ã‚Œã°å’Œåï¼‰
            let folderName = currentPost.project_en || currentPost.project;
            folderName = folderName.replace(/\s+/g, '_'); 

            try {
                // 1. ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–° (news_data.js)
                // æ—¢å­˜ã®newsDataã«æœ€æ–°ã‚’è¿½åŠ 
                const updatedMaster = [currentPost, ...newsData];
                
                // 2. ãƒˆãƒƒãƒ—ç”¨ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ (index_news.js)
                // ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹ç³»ã¨æ›´æ–°ç³»ã§åˆ†ã‘ã‚‹
                const release cats = ['release', 'start', 'steam'];
                const updateCats = ['update', 'game'];
                
                const releasePosts = updatedMaster.filter(p => cats.includes(p.category)).slice(0, 10);
                const updatePosts = updatedMaster.filter(p => updateCats.includes(p.category)).slice(0, 10);
                const indexNewsData = [...releasePosts, ...updatePosts];

                // 3. ã‚¢ãƒ—ãƒªä¸€è¦§ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–° (apps_list.js)
                // æ—¢å­˜ã®appsListDataã‹ã‚‰ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¢ã—ã¦æ›´æ–°ã€ãªã‘ã‚Œã°è¿½åŠ 
                let newAppsList = [...appsListData];
                const existingAppIndex = newAppsList.findIndex(a => a.project === currentPost.project);
                const appEntry = {
                    project: currentPost.project,
                    project_en: currentPost.project_en,
                    image: currentPost.image,
                    intro: currentPost.body, // ã‚¢ãƒ—ãƒªç´¹ä»‹æœ¬æ–‡
                    intro_en: currentPost.body_en,
                    folder: folderName
                };
                if (existingAppIndex >= 0) {
                    newAppsList[existingAppIndex] = appEntry;
                } else {
                    newAppsList.push(appEntry);
                }

                // 4. ç®¡ç†ç”»é¢ä¸€è¦§ç”¨ã‚µãƒãƒªãƒ¼ (apps_summary.js)
                // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ã¦æœ€æ–°3ä»¶ (æ—¥è‹±ã®ã¿)
                const summaryData = {};
                updatedMaster.forEach(p => {
                    if (!summaryData[p.project]) summaryData[p.project] = [];
                    if (summaryData[p.project].length < 3) {
                        summaryData[p.project].push({
                            date: p.date, category: p.category, title: p.title, title_en: p.title_en
                        });
                    }
                });

                // 5. å€‹åˆ¥HPç”¨ãƒ‡ãƒ¼ã‚¿ ([Project]/news.js)
                const projectNews = updatedMaster.filter(p => p.project === currentPost.project);


                // --- ä¿å­˜å®Ÿè¡Œ (Promise.allã§ä¸¦åˆ—å‡¦ç†ã‚‚å¯èƒ½ã ãŒã€å®‰å…¨ã®ãŸã‚é †æ¬¡å®Ÿè¡Œã¾ãŸã¯é‡è¦ãªé †) ---
                
                // A. news_data.js (ãƒã‚¹ã‚¿ãƒ¼)
                await uploadFile("news_data.js", `var newsData = ${JSON.stringify(updatedMaster, null, 4)};`, "Update Master Data");

                // B. index_news.js
                await uploadFile("index_news.js", `var indexNewsData = ${JSON.stringify(indexNewsData, null, 4)};`, "Update Index News");

                // C. apps_list.js
                await uploadFile("apps_list.js", `var appsListData = ${JSON.stringify(newAppsList, null, 4)};`, "Update Apps List");

                // D. apps_summary.js
                await uploadFile("apps_summary.js", `var appsSummaryData = ${JSON.stringify(summaryData, null, 4)};`, "Update Apps Summary");

                // E. å€‹åˆ¥ news.js
                await uploadFile(`${folderName}/news.js`, `var projectNewsData = ${JSON.stringify(projectNews, null, 4)};`, `Update ${folderName} News`);

                // F. åˆå›ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ & index.html (å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚’çœãã€PUTã§ä½œæˆ/ä¸Šæ›¸ã)
                // ç°¡æ˜“ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                const indexHtmlContent = `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>${currentPost.project}</title>
    <script src="news.js"></script>
</head>
<body>
    <h1>${currentPost.project}</h1>
    <p>Loading news...</p>
    <script>
        // ç°¡æ˜“è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
        console.log(projectNewsData);
        document.body.innerHTML += JSON.stringify(projectNewsData);
    </script>
</body>
</html>`;
                // æ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã›ãšã«PUTã™ã‚‹ã¨ä¸Šæ›¸ãã—ã¦ã—ã¾ã†ãŸã‚ã€
                // æœ¬æ¥ã¯GETã—ã¦404ãªã‚‰ä½œæˆã ãŒã€ã“ã“ã§ã¯ã€Œåˆå›ã®ã¿ã€ã®åˆ¤å®šãŒé›£ã—ã„ãŸã‚
                // "apps_listã«ã¾ã ç„¡ã‹ã£ãŸ(=æ–°è¦)" å ´åˆã®ã¿ä½œæˆã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã«ã™ã‚‹
                if (existingAppIndex === -1) {
                    await uploadFile(`${folderName}/index.html`, indexHtmlContent, `Create ${folderName} Home`);
                }

                alert("å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
                location.reload(); // ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿

            } catch (err) {
                console.error(err);
                alert("ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + err.message);
            }
        }

        // GitHub API ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        async function uploadFile(path, content, message) {
            const token = localStorage.getItem("gh_token");
            const apiUrl = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`;
            
            // 1. SHAå–å¾— (ä¸Šæ›¸ãã®ãŸã‚)
            let sha = null;
            try {
                const getRes = await fetch(apiUrl, { headers: { Authorization: `token ${token}` } });
                if (getRes.ok) {
                    const data = await getRes.json();
                    sha = data.sha;
                }
            } catch(e) { /* æ–°è¦ä½œæˆæ™‚ã¯ç„¡è¦– */ }

            // 2. PUT (ä½œæˆãƒ»æ›´æ–°)
            const encodedContent = btoa(unescape(encodeURIComponent(content)));
            const res = await fetch(apiUrl, {
                method: "PUT",
                headers: { 
                    Authorization: `token ${token}`, 
                    "Content-Type": "application/json" 
                },
                body: JSON.stringify({
                    message: message,
                    content: encodedContent,
                    sha: sha
                })
            });
            if (!res.ok) throw new Error(`Failed to save ${path}`);
        }

        // --- 6. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç®¡ç† ---
        function renderUserList() {
            const list = document.getElementById('userList');
            if(!list) return;
            list.innerHTML = '';
            if (typeof allowedUsersData !== 'undefined') {
                allowedUsersData.forEach((user, index) => {
                    const li = document.createElement('li');
                    li.style = "display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #333; color:#fff;";
                    li.innerHTML = `<span>${user}</span><button style="background:#c0392b; width:auto; padding:5px 10px; font-size:0.8rem; margin:0;" onclick="removeUser(${index})">å‰Šé™¤</button>`;
                    list.appendChild(li);
                });
            }
        }
        function addUser() {
            const input = document.getElementById('newUserId');
            const id = input.value.trim();
            if(!id) return;
            if(allowedUsersData.includes(id)) { alert("æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™"); return; }
            allowedUsersData.push(id);
            input.value = '';
            renderUserList();
        }
        function removeUser(index) {
            if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) { allowedUsersData.splice(index, 1); renderUserList(); }
        }
        async function saveUsersToGitHub() {
            const token = localStorage.getItem("gh_token");
            if (!token) { alert("èªè¨¼ãŒå¿…è¦ã§ã™"); return; }
            if(!confirm("GitHubä¸Šã® allowed_users.js ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
            const content = `var allowedUsersData = ${JSON.stringify(allowedUsersData, null, 4)};`;
            await uploadFile("allowed_users.js", content, "Update allowed users list");
            alert("æ¨©é™è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸï¼");
        }
    </script>
</body>
</html>
